"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseWindows = parseWindows;
exports.parseSurfaceLine = parseSurfaceLine;
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _logger = _interopRequireDefault(require("../logger"));

var _moment = _interopRequireDefault(require("moment"));

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keys = async function keys(keys) {
  keys = _lodash.default.isArray(keys) ? keys.join('') : keys;
  let params = {
    text: keys,
    replace: false
  };

  if (this.opts.unicodeKeyboard) {
    params.unicodeKeyboard = true;
  }

  await this.doSendKeys(params);
};

commands.doSendKeys = async function doSendKeys(params) {
  return await this.bootstrap.sendAction('setText', params);
};

commands.getDeviceTime = async function getDeviceTime(format = 'YYYY-MM-DDTHH:mm:ssZ') {
  _logger.default.debug('Attempting to capture android device date and time. ' + `The format specifier is '${format}'`);

  const deviceTimestamp = (await this.adb.shell(['date', '+%Y-%m-%dT%T%z'])).trim();

  _logger.default.debug(`Got device timestamp: ${deviceTimestamp}`);

  const parsedTimestamp = _moment.default.utc(deviceTimestamp, 'YYYY-MM-DDTHH:mm:ssZZ');

  if (!parsedTimestamp.isValid()) {
    _logger.default.warn('Cannot parse the returned timestamp. Returning as is');

    return deviceTimestamp;
  }

  return parsedTimestamp.utcOffset(parsedTimestamp._tzm || 0).format(format);
};

commands.getPageSource = async function getPageSource() {
  return await this.bootstrap.sendAction('source');
};

commands.back = async function back() {
  return await this.bootstrap.sendAction('pressBack');
};

commands.isKeyboardShown = async function isKeyboardShown() {
  let keyboardInfo = await this.adb.isSoftKeyboardPresent();
  return keyboardInfo.isKeyboardShown;
};

commands.hideKeyboard = async function hideKeyboard() {
  let {
    isKeyboardShown,
    canCloseKeyboard
  } = await this.adb.isSoftKeyboardPresent();

  if (!isKeyboardShown) {
    _logger.default.info('Keyboard has no UI; no closing necessary');

    return;
  }

  for (const keyCode of [111, 4]) {
    if (canCloseKeyboard) {
      await this.adb.keyevent(keyCode);
    }

    try {
      return await (0, _asyncbox.waitForCondition)(async () => {
        ({
          isKeyboardShown
        } = await this.adb.isSoftKeyboardPresent());
        return !isKeyboardShown;
      }, {
        waitMs: 1000,
        intervalMs: 500
      });
    } catch (ign) {}
  }

  throw new Error(`The software keyboard cannot be closed`);
};

commands.openSettingsActivity = async function openSettingsActivity(setting) {
  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.shell(['am', 'start', '-a', `android.settings.${setting}`]);
  await this.adb.waitForNotActivity(appPackage, appActivity, 5000);
};

commands.getWindowSize = async function getWindowSize() {
  return await this.bootstrap.sendAction('getDeviceSize');
};

commands.getWindowRect = async function getWindowRect() {
  const {
    width,
    height
  } = await this.getWindowSize();
  return {
    width,
    height,
    x: 0,
    y: 0
  };
};

commands.getCurrentActivity = async function getCurrentActivity() {
  return (await this.adb.getFocusedPackageAndActivity()).appActivity;
};

commands.getCurrentPackage = async function getCurrentPackage() {
  return (await this.adb.getFocusedPackageAndActivity()).appPackage;
};

commands.background = async function background(seconds) {
  if (seconds < 0) {
    await this.adb.goToHome();
    return true;
  }

  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.goToHome();
  await _bluebird.default.delay(seconds * 1000);
  let args;

  if (this._cachedActivityArgs && this._cachedActivityArgs[`${appPackage}/${appActivity}`]) {
    args = this._cachedActivityArgs[`${appPackage}/${appActivity}`];
  } else {
    try {
      _logger.default.debug(`Activating app '${appPackage}' in order to restore it`);

      await this.activateApp(appPackage);
      return true;
    } catch (ign) {}

    args = appPackage === this.opts.appPackage && appActivity === this.opts.appActivity || appPackage === this.opts.appWaitPackage && (this.opts.appWaitActivity || '').split(',').includes(appActivity) ? {
      pkg: this.opts.appPackage,
      activity: this.opts.appActivity,
      action: this.opts.intentAction,
      category: this.opts.intentCategory,
      flags: this.opts.intentFlags,
      waitPkg: this.opts.appWaitPackage,
      waitActivity: this.opts.appWaitActivity,
      waitForLaunch: this.opts.appWaitForLaunch,
      optionalIntentArguments: this.opts.optionalIntentArguments,
      stopApp: false,
      user: this.opts.userProfile
    } : {
      pkg: appPackage,
      activity: appActivity,
      waitPkg: appPackage,
      waitActivity: appActivity,
      stopApp: false
    };
  }

  args = await _appiumSupport.util.filterObject(args);

  _logger.default.debug(`Bringing application back to foreground with arguments: ${JSON.stringify(args)}`);

  return await this.adb.startApp(args);
};

commands.getStrings = async function getStrings(language) {
  if (!language) {
    language = await this.adb.getDeviceLanguage();

    _logger.default.info(`No language specified, returning strings for: ${language}`);
  }

  const preprocessStringsMap = mapping => {
    const result = {};

    for (const [key, value] of _lodash.default.toPairs(mapping)) {
      result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    return result;
  };

  if (this.apkStrings[language]) {
    return preprocessStringsMap(this.apkStrings[language]);
  }

  this.apkStrings[language] = await _androidHelpers.default.pushStrings(language, this.adb, this.opts);

  if (this.bootstrap) {
    await this.bootstrap.sendAction('updateStrings');
  }

  return preprocessStringsMap(this.apkStrings[language]);
};

commands.launchApp = async function launchApp() {
  await this.initAUT();
  await this.startAUT();
};

commands.startActivity = async function startActivity(appPackage, appActivity, appWaitPackage, appWaitActivity, intentAction, intentCategory, intentFlags, optionalIntentArguments, dontStopAppOnReset) {
  _logger.default.debug(`Starting package '${appPackage}' and activity '${appActivity}'`);

  if (!_appiumSupport.util.hasValue(dontStopAppOnReset)) {
    dontStopAppOnReset = !!this.opts.dontStopAppOnReset;
  }

  let args = {
    pkg: appPackage,
    activity: appActivity,
    waitPkg: appWaitPackage || appPackage,
    waitActivity: appWaitActivity || appActivity,
    action: intentAction,
    category: intentCategory,
    flags: intentFlags,
    optionalIntentArguments,
    stopApp: !dontStopAppOnReset
  };
  this._cachedActivityArgs = this._cachedActivityArgs || {};
  this._cachedActivityArgs[`${args.waitPkg}/${args.waitActivity}`] = args;
  await this.adb.startApp(args);
};

commands.reset = async function reset() {
  await _androidHelpers.default.resetApp(this.adb, Object.assign({}, this.opts, {
    fastReset: true
  }));
  await this.setContext();
  return (await this.isChromeSession) ? this.startChromeSession() : this.startAUT();
};

commands.startAUT = async function startAUT() {
  await this.adb.startApp({
    pkg: this.opts.appPackage,
    activity: this.opts.appActivity,
    action: this.opts.intentAction,
    category: this.opts.intentCategory,
    flags: this.opts.intentFlags,
    waitPkg: this.opts.appWaitPackage,
    waitActivity: this.opts.appWaitActivity,
    waitDuration: this.opts.appWaitDuration,
    optionalIntentArguments: this.opts.optionalIntentArguments,
    stopApp: !this.opts.dontStopAppOnReset,
    user: this.opts.userProfile
  });
};

commands.setUrl = async function setUrl(uri) {
  await this.adb.startUri(uri, this.opts.appPackage);
};

commands.closeApp = async function closeApp() {
  await this.adb.forceStop(this.opts.appPackage);
  await this.setContext();
};

commands.getDisplayDensity = async function getDisplayDensity() {
  let out = await this.adb.shell(['getprop', 'ro.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  out = await this.adb.shell(['getprop', 'qemu.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  _logger.default.errorAndThrow('Failed to get display density property.');
};

function parseSurfaceLine(line) {
  let bounds = line.split('rect=')[1].replace(/[(), x]+/g, ' ').trim().split(' ');
  return {
    visible: line.indexOf('shown=true') !== -1,
    x: parseFloat(bounds[0]),
    y: parseFloat(bounds[1]),
    width: parseFloat(bounds[2]),
    height: parseFloat(bounds[3])
  };
}

function parseWindows(lines) {
  let atStatusBar = false;
  let atNavBar = false;
  let statusBar;
  let navigationBar;
  lines.split('\n').forEach(line => {
    if (line.indexOf('  Window #') !== -1) {
      atStatusBar = line.indexOf('StatusBar') !== -1;
      atNavBar = line.indexOf('NavigationBar') !== -1;
      return;
    }

    if (line.indexOf('      Surface:') === -1) {
      return;
    }

    if (atStatusBar) {
      statusBar = parseSurfaceLine(line);
      atStatusBar = false;
    } else if (atNavBar) {
      navigationBar = parseSurfaceLine(line);
      atNavBar = false;
    }
  });

  if (!statusBar) {
    _logger.default.errorAndThrow('Failed to parse status bar information.');
  }

  if (!navigationBar) {
    _logger.default.errorAndThrow('Failed to parse navigation bar information.');
  }

  return {
    statusBar,
    navigationBar
  };
}

commands.getSystemBars = async function getSystemBars() {
  let out = await this.adb.shell(['dumpsys', 'window', 'windows']);

  if (!out) {
    _logger.default.errorAndThrow('Did not get window manager output.');
  }

  return parseWindows(out);
};

commands.mobilePerformEditorAction = async function mobilePerformEditorAction(opts = {}) {
  const {
    action
  } = opts;

  if (!_appiumSupport.util.hasValue(action)) {
    _logger.default.errorAndThrow(`'action' argument is required`);
  }

  await this.adb.performEditorAction(action);
};

const PERMISSION_ACTION = {
  GRANT: 'grant',
  REVOKE: 'revoke'
};

commands.mobileChangePermissions = async function mobileChangePermissions(opts = {}) {
  const {
    permissions,
    appPackage = this.opts.appPackage,
    action = PERMISSION_ACTION.GRANT
  } = opts;

  if (!_appiumSupport.util.hasValue(permissions)) {
    _logger.default.errorAndThrow(`'permissions' argument is required`);
  }

  let actionFunc;

  switch (_lodash.default.toLower(action)) {
    case PERMISSION_ACTION.GRANT:
      actionFunc = (appPackage, permission) => this.adb.grantPermission(appPackage, permission);

      break;

    case PERMISSION_ACTION.REVOKE:
      actionFunc = (appPackage, permission) => this.adb.revokePermission(appPackage, permission);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown action '${action}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSION_ACTION))} actions are supported`);

      break;
  }

  for (const permission of _lodash.default.isArray(permissions) ? permissions : [permissions]) {
    await actionFunc(appPackage, permission);
  }
};

const PERMISSIONS_TYPE = {
  DENIED: 'denied',
  GRANTED: 'granted',
  REQUESTED: 'requested'
};

commands.mobileGetPermissions = async function mobileGetPermissions(opts = {}) {
  const {
    type = PERMISSIONS_TYPE.REQUESTED,
    appPackage = this.opts.appPackage
  } = opts;
  let actionFunc;

  switch (_lodash.default.toLower(type)) {
    case PERMISSIONS_TYPE.REQUESTED:
      actionFunc = appPackage => this.adb.getReqPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.GRANTED:
      actionFunc = appPackage => this.adb.getGrantedPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.DENIED:
      actionFunc = appPackage => this.adb.getDeniedPermissions(appPackage);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown permissions type '${type}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSIONS_TYPE))} types are supported`);

      break;
  }

  return await actionFunc(appPackage);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJrZXlzIiwiXyIsImlzQXJyYXkiLCJqb2luIiwicGFyYW1zIiwidGV4dCIsInJlcGxhY2UiLCJvcHRzIiwidW5pY29kZUtleWJvYXJkIiwiZG9TZW5kS2V5cyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJnZXREZXZpY2VUaW1lIiwiZm9ybWF0IiwibG9nIiwiZGVidWciLCJkZXZpY2VUaW1lc3RhbXAiLCJhZGIiLCJzaGVsbCIsInRyaW0iLCJwYXJzZWRUaW1lc3RhbXAiLCJtb21lbnQiLCJ1dGMiLCJpc1ZhbGlkIiwid2FybiIsInV0Y09mZnNldCIsIl90em0iLCJnZXRQYWdlU291cmNlIiwiYmFjayIsImlzS2V5Ym9hcmRTaG93biIsImtleWJvYXJkSW5mbyIsImlzU29mdEtleWJvYXJkUHJlc2VudCIsImhpZGVLZXlib2FyZCIsImNhbkNsb3NlS2V5Ym9hcmQiLCJpbmZvIiwia2V5Q29kZSIsImtleWV2ZW50Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImlnbiIsIkVycm9yIiwib3BlblNldHRpbmdzQWN0aXZpdHkiLCJzZXR0aW5nIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIndhaXRGb3JOb3RBY3Rpdml0eSIsImdldFdpbmRvd1NpemUiLCJnZXRXaW5kb3dSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJ4IiwieSIsImdldEN1cnJlbnRBY3Rpdml0eSIsImdldEN1cnJlbnRQYWNrYWdlIiwiYmFja2dyb3VuZCIsInNlY29uZHMiLCJnb1RvSG9tZSIsIkIiLCJkZWxheSIsImFyZ3MiLCJfY2FjaGVkQWN0aXZpdHlBcmdzIiwiYWN0aXZhdGVBcHAiLCJhcHBXYWl0UGFja2FnZSIsImFwcFdhaXRBY3Rpdml0eSIsInNwbGl0IiwiaW5jbHVkZXMiLCJwa2ciLCJhY3Rpdml0eSIsImFjdGlvbiIsImludGVudEFjdGlvbiIsImNhdGVnb3J5IiwiaW50ZW50Q2F0ZWdvcnkiLCJmbGFncyIsImludGVudEZsYWdzIiwid2FpdFBrZyIsIndhaXRBY3Rpdml0eSIsIndhaXRGb3JMYXVuY2giLCJhcHBXYWl0Rm9yTGF1bmNoIiwib3B0aW9uYWxJbnRlbnRBcmd1bWVudHMiLCJzdG9wQXBwIiwidXNlciIsInVzZXJQcm9maWxlIiwidXRpbCIsImZpbHRlck9iamVjdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGFydEFwcCIsImdldFN0cmluZ3MiLCJsYW5ndWFnZSIsImdldERldmljZUxhbmd1YWdlIiwicHJlcHJvY2Vzc1N0cmluZ3NNYXAiLCJtYXBwaW5nIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiaXNTdHJpbmciLCJhcGtTdHJpbmdzIiwiYW5kcm9pZEhlbHBlcnMiLCJwdXNoU3RyaW5ncyIsImxhdW5jaEFwcCIsImluaXRBVVQiLCJzdGFydEFVVCIsInN0YXJ0QWN0aXZpdHkiLCJkb250U3RvcEFwcE9uUmVzZXQiLCJoYXNWYWx1ZSIsInJlc2V0IiwicmVzZXRBcHAiLCJPYmplY3QiLCJhc3NpZ24iLCJmYXN0UmVzZXQiLCJzZXRDb250ZXh0IiwiaXNDaHJvbWVTZXNzaW9uIiwic3RhcnRDaHJvbWVTZXNzaW9uIiwid2FpdER1cmF0aW9uIiwiYXBwV2FpdER1cmF0aW9uIiwic2V0VXJsIiwidXJpIiwic3RhcnRVcmkiLCJjbG9zZUFwcCIsImZvcmNlU3RvcCIsImdldERpc3BsYXlEZW5zaXR5Iiwib3V0IiwidmFsIiwicGFyc2VJbnQiLCJpc05hTiIsImVycm9yQW5kVGhyb3ciLCJwYXJzZVN1cmZhY2VMaW5lIiwibGluZSIsImJvdW5kcyIsInZpc2libGUiLCJpbmRleE9mIiwicGFyc2VGbG9hdCIsInBhcnNlV2luZG93cyIsImxpbmVzIiwiYXRTdGF0dXNCYXIiLCJhdE5hdkJhciIsInN0YXR1c0JhciIsIm5hdmlnYXRpb25CYXIiLCJmb3JFYWNoIiwiZ2V0U3lzdGVtQmFycyIsIm1vYmlsZVBlcmZvcm1FZGl0b3JBY3Rpb24iLCJwZXJmb3JtRWRpdG9yQWN0aW9uIiwiUEVSTUlTU0lPTl9BQ1RJT04iLCJHUkFOVCIsIlJFVk9LRSIsIm1vYmlsZUNoYW5nZVBlcm1pc3Npb25zIiwicGVybWlzc2lvbnMiLCJhY3Rpb25GdW5jIiwidG9Mb3dlciIsInBlcm1pc3Npb24iLCJncmFudFBlcm1pc3Npb24iLCJyZXZva2VQZXJtaXNzaW9uIiwidmFsdWVzIiwiUEVSTUlTU0lPTlNfVFlQRSIsIkRFTklFRCIsIkdSQU5URUQiLCJSRVFVRVNURUQiLCJtb2JpbGVHZXRQZXJtaXNzaW9ucyIsInR5cGUiLCJnZXRSZXFQZXJtaXNzaW9ucyIsImdldEdyYW50ZWRQZXJtaXNzaW9ucyIsImdldERlbmllZFBlcm1pc3Npb25zIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBSUEsUUFBUSxHQUFHLEVBQWY7QUFBQSxJQUFtQkMsT0FBTyxHQUFHLEVBQTdCO0FBQUEsSUFBaUNDLFVBQVUsR0FBRyxFQUE5Qzs7OztBQUVBRixRQUFRLENBQUNHLElBQVQsR0FBZ0IsZUFBZUEsSUFBZixDQUFxQkEsSUFBckIsRUFBMkI7QUFFekNBLEVBQUFBLElBQUksR0FBR0MsZ0JBQUVDLE9BQUYsQ0FBVUYsSUFBVixJQUFrQkEsSUFBSSxDQUFDRyxJQUFMLENBQVUsRUFBVixDQUFsQixHQUFrQ0gsSUFBekM7QUFDQSxNQUFJSSxNQUFNLEdBQUc7QUFDWEMsSUFBQUEsSUFBSSxFQUFFTCxJQURLO0FBRVhNLElBQUFBLE9BQU8sRUFBRTtBQUZFLEdBQWI7O0FBSUEsTUFBSSxLQUFLQyxJQUFMLENBQVVDLGVBQWQsRUFBK0I7QUFDN0JKLElBQUFBLE1BQU0sQ0FBQ0ksZUFBUCxHQUF5QixJQUF6QjtBQUNEOztBQUNELFFBQU0sS0FBS0MsVUFBTCxDQUFnQkwsTUFBaEIsQ0FBTjtBQUNELENBWEQ7O0FBYUFQLFFBQVEsQ0FBQ1ksVUFBVCxHQUFzQixlQUFlQSxVQUFmLENBQTJCTCxNQUEzQixFQUFtQztBQUN2RCxTQUFPLE1BQU0sS0FBS00sU0FBTCxDQUFlQyxVQUFmLENBQTBCLFNBQTFCLEVBQXFDUCxNQUFyQyxDQUFiO0FBQ0QsQ0FGRDs7QUFhQVAsUUFBUSxDQUFDZSxhQUFULEdBQXlCLGVBQWVBLGFBQWYsQ0FBOEJDLE1BQU0sR0FBRyxzQkFBdkMsRUFBK0Q7QUFDdEZDLGtCQUFJQyxLQUFKLENBQVUseURBQ1AsNEJBQTJCRixNQUFPLEdBRHJDOztBQUVBLFFBQU1HLGVBQWUsR0FBRyxDQUFDLE1BQU0sS0FBS0MsR0FBTCxDQUFTQyxLQUFULENBQWUsQ0FBQyxNQUFELEVBQVMsZ0JBQVQsQ0FBZixDQUFQLEVBQW1EQyxJQUFuRCxFQUF4Qjs7QUFDQUwsa0JBQUlDLEtBQUosQ0FBVyx5QkFBd0JDLGVBQWdCLEVBQW5EOztBQUNBLFFBQU1JLGVBQWUsR0FBR0MsZ0JBQU9DLEdBQVAsQ0FBV04sZUFBWCxFQUE0Qix1QkFBNUIsQ0FBeEI7O0FBQ0EsTUFBSSxDQUFDSSxlQUFlLENBQUNHLE9BQWhCLEVBQUwsRUFBZ0M7QUFDOUJULG9CQUFJVSxJQUFKLENBQVMsc0RBQVQ7O0FBQ0EsV0FBT1IsZUFBUDtBQUNEOztBQUNELFNBQU9JLGVBQWUsQ0FBQ0ssU0FBaEIsQ0FBMEJMLGVBQWUsQ0FBQ00sSUFBaEIsSUFBd0IsQ0FBbEQsRUFBcURiLE1BQXJELENBQTREQSxNQUE1RCxDQUFQO0FBQ0QsQ0FYRDs7QUFhQWhCLFFBQVEsQ0FBQzhCLGFBQVQsR0FBeUIsZUFBZUEsYUFBZixHQUFnQztBQUN2RCxTQUFPLE1BQU0sS0FBS2pCLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixRQUExQixDQUFiO0FBQ0QsQ0FGRDs7QUFJQWQsUUFBUSxDQUFDK0IsSUFBVCxHQUFnQixlQUFlQSxJQUFmLEdBQXVCO0FBQ3JDLFNBQU8sTUFBTSxLQUFLbEIsU0FBTCxDQUFlQyxVQUFmLENBQTBCLFdBQTFCLENBQWI7QUFDRCxDQUZEOztBQUlBZCxRQUFRLENBQUNnQyxlQUFULEdBQTJCLGVBQWVBLGVBQWYsR0FBa0M7QUFDM0QsTUFBSUMsWUFBWSxHQUFHLE1BQU0sS0FBS2IsR0FBTCxDQUFTYyxxQkFBVCxFQUF6QjtBQUNBLFNBQU9ELFlBQVksQ0FBQ0QsZUFBcEI7QUFDRCxDQUhEOztBQUtBaEMsUUFBUSxDQUFDbUMsWUFBVCxHQUF3QixlQUFlQSxZQUFmLEdBQStCO0FBQ3JELE1BQUk7QUFBQ0gsSUFBQUEsZUFBRDtBQUFrQkksSUFBQUE7QUFBbEIsTUFBc0MsTUFBTSxLQUFLaEIsR0FBTCxDQUFTYyxxQkFBVCxFQUFoRDs7QUFDQSxNQUFJLENBQUNGLGVBQUwsRUFBc0I7QUFDcEJmLG9CQUFJb0IsSUFBSixDQUFTLDBDQUFUOztBQUNBO0FBQ0Q7O0FBRUQsT0FBSyxNQUFNQyxPQUFYLElBQXNCLENBQUMsR0FBRCxFQUFNLENBQU4sQ0FBdEIsRUFBZ0M7QUFDOUIsUUFBSUYsZ0JBQUosRUFBc0I7QUFDcEIsWUFBTSxLQUFLaEIsR0FBTCxDQUFTbUIsUUFBVCxDQUFrQkQsT0FBbEIsQ0FBTjtBQUNEOztBQUNELFFBQUk7QUFDRixhQUFPLE1BQU0sZ0NBQWlCLFlBQVk7QUFDeEMsU0FBQztBQUFDTixVQUFBQTtBQUFELFlBQW9CLE1BQU0sS0FBS1osR0FBTCxDQUFTYyxxQkFBVCxFQUEzQjtBQUNBLGVBQU8sQ0FBQ0YsZUFBUjtBQUNELE9BSFksRUFHVjtBQUFDUSxRQUFBQSxNQUFNLEVBQUUsSUFBVDtBQUFlQyxRQUFBQSxVQUFVLEVBQUU7QUFBM0IsT0FIVSxDQUFiO0FBSUQsS0FMRCxDQUtFLE9BQU9DLEdBQVAsRUFBWSxDQUFFO0FBQ2pCOztBQUNELFFBQU0sSUFBSUMsS0FBSixDQUFXLHdDQUFYLENBQU47QUFDRCxDQW5CRDs7QUFxQkEzQyxRQUFRLENBQUM0QyxvQkFBVCxHQUFnQyxlQUFlQSxvQkFBZixDQUFxQ0MsT0FBckMsRUFBOEM7QUFDNUUsTUFBSTtBQUFDQyxJQUFBQSxVQUFEO0FBQWFDLElBQUFBO0FBQWIsTUFBNEIsTUFBTSxLQUFLM0IsR0FBTCxDQUFTNEIsNEJBQVQsRUFBdEM7QUFDQSxRQUFNLEtBQUs1QixHQUFMLENBQVNDLEtBQVQsQ0FBZSxDQUFDLElBQUQsRUFBTyxPQUFQLEVBQWdCLElBQWhCLEVBQXVCLG9CQUFtQndCLE9BQVEsRUFBbEQsQ0FBZixDQUFOO0FBQ0EsUUFBTSxLQUFLekIsR0FBTCxDQUFTNkIsa0JBQVQsQ0FBNEJILFVBQTVCLEVBQXdDQyxXQUF4QyxFQUFxRCxJQUFyRCxDQUFOO0FBQ0QsQ0FKRDs7QUFNQS9DLFFBQVEsQ0FBQ2tELGFBQVQsR0FBeUIsZUFBZUEsYUFBZixHQUFnQztBQUN2RCxTQUFPLE1BQU0sS0FBS3JDLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixlQUExQixDQUFiO0FBQ0QsQ0FGRDs7QUFLQWQsUUFBUSxDQUFDbUQsYUFBVCxHQUF5QixlQUFlQSxhQUFmLEdBQWdDO0FBQ3ZELFFBQU07QUFBRUMsSUFBQUEsS0FBRjtBQUFTQyxJQUFBQTtBQUFULE1BQW9CLE1BQU0sS0FBS0gsYUFBTCxFQUFoQztBQUNBLFNBQU87QUFDTEUsSUFBQUEsS0FESztBQUVMQyxJQUFBQSxNQUZLO0FBR0xDLElBQUFBLENBQUMsRUFBRSxDQUhFO0FBSUxDLElBQUFBLENBQUMsRUFBRTtBQUpFLEdBQVA7QUFNRCxDQVJEOztBQVVBdkQsUUFBUSxDQUFDd0Qsa0JBQVQsR0FBOEIsZUFBZUEsa0JBQWYsR0FBcUM7QUFDakUsU0FBTyxDQUFDLE1BQU0sS0FBS3BDLEdBQUwsQ0FBUzRCLDRCQUFULEVBQVAsRUFBZ0RELFdBQXZEO0FBQ0QsQ0FGRDs7QUFJQS9DLFFBQVEsQ0FBQ3lELGlCQUFULEdBQTZCLGVBQWVBLGlCQUFmLEdBQW9DO0FBQy9ELFNBQU8sQ0FBQyxNQUFNLEtBQUtyQyxHQUFMLENBQVM0Qiw0QkFBVCxFQUFQLEVBQWdERixVQUF2RDtBQUNELENBRkQ7O0FBSUE5QyxRQUFRLENBQUMwRCxVQUFULEdBQXNCLGVBQWVBLFVBQWYsQ0FBMkJDLE9BQTNCLEVBQW9DO0FBQ3hELE1BQUlBLE9BQU8sR0FBRyxDQUFkLEVBQWlCO0FBR2YsVUFBTSxLQUFLdkMsR0FBTCxDQUFTd0MsUUFBVCxFQUFOO0FBQ0EsV0FBTyxJQUFQO0FBQ0Q7O0FBQ0QsTUFBSTtBQUFDZCxJQUFBQSxVQUFEO0FBQWFDLElBQUFBO0FBQWIsTUFBNEIsTUFBTSxLQUFLM0IsR0FBTCxDQUFTNEIsNEJBQVQsRUFBdEM7QUFDQSxRQUFNLEtBQUs1QixHQUFMLENBQVN3QyxRQUFULEVBQU47QUFDQSxRQUFNQyxrQkFBRUMsS0FBRixDQUFRSCxPQUFPLEdBQUcsSUFBbEIsQ0FBTjtBQUVBLE1BQUlJLElBQUo7O0FBQ0EsTUFBSSxLQUFLQyxtQkFBTCxJQUE0QixLQUFLQSxtQkFBTCxDQUEwQixHQUFFbEIsVUFBVyxJQUFHQyxXQUFZLEVBQXRELENBQWhDLEVBQTBGO0FBRXhGZ0IsSUFBQUEsSUFBSSxHQUFHLEtBQUtDLG1CQUFMLENBQTBCLEdBQUVsQixVQUFXLElBQUdDLFdBQVksRUFBdEQsQ0FBUDtBQUNELEdBSEQsTUFHTztBQUNMLFFBQUk7QUFDRjlCLHNCQUFJQyxLQUFKLENBQVcsbUJBQWtCNEIsVUFBVywwQkFBeEM7O0FBQ0EsWUFBTSxLQUFLbUIsV0FBTCxDQUFpQm5CLFVBQWpCLENBQU47QUFDQSxhQUFPLElBQVA7QUFDRCxLQUpELENBSUUsT0FBT0osR0FBUCxFQUFZLENBQUU7O0FBQ2hCcUIsSUFBQUEsSUFBSSxHQUFLakIsVUFBVSxLQUFLLEtBQUtwQyxJQUFMLENBQVVvQyxVQUF6QixJQUF1Q0MsV0FBVyxLQUFLLEtBQUtyQyxJQUFMLENBQVVxQyxXQUFsRSxJQUNDRCxVQUFVLEtBQUssS0FBS3BDLElBQUwsQ0FBVXdELGNBQXpCLElBQTJDLENBQUMsS0FBS3hELElBQUwsQ0FBVXlELGVBQVYsSUFBNkIsRUFBOUIsRUFBa0NDLEtBQWxDLENBQXdDLEdBQXhDLEVBQTZDQyxRQUE3QyxDQUFzRHRCLFdBQXRELENBRDdDLEdBRUg7QUFDQXVCLE1BQUFBLEdBQUcsRUFBRSxLQUFLNUQsSUFBTCxDQUFVb0MsVUFEZjtBQUVBeUIsTUFBQUEsUUFBUSxFQUFFLEtBQUs3RCxJQUFMLENBQVVxQyxXQUZwQjtBQUdBeUIsTUFBQUEsTUFBTSxFQUFFLEtBQUs5RCxJQUFMLENBQVUrRCxZQUhsQjtBQUlBQyxNQUFBQSxRQUFRLEVBQUUsS0FBS2hFLElBQUwsQ0FBVWlFLGNBSnBCO0FBS0FDLE1BQUFBLEtBQUssRUFBRSxLQUFLbEUsSUFBTCxDQUFVbUUsV0FMakI7QUFNQUMsTUFBQUEsT0FBTyxFQUFFLEtBQUtwRSxJQUFMLENBQVV3RCxjQU5uQjtBQU9BYSxNQUFBQSxZQUFZLEVBQUUsS0FBS3JFLElBQUwsQ0FBVXlELGVBUHhCO0FBUUFhLE1BQUFBLGFBQWEsRUFBRSxLQUFLdEUsSUFBTCxDQUFVdUUsZ0JBUnpCO0FBU0FDLE1BQUFBLHVCQUF1QixFQUFFLEtBQUt4RSxJQUFMLENBQVV3RSx1QkFUbkM7QUFVQUMsTUFBQUEsT0FBTyxFQUFFLEtBVlQ7QUFXQUMsTUFBQUEsSUFBSSxFQUFFLEtBQUsxRSxJQUFMLENBQVUyRTtBQVhoQixLQUZHLEdBY0g7QUFDQWYsTUFBQUEsR0FBRyxFQUFFeEIsVUFETDtBQUVBeUIsTUFBQUEsUUFBUSxFQUFFeEIsV0FGVjtBQUdBK0IsTUFBQUEsT0FBTyxFQUFFaEMsVUFIVDtBQUlBaUMsTUFBQUEsWUFBWSxFQUFFaEMsV0FKZDtBQUtBb0MsTUFBQUEsT0FBTyxFQUFFO0FBTFQsS0FkSjtBQW9CRDs7QUFDRHBCLEVBQUFBLElBQUksR0FBRyxNQUFNdUIsb0JBQUtDLFlBQUwsQ0FBa0J4QixJQUFsQixDQUFiOztBQUNBOUMsa0JBQUlDLEtBQUosQ0FBVywyREFBMERzRSxJQUFJLENBQUNDLFNBQUwsQ0FBZTFCLElBQWYsQ0FBcUIsRUFBMUY7O0FBQ0EsU0FBTyxNQUFNLEtBQUszQyxHQUFMLENBQVNzRSxRQUFULENBQWtCM0IsSUFBbEIsQ0FBYjtBQUNELENBN0NEOztBQStDQS9ELFFBQVEsQ0FBQzJGLFVBQVQsR0FBc0IsZUFBZUEsVUFBZixDQUEyQkMsUUFBM0IsRUFBcUM7QUFDekQsTUFBSSxDQUFDQSxRQUFMLEVBQWU7QUFDYkEsSUFBQUEsUUFBUSxHQUFHLE1BQU0sS0FBS3hFLEdBQUwsQ0FBU3lFLGlCQUFULEVBQWpCOztBQUNBNUUsb0JBQUlvQixJQUFKLENBQVUsaURBQWdEdUQsUUFBUyxFQUFuRTtBQUNEOztBQUlELFFBQU1FLG9CQUFvQixHQUFJQyxPQUFELElBQWE7QUFDeEMsVUFBTUMsTUFBTSxHQUFHLEVBQWY7O0FBQ0EsU0FBSyxNQUFNLENBQUNDLEdBQUQsRUFBTUMsS0FBTixDQUFYLElBQTJCOUYsZ0JBQUUrRixPQUFGLENBQVVKLE9BQVYsQ0FBM0IsRUFBK0M7QUFDN0NDLE1BQUFBLE1BQU0sQ0FBQ0MsR0FBRCxDQUFOLEdBQWM3RixnQkFBRWdHLFFBQUYsQ0FBV0YsS0FBWCxJQUFvQkEsS0FBcEIsR0FBNEJWLElBQUksQ0FBQ0MsU0FBTCxDQUFlUyxLQUFmLENBQTFDO0FBQ0Q7O0FBQ0QsV0FBT0YsTUFBUDtBQUNELEdBTkQ7O0FBUUEsTUFBSSxLQUFLSyxVQUFMLENBQWdCVCxRQUFoQixDQUFKLEVBQStCO0FBRTdCLFdBQU9FLG9CQUFvQixDQUFDLEtBQUtPLFVBQUwsQ0FBZ0JULFFBQWhCLENBQUQsQ0FBM0I7QUFDRDs7QUFFRCxPQUFLUyxVQUFMLENBQWdCVCxRQUFoQixJQUE0QixNQUFNVSx3QkFBZUMsV0FBZixDQUEyQlgsUUFBM0IsRUFBcUMsS0FBS3hFLEdBQTFDLEVBQStDLEtBQUtWLElBQXBELENBQWxDOztBQUNBLE1BQUksS0FBS0csU0FBVCxFQUFvQjtBQUVsQixVQUFNLEtBQUtBLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixlQUExQixDQUFOO0FBQ0Q7O0FBRUQsU0FBT2dGLG9CQUFvQixDQUFDLEtBQUtPLFVBQUwsQ0FBZ0JULFFBQWhCLENBQUQsQ0FBM0I7QUFDRCxDQTVCRDs7QUE4QkE1RixRQUFRLENBQUN3RyxTQUFULEdBQXFCLGVBQWVBLFNBQWYsR0FBNEI7QUFDL0MsUUFBTSxLQUFLQyxPQUFMLEVBQU47QUFDQSxRQUFNLEtBQUtDLFFBQUwsRUFBTjtBQUNELENBSEQ7O0FBS0ExRyxRQUFRLENBQUMyRyxhQUFULEdBQXlCLGVBQWVBLGFBQWYsQ0FBOEI3RCxVQUE5QixFQUEwQ0MsV0FBMUMsRUFDdkJtQixjQUR1QixFQUNQQyxlQURPLEVBQ1VNLFlBRFYsRUFDd0JFLGNBRHhCLEVBQ3dDRSxXQUR4QyxFQUV2QkssdUJBRnVCLEVBRUUwQixrQkFGRixFQUVzQjtBQUM3QzNGLGtCQUFJQyxLQUFKLENBQVcscUJBQW9CNEIsVUFBVyxtQkFBa0JDLFdBQVksR0FBeEU7O0FBSUEsTUFBSSxDQUFDdUMsb0JBQUt1QixRQUFMLENBQWNELGtCQUFkLENBQUwsRUFBd0M7QUFDdENBLElBQUFBLGtCQUFrQixHQUFHLENBQUMsQ0FBQyxLQUFLbEcsSUFBTCxDQUFVa0csa0JBQWpDO0FBQ0Q7O0FBRUQsTUFBSTdDLElBQUksR0FBRztBQUNUTyxJQUFBQSxHQUFHLEVBQUV4QixVQURJO0FBRVR5QixJQUFBQSxRQUFRLEVBQUV4QixXQUZEO0FBR1QrQixJQUFBQSxPQUFPLEVBQUVaLGNBQWMsSUFBSXBCLFVBSGxCO0FBSVRpQyxJQUFBQSxZQUFZLEVBQUVaLGVBQWUsSUFBSXBCLFdBSnhCO0FBS1R5QixJQUFBQSxNQUFNLEVBQUVDLFlBTEM7QUFNVEMsSUFBQUEsUUFBUSxFQUFFQyxjQU5EO0FBT1RDLElBQUFBLEtBQUssRUFBRUMsV0FQRTtBQVFUSyxJQUFBQSx1QkFSUztBQVNUQyxJQUFBQSxPQUFPLEVBQUUsQ0FBQ3lCO0FBVEQsR0FBWDtBQVdBLE9BQUs1QyxtQkFBTCxHQUEyQixLQUFLQSxtQkFBTCxJQUE0QixFQUF2RDtBQUNBLE9BQUtBLG1CQUFMLENBQTBCLEdBQUVELElBQUksQ0FBQ2UsT0FBUSxJQUFHZixJQUFJLENBQUNnQixZQUFhLEVBQTlELElBQW1FaEIsSUFBbkU7QUFDQSxRQUFNLEtBQUszQyxHQUFMLENBQVNzRSxRQUFULENBQWtCM0IsSUFBbEIsQ0FBTjtBQUNELENBekJEOztBQTJCQS9ELFFBQVEsQ0FBQzhHLEtBQVQsR0FBaUIsZUFBZUEsS0FBZixHQUF3QjtBQUN2QyxRQUFNUix3QkFBZVMsUUFBZixDQUF3QixLQUFLM0YsR0FBN0IsRUFBa0M0RixNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCLEtBQUt2RyxJQUF2QixFQUE2QjtBQUFDd0csSUFBQUEsU0FBUyxFQUFFO0FBQVosR0FBN0IsQ0FBbEMsQ0FBTjtBQUVBLFFBQU0sS0FBS0MsVUFBTCxFQUFOO0FBQ0EsU0FBTyxPQUFNLEtBQUtDLGVBQVgsSUFBNkIsS0FBS0Msa0JBQUwsRUFBN0IsR0FBeUQsS0FBS1gsUUFBTCxFQUFoRTtBQUNELENBTEQ7O0FBT0ExRyxRQUFRLENBQUMwRyxRQUFULEdBQW9CLGVBQWVBLFFBQWYsR0FBMkI7QUFDN0MsUUFBTSxLQUFLdEYsR0FBTCxDQUFTc0UsUUFBVCxDQUFrQjtBQUN0QnBCLElBQUFBLEdBQUcsRUFBRSxLQUFLNUQsSUFBTCxDQUFVb0MsVUFETztBQUV0QnlCLElBQUFBLFFBQVEsRUFBRSxLQUFLN0QsSUFBTCxDQUFVcUMsV0FGRTtBQUd0QnlCLElBQUFBLE1BQU0sRUFBRSxLQUFLOUQsSUFBTCxDQUFVK0QsWUFISTtBQUl0QkMsSUFBQUEsUUFBUSxFQUFFLEtBQUtoRSxJQUFMLENBQVVpRSxjQUpFO0FBS3RCQyxJQUFBQSxLQUFLLEVBQUUsS0FBS2xFLElBQUwsQ0FBVW1FLFdBTEs7QUFNdEJDLElBQUFBLE9BQU8sRUFBRSxLQUFLcEUsSUFBTCxDQUFVd0QsY0FORztBQU90QmEsSUFBQUEsWUFBWSxFQUFFLEtBQUtyRSxJQUFMLENBQVV5RCxlQVBGO0FBUXRCbUQsSUFBQUEsWUFBWSxFQUFFLEtBQUs1RyxJQUFMLENBQVU2RyxlQVJGO0FBU3RCckMsSUFBQUEsdUJBQXVCLEVBQUUsS0FBS3hFLElBQUwsQ0FBVXdFLHVCQVRiO0FBVXRCQyxJQUFBQSxPQUFPLEVBQUUsQ0FBQyxLQUFLekUsSUFBTCxDQUFVa0csa0JBVkU7QUFXdEJ4QixJQUFBQSxJQUFJLEVBQUUsS0FBSzFFLElBQUwsQ0FBVTJFO0FBWE0sR0FBbEIsQ0FBTjtBQWFELENBZEQ7O0FBa0JBckYsUUFBUSxDQUFDd0gsTUFBVCxHQUFrQixlQUFlQSxNQUFmLENBQXVCQyxHQUF2QixFQUE0QjtBQUM1QyxRQUFNLEtBQUtyRyxHQUFMLENBQVNzRyxRQUFULENBQWtCRCxHQUFsQixFQUF1QixLQUFLL0csSUFBTCxDQUFVb0MsVUFBakMsQ0FBTjtBQUNELENBRkQ7O0FBS0E5QyxRQUFRLENBQUMySCxRQUFULEdBQW9CLGVBQWVBLFFBQWYsR0FBMkI7QUFDN0MsUUFBTSxLQUFLdkcsR0FBTCxDQUFTd0csU0FBVCxDQUFtQixLQUFLbEgsSUFBTCxDQUFVb0MsVUFBN0IsQ0FBTjtBQUVBLFFBQU0sS0FBS3FFLFVBQUwsRUFBTjtBQUNELENBSkQ7O0FBTUFuSCxRQUFRLENBQUM2SCxpQkFBVCxHQUE2QixlQUFlQSxpQkFBZixHQUFvQztBQUUvRCxNQUFJQyxHQUFHLEdBQUcsTUFBTSxLQUFLMUcsR0FBTCxDQUFTQyxLQUFULENBQWUsQ0FBQyxTQUFELEVBQVksbUJBQVosQ0FBZixDQUFoQjs7QUFDQSxNQUFJeUcsR0FBSixFQUFTO0FBQ1AsUUFBSUMsR0FBRyxHQUFHQyxRQUFRLENBQUNGLEdBQUQsRUFBTSxFQUFOLENBQWxCOztBQUVBLFFBQUksQ0FBQ0csS0FBSyxDQUFDRixHQUFELENBQVYsRUFBaUI7QUFDZixhQUFPQSxHQUFQO0FBQ0Q7O0FBQ0Q5RyxvQkFBSUMsS0FBSixDQUFXLGtDQUFpQzRHLEdBQUksR0FBaEQ7QUFDRDs7QUFFREEsRUFBQUEsR0FBRyxHQUFHLE1BQU0sS0FBSzFHLEdBQUwsQ0FBU0MsS0FBVCxDQUFlLENBQUMsU0FBRCxFQUFZLHFCQUFaLENBQWYsQ0FBWjs7QUFDQSxNQUFJeUcsR0FBSixFQUFTO0FBQ1AsUUFBSUMsR0FBRyxHQUFHQyxRQUFRLENBQUNGLEdBQUQsRUFBTSxFQUFOLENBQWxCOztBQUNBLFFBQUksQ0FBQ0csS0FBSyxDQUFDRixHQUFELENBQVYsRUFBaUI7QUFDZixhQUFPQSxHQUFQO0FBQ0Q7O0FBQ0Q5RyxvQkFBSUMsS0FBSixDQUFXLGtDQUFpQzRHLEdBQUksR0FBaEQ7QUFDRDs7QUFFRDdHLGtCQUFJaUgsYUFBSixDQUFrQix5Q0FBbEI7QUFDRCxDQXRCRDs7QUE2QkEsU0FBU0MsZ0JBQVQsQ0FBMkJDLElBQTNCLEVBQWlDO0FBSy9CLE1BQUlDLE1BQU0sR0FBR0QsSUFBSSxDQUFDaEUsS0FBTCxDQUFXLE9BQVgsRUFBb0IsQ0FBcEIsRUFDWjNELE9BRFksQ0FDSixXQURJLEVBQ1MsR0FEVCxFQUVaYSxJQUZZLEdBR1o4QyxLQUhZLENBR04sR0FITSxDQUFiO0FBS0EsU0FBTztBQUNMa0UsSUFBQUEsT0FBTyxFQUFHRixJQUFJLENBQUNHLE9BQUwsQ0FBYSxZQUFiLE1BQStCLENBQUMsQ0FEckM7QUFFTGpGLElBQUFBLENBQUMsRUFBRWtGLFVBQVUsQ0FBQ0gsTUFBTSxDQUFDLENBQUQsQ0FBUCxDQUZSO0FBR0w5RSxJQUFBQSxDQUFDLEVBQUVpRixVQUFVLENBQUNILE1BQU0sQ0FBQyxDQUFELENBQVAsQ0FIUjtBQUlMakYsSUFBQUEsS0FBSyxFQUFFb0YsVUFBVSxDQUFDSCxNQUFNLENBQUMsQ0FBRCxDQUFQLENBSlo7QUFLTGhGLElBQUFBLE1BQU0sRUFBRW1GLFVBQVUsQ0FBQ0gsTUFBTSxDQUFDLENBQUQsQ0FBUDtBQUxiLEdBQVA7QUFPRDs7QUFPRCxTQUFTSSxZQUFULENBQXVCQyxLQUF2QixFQUE4QjtBQUM1QixNQUFJQyxXQUFXLEdBQUcsS0FBbEI7QUFDQSxNQUFJQyxRQUFRLEdBQUcsS0FBZjtBQUNBLE1BQUlDLFNBQUo7QUFDQSxNQUFJQyxhQUFKO0FBTUFKLEVBQUFBLEtBQUssQ0FBQ3RFLEtBQU4sQ0FBWSxJQUFaLEVBQWtCMkUsT0FBbEIsQ0FBMkJYLElBQUQsSUFBVTtBQUVsQyxRQUFJQSxJQUFJLENBQUNHLE9BQUwsQ0FBYSxZQUFiLE1BQStCLENBQUMsQ0FBcEMsRUFBdUM7QUFHckNJLE1BQUFBLFdBQVcsR0FBSVAsSUFBSSxDQUFDRyxPQUFMLENBQWEsV0FBYixNQUE4QixDQUFDLENBQTlDO0FBQ0FLLE1BQUFBLFFBQVEsR0FBSVIsSUFBSSxDQUFDRyxPQUFMLENBQWEsZUFBYixNQUFrQyxDQUFDLENBQS9DO0FBRUE7QUFDRDs7QUFFRCxRQUFJSCxJQUFJLENBQUNHLE9BQUwsQ0FBYSxnQkFBYixNQUFtQyxDQUFDLENBQXhDLEVBQTJDO0FBQ3pDO0FBQ0Q7O0FBQ0QsUUFBSUksV0FBSixFQUFpQjtBQUNmRSxNQUFBQSxTQUFTLEdBQUdWLGdCQUFnQixDQUFDQyxJQUFELENBQTVCO0FBQ0FPLE1BQUFBLFdBQVcsR0FBRyxLQUFkO0FBQ0QsS0FIRCxNQUdPLElBQUlDLFFBQUosRUFBYztBQUNuQkUsTUFBQUEsYUFBYSxHQUFHWCxnQkFBZ0IsQ0FBQ0MsSUFBRCxDQUFoQztBQUNBUSxNQUFBQSxRQUFRLEdBQUcsS0FBWDtBQUNEO0FBQ0YsR0FyQkQ7O0FBdUJBLE1BQUksQ0FBQ0MsU0FBTCxFQUFnQjtBQUNkNUgsb0JBQUlpSCxhQUFKLENBQWtCLHlDQUFsQjtBQUNEOztBQUNELE1BQUksQ0FBQ1ksYUFBTCxFQUFvQjtBQUNsQjdILG9CQUFJaUgsYUFBSixDQUFrQiw2Q0FBbEI7QUFDRDs7QUFFRCxTQUFPO0FBQUNXLElBQUFBLFNBQUQ7QUFBWUMsSUFBQUE7QUFBWixHQUFQO0FBQ0Q7O0FBRUQ5SSxRQUFRLENBQUNnSixhQUFULEdBQXlCLGVBQWVBLGFBQWYsR0FBZ0M7QUFDdkQsTUFBSWxCLEdBQUcsR0FBRyxNQUFNLEtBQUsxRyxHQUFMLENBQVNDLEtBQVQsQ0FBZSxDQUFDLFNBQUQsRUFBWSxRQUFaLEVBQXNCLFNBQXRCLENBQWYsQ0FBaEI7O0FBQ0EsTUFBSSxDQUFDeUcsR0FBTCxFQUFVO0FBQ1I3RyxvQkFBSWlILGFBQUosQ0FBa0Isb0NBQWxCO0FBQ0Q7O0FBQ0QsU0FBT08sWUFBWSxDQUFDWCxHQUFELENBQW5CO0FBQ0QsQ0FORDs7QUFRQTlILFFBQVEsQ0FBQ2lKLHlCQUFULEdBQXFDLGVBQWVBLHlCQUFmLENBQTBDdkksSUFBSSxHQUFHLEVBQWpELEVBQXFEO0FBQ3hGLFFBQU07QUFBQzhELElBQUFBO0FBQUQsTUFBVzlELElBQWpCOztBQUNBLE1BQUksQ0FBQzRFLG9CQUFLdUIsUUFBTCxDQUFjckMsTUFBZCxDQUFMLEVBQTRCO0FBQzFCdkQsb0JBQUlpSCxhQUFKLENBQW1CLCtCQUFuQjtBQUNEOztBQUVELFFBQU0sS0FBSzlHLEdBQUwsQ0FBUzhILG1CQUFULENBQTZCMUUsTUFBN0IsQ0FBTjtBQUNELENBUEQ7O0FBU0EsTUFBTTJFLGlCQUFpQixHQUFHO0FBQ3hCQyxFQUFBQSxLQUFLLEVBQUUsT0FEaUI7QUFFeEJDLEVBQUFBLE1BQU0sRUFBRTtBQUZnQixDQUExQjs7QUFvQkFySixRQUFRLENBQUNzSix1QkFBVCxHQUFtQyxlQUFlQSx1QkFBZixDQUF3QzVJLElBQUksR0FBRyxFQUEvQyxFQUFtRDtBQUNwRixRQUFNO0FBQ0o2SSxJQUFBQSxXQURJO0FBRUp6RyxJQUFBQSxVQUFVLEdBQUcsS0FBS3BDLElBQUwsQ0FBVW9DLFVBRm5CO0FBR0owQixJQUFBQSxNQUFNLEdBQUcyRSxpQkFBaUIsQ0FBQ0M7QUFIdkIsTUFJRjFJLElBSko7O0FBS0EsTUFBSSxDQUFDNEUsb0JBQUt1QixRQUFMLENBQWMwQyxXQUFkLENBQUwsRUFBaUM7QUFDL0J0SSxvQkFBSWlILGFBQUosQ0FBbUIsb0NBQW5CO0FBQ0Q7O0FBRUQsTUFBSXNCLFVBQUo7O0FBQ0EsVUFBUXBKLGdCQUFFcUosT0FBRixDQUFVakYsTUFBVixDQUFSO0FBQ0UsU0FBSzJFLGlCQUFpQixDQUFDQyxLQUF2QjtBQUNFSSxNQUFBQSxVQUFVLEdBQUcsQ0FBQzFHLFVBQUQsRUFBYTRHLFVBQWIsS0FBNEIsS0FBS3RJLEdBQUwsQ0FBU3VJLGVBQVQsQ0FBeUI3RyxVQUF6QixFQUFxQzRHLFVBQXJDLENBQXpDOztBQUNBOztBQUNGLFNBQUtQLGlCQUFpQixDQUFDRSxNQUF2QjtBQUNFRyxNQUFBQSxVQUFVLEdBQUcsQ0FBQzFHLFVBQUQsRUFBYTRHLFVBQWIsS0FBNEIsS0FBS3RJLEdBQUwsQ0FBU3dJLGdCQUFULENBQTBCOUcsVUFBMUIsRUFBc0M0RyxVQUF0QyxDQUF6Qzs7QUFDQTs7QUFDRjtBQUNFekksc0JBQUlpSCxhQUFKLENBQW1CLG1CQUFrQjFELE1BQU8sS0FBMUIsR0FDZixRQUFPZ0IsSUFBSSxDQUFDQyxTQUFMLENBQWVyRixnQkFBRXlKLE1BQUYsQ0FBU1YsaUJBQVQsQ0FBZixDQUE0Qyx3QkFEdEQ7O0FBRUE7QUFWSjs7QUFZQSxPQUFLLE1BQU1PLFVBQVgsSUFBMEJ0SixnQkFBRUMsT0FBRixDQUFVa0osV0FBVixJQUF5QkEsV0FBekIsR0FBdUMsQ0FBQ0EsV0FBRCxDQUFqRSxFQUFpRjtBQUMvRSxVQUFNQyxVQUFVLENBQUMxRyxVQUFELEVBQWE0RyxVQUFiLENBQWhCO0FBQ0Q7QUFDRixDQTFCRDs7QUE0QkEsTUFBTUksZ0JBQWdCLEdBQUc7QUFDdkJDLEVBQUFBLE1BQU0sRUFBRSxRQURlO0FBRXZCQyxFQUFBQSxPQUFPLEVBQUUsU0FGYztBQUd2QkMsRUFBQUEsU0FBUyxFQUFFO0FBSFksQ0FBekI7O0FBc0JBakssUUFBUSxDQUFDa0ssb0JBQVQsR0FBZ0MsZUFBZUEsb0JBQWYsQ0FBcUN4SixJQUFJLEdBQUcsRUFBNUMsRUFBZ0Q7QUFDOUUsUUFBTTtBQUNKeUosSUFBQUEsSUFBSSxHQUFHTCxnQkFBZ0IsQ0FBQ0csU0FEcEI7QUFFSm5ILElBQUFBLFVBQVUsR0FBRyxLQUFLcEMsSUFBTCxDQUFVb0M7QUFGbkIsTUFHRnBDLElBSEo7QUFLQSxNQUFJOEksVUFBSjs7QUFDQSxVQUFRcEosZ0JBQUVxSixPQUFGLENBQVVVLElBQVYsQ0FBUjtBQUNFLFNBQUtMLGdCQUFnQixDQUFDRyxTQUF0QjtBQUNFVCxNQUFBQSxVQUFVLEdBQUkxRyxVQUFELElBQWdCLEtBQUsxQixHQUFMLENBQVNnSixpQkFBVCxDQUEyQnRILFVBQTNCLENBQTdCOztBQUNBOztBQUNGLFNBQUtnSCxnQkFBZ0IsQ0FBQ0UsT0FBdEI7QUFDRVIsTUFBQUEsVUFBVSxHQUFJMUcsVUFBRCxJQUFnQixLQUFLMUIsR0FBTCxDQUFTaUoscUJBQVQsQ0FBK0J2SCxVQUEvQixDQUE3Qjs7QUFDQTs7QUFDRixTQUFLZ0gsZ0JBQWdCLENBQUNDLE1BQXRCO0FBQ0VQLE1BQUFBLFVBQVUsR0FBSTFHLFVBQUQsSUFBZ0IsS0FBSzFCLEdBQUwsQ0FBU2tKLG9CQUFULENBQThCeEgsVUFBOUIsQ0FBN0I7O0FBQ0E7O0FBQ0Y7QUFDRTdCLHNCQUFJaUgsYUFBSixDQUFtQiw2QkFBNEJpQyxJQUFLLEtBQWxDLEdBQ2YsUUFBTzNFLElBQUksQ0FBQ0MsU0FBTCxDQUFlckYsZ0JBQUV5SixNQUFGLENBQVNDLGdCQUFULENBQWYsQ0FBMkMsc0JBRHJEOztBQUVBO0FBYko7O0FBZUEsU0FBTyxNQUFNTixVQUFVLENBQUMxRyxVQUFELENBQXZCO0FBQ0QsQ0F2QkQ7O0FBeUJBa0UsTUFBTSxDQUFDQyxNQUFQLENBQWMvRyxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgYW5kcm9pZEhlbHBlcnMgZnJvbSAnLi4vYW5kcm9pZC1oZWxwZXJzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmtleXMgPSBhc3luYyBmdW5jdGlvbiBrZXlzIChrZXlzKSB7XG4gIC8vIFByb3RvY29sIHNlbmRzIGFuIGFycmF5OyByZXRoaW5rIGFwcHJvYWNoXG4gIGtleXMgPSBfLmlzQXJyYXkoa2V5cykgPyBrZXlzLmpvaW4oJycpIDoga2V5cztcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICB0ZXh0OiBrZXlzLFxuICAgIHJlcGxhY2U6IGZhbHNlXG4gIH07XG4gIGlmICh0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkKSB7XG4gICAgcGFyYW1zLnVuaWNvZGVLZXlib2FyZCA9IHRydWU7XG4gIH1cbiAgYXdhaXQgdGhpcy5kb1NlbmRLZXlzKHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy5kb1NlbmRLZXlzID0gYXN5bmMgZnVuY3Rpb24gZG9TZW5kS2V5cyAocGFyYW1zKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdzZXRUZXh0JywgcGFyYW1zKTtcbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGRldmljZSdzIHRpbWVzdGFtcC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZm9ybWF0IC0gVGhlIHNldCBvZiBmb3JtYXQgc3BlY2lmaWVycy4gUmVhZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vbW9tZW50anMuY29tL2RvY3MvIHRvIGdldCB0aGUgZnVsbCBsaXN0IG9mIHN1cHBvcnRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lIGZvcm1hdCBzcGVjaWZpZXJzLiBUaGUgZGVmYXVsdCBmb3JtYXQgaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBgWVlZWS1NTS1ERFRISDptbTpzc1pgLCB3aGljaCBjb21wbGllcyB0byBJU08tODYwMVxuICogQHJldHVybnMgRm9ybWF0dGVkIGRhdGV0aW1lIHN0cmluZyBvciB0aGUgcmF3IGNvbW1hbmQgb3V0cHV0IGlmIGZvcm1hdHRpbmcgZmFpbHNcbiAqL1xuY29tbWFuZHMuZ2V0RGV2aWNlVGltZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZVRpbWUgKGZvcm1hdCA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWicpIHtcbiAgbG9nLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGNhcHR1cmUgYW5kcm9pZCBkZXZpY2UgZGF0ZSBhbmQgdGltZS4gJyArXG4gICAgYFRoZSBmb3JtYXQgc3BlY2lmaWVyIGlzICcke2Zvcm1hdH0nYCk7XG4gIGNvbnN0IGRldmljZVRpbWVzdGFtcCA9IChhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2RhdGUnLCAnKyVZLSVtLSVkVCVUJXonXSkpLnRyaW0oKTtcbiAgbG9nLmRlYnVnKGBHb3QgZGV2aWNlIHRpbWVzdGFtcDogJHtkZXZpY2VUaW1lc3RhbXB9YCk7XG4gIGNvbnN0IHBhcnNlZFRpbWVzdGFtcCA9IG1vbWVudC51dGMoZGV2aWNlVGltZXN0YW1wLCAnWVlZWS1NTS1ERFRISDptbTpzc1paJyk7XG4gIGlmICghcGFyc2VkVGltZXN0YW1wLmlzVmFsaWQoKSkge1xuICAgIGxvZy53YXJuKCdDYW5ub3QgcGFyc2UgdGhlIHJldHVybmVkIHRpbWVzdGFtcC4gUmV0dXJuaW5nIGFzIGlzJyk7XG4gICAgcmV0dXJuIGRldmljZVRpbWVzdGFtcDtcbiAgfVxuICByZXR1cm4gcGFyc2VkVGltZXN0YW1wLnV0Y09mZnNldChwYXJzZWRUaW1lc3RhbXAuX3R6bSB8fCAwKS5mb3JtYXQoZm9ybWF0KTtcbn07XG5cbmNvbW1hbmRzLmdldFBhZ2VTb3VyY2UgPSBhc3luYyBmdW5jdGlvbiBnZXRQYWdlU291cmNlICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3NvdXJjZScpO1xufTtcblxuY29tbWFuZHMuYmFjayA9IGFzeW5jIGZ1bmN0aW9uIGJhY2sgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigncHJlc3NCYWNrJyk7XG59O1xuXG5jb21tYW5kcy5pc0tleWJvYXJkU2hvd24gPSBhc3luYyBmdW5jdGlvbiBpc0tleWJvYXJkU2hvd24gKCkge1xuICBsZXQga2V5Ym9hcmRJbmZvID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIHJldHVybiBrZXlib2FyZEluZm8uaXNLZXlib2FyZFNob3duO1xufTtcblxuY29tbWFuZHMuaGlkZUtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gaGlkZUtleWJvYXJkICgpIHtcbiAgbGV0IHtpc0tleWJvYXJkU2hvd24sIGNhbkNsb3NlS2V5Ym9hcmR9ID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIGlmICghaXNLZXlib2FyZFNob3duKSB7XG4gICAgbG9nLmluZm8oJ0tleWJvYXJkIGhhcyBubyBVSTsgbm8gY2xvc2luZyBuZWNlc3NhcnknKTtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gVHJ5IEVTQyB0aGVuIEJBQ0sgaWYgdGhlIGZpcnN0IG9uZSBmYWlsc1xuICBmb3IgKGNvbnN0IGtleUNvZGUgb2YgWzExMSwgNF0pIHtcbiAgICBpZiAoY2FuQ2xvc2VLZXlib2FyZCkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIua2V5ZXZlbnQoa2V5Q29kZSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgICh7aXNLZXlib2FyZFNob3dufSA9IGF3YWl0IHRoaXMuYWRiLmlzU29mdEtleWJvYXJkUHJlc2VudCgpKTtcbiAgICAgICAgcmV0dXJuICFpc0tleWJvYXJkU2hvd247XG4gICAgICB9LCB7d2FpdE1zOiAxMDAwLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc29mdHdhcmUga2V5Ym9hcmQgY2Fubm90IGJlIGNsb3NlZGApO1xufTtcblxuY29tbWFuZHMub3BlblNldHRpbmdzQWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiBvcGVuU2V0dGluZ3NBY3Rpdml0eSAoc2V0dGluZykge1xuICBsZXQge2FwcFBhY2thZ2UsIGFwcEFjdGl2aXR5fSA9IGF3YWl0IHRoaXMuYWRiLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKTtcbiAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydhbScsICdzdGFydCcsICctYScsIGBhbmRyb2lkLnNldHRpbmdzLiR7c2V0dGluZ31gXSk7XG4gIGF3YWl0IHRoaXMuYWRiLndhaXRGb3JOb3RBY3Rpdml0eShhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSwgNTAwMCk7XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dTaXplID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93U2l6ZSAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdnZXREZXZpY2VTaXplJyk7XG59O1xuXG4vLyBGb3IgVzNDXG5jb21tYW5kcy5nZXRXaW5kb3dSZWN0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93UmVjdCAoKSB7XG4gIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gYXdhaXQgdGhpcy5nZXRXaW5kb3dTaXplKCk7XG4gIHJldHVybiB7XG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICAgIHg6IDAsXG4gICAgeTogMFxuICB9O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudEFjdGl2aXR5ICgpIHtcbiAgcmV0dXJuIChhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCkpLmFwcEFjdGl2aXR5O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudFBhY2thZ2UgPSBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50UGFja2FnZSAoKSB7XG4gIHJldHVybiAoYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpKS5hcHBQYWNrYWdlO1xufTtcblxuY29tbWFuZHMuYmFja2dyb3VuZCA9IGFzeW5jIGZ1bmN0aW9uIGJhY2tncm91bmQgKHNlY29uZHMpIHtcbiAgaWYgKHNlY29uZHMgPCAwKSB7XG4gICAgLy8gaWYgdXNlciBwYXNzZXMgaW4gYSBuZWdhdGl2ZSBzZWNvbmRzIHZhbHVlLCBpbnRlcnByZXQgdGhhdCBhcyB0aGUgaW5zdHJ1Y3Rpb25cbiAgICAvLyB0byBub3QgYnJpbmcgdGhlIGFwcCBiYWNrIGF0IGFsbFxuICAgIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbGV0IHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gIGF3YWl0IEIuZGVsYXkoc2Vjb25kcyAqIDEwMDApO1xuXG4gIGxldCBhcmdzO1xuICBpZiAodGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzICYmIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdKSB7XG4gICAgLy8gdGhlIGFjdGl2aXR5IHdhcyBzdGFydGVkIHdpdGggYHN0YXJ0QWN0aXZpdHlgLCBzbyB1c2UgdGhvc2UgYXJncyB0byByZXN0YXJ0XG4gICAgYXJncyA9IHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBsb2cuZGVidWcoYEFjdGl2YXRpbmcgYXBwICcke2FwcFBhY2thZ2V9JyBpbiBvcmRlciB0byByZXN0b3JlIGl0YCk7XG4gICAgICBhd2FpdCB0aGlzLmFjdGl2YXRlQXBwKGFwcFBhY2thZ2UpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIGFyZ3MgPSAoKGFwcFBhY2thZ2UgPT09IHRoaXMub3B0cy5hcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5ID09PSB0aGlzLm9wdHMuYXBwQWN0aXZpdHkpIHx8XG4gICAgICAgICAgICAoYXBwUGFja2FnZSA9PT0gdGhpcy5vcHRzLmFwcFdhaXRQYWNrYWdlICYmICh0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5IHx8ICcnKS5zcGxpdCgnLCcpLmluY2x1ZGVzKGFwcEFjdGl2aXR5KSkpXG4gICAgICA/IHsvLyB0aGUgYWN0aXZpdHkgaXMgdGhlIG9yaWdpbmFsIHNlc3Npb24gYWN0aXZpdHksIHNvIHVzZSB0aGUgb3JpZ2luYWwgYXJnc1xuICAgICAgICBwa2c6IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgICAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgICAgIGNhdGVnb3J5OiB0aGlzLm9wdHMuaW50ZW50Q2F0ZWdvcnksXG4gICAgICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICAgICAgd2FpdEFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5LFxuICAgICAgICB3YWl0Rm9yTGF1bmNoOiB0aGlzLm9wdHMuYXBwV2FpdEZvckxhdW5jaCxcbiAgICAgICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHM6IHRoaXMub3B0cy5vcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICAgICAgc3RvcEFwcDogZmFsc2UsXG4gICAgICAgIHVzZXI6IHRoaXMub3B0cy51c2VyUHJvZmlsZX1cbiAgICAgIDogey8vIHRoZSBhY3Rpdml0eSB3YXMgc3RhcnRlZCBzb21lIG90aGVyIHdheSwgc28gdXNlIGRlZmF1bHRzXG4gICAgICAgIHBrZzogYXBwUGFja2FnZSxcbiAgICAgICAgYWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICB3YWl0UGtnOiBhcHBQYWNrYWdlLFxuICAgICAgICB3YWl0QWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICBzdG9wQXBwOiBmYWxzZX07XG4gIH1cbiAgYXJncyA9IGF3YWl0IHV0aWwuZmlsdGVyT2JqZWN0KGFyZ3MpO1xuICBsb2cuZGVidWcoYEJyaW5naW5nIGFwcGxpY2F0aW9uIGJhY2sgdG8gZm9yZWdyb3VuZCB3aXRoIGFyZ3VtZW50czogJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKGFyZ3MpO1xufTtcblxuY29tbWFuZHMuZ2V0U3RyaW5ncyA9IGFzeW5jIGZ1bmN0aW9uIGdldFN0cmluZ3MgKGxhbmd1YWdlKSB7XG4gIGlmICghbGFuZ3VhZ2UpIHtcbiAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuYWRiLmdldERldmljZUxhbmd1YWdlKCk7XG4gICAgbG9nLmluZm8oYE5vIGxhbmd1YWdlIHNwZWNpZmllZCwgcmV0dXJuaW5nIHN0cmluZ3MgZm9yOiAke2xhbmd1YWdlfWApO1xuICB9XG5cbiAgLy8gQ2xpZW50cyByZXF1aXJlIHRoZSByZXN1bHRpbmcgbWFwcGluZyB0byBoYXZlIGJvdGgga2V5c1xuICAvLyBhbmQgdmFsdWVzIG9mIHR5cGUgc3RyaW5nXG4gIGNvbnN0IHByZXByb2Nlc3NTdHJpbmdzTWFwID0gKG1hcHBpbmcpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMobWFwcGluZykpIHtcbiAgICAgIHJlc3VsdFtrZXldID0gXy5pc1N0cmluZyh2YWx1ZSkgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBpZiAodGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSkge1xuICAgIC8vIFJldHVybiBjYWNoZWQgc3RyaW5nc1xuICAgIHJldHVybiBwcmVwcm9jZXNzU3RyaW5nc01hcCh0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdKTtcbiAgfVxuXG4gIHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0gPSBhd2FpdCBhbmRyb2lkSGVscGVycy5wdXNoU3RyaW5ncyhsYW5ndWFnZSwgdGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gIGlmICh0aGlzLmJvb3RzdHJhcCkge1xuICAgIC8vIFRPRE86IFRoaXMgaXMgbXV0YXRpbmcgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UsIGJ1dCBpdCdzIGhvdyBhcHBpdW0gY3VycmVudGx5IHdvcmtzXG4gICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigndXBkYXRlU3RyaW5ncycpO1xuICB9XG5cbiAgcmV0dXJuIHByZXByb2Nlc3NTdHJpbmdzTWFwKHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0pO1xufTtcblxuY29tbWFuZHMubGF1bmNoQXBwID0gYXN5bmMgZnVuY3Rpb24gbGF1bmNoQXBwICgpIHtcbiAgYXdhaXQgdGhpcy5pbml0QVVUKCk7XG4gIGF3YWl0IHRoaXMuc3RhcnRBVVQoKTtcbn07XG5cbmNvbW1hbmRzLnN0YXJ0QWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiBzdGFydEFjdGl2aXR5IChhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSxcbiAgYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eSwgaW50ZW50QWN0aW9uLCBpbnRlbnRDYXRlZ29yeSwgaW50ZW50RmxhZ3MsXG4gIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLCBkb250U3RvcEFwcE9uUmVzZXQpIHtcbiAgbG9nLmRlYnVnKGBTdGFydGluZyBwYWNrYWdlICcke2FwcFBhY2thZ2V9JyBhbmQgYWN0aXZpdHkgJyR7YXBwQWN0aXZpdHl9J2ApO1xuXG4gIC8vIGRvbnRTdG9wQXBwT25SZXNldCBpcyBib3RoIGFuIGFyZ3VtZW50IGhlcmUsIGFuZCBhIGRlc2lyZWQgY2FwYWJpbGl0eVxuICAvLyBpZiB0aGUgYXJndW1lbnQgaXMgc2V0LCB1c2UgaXQsIG90aGVyd2lzZSB1c2UgdGhlIGNhcFxuICBpZiAoIXV0aWwuaGFzVmFsdWUoZG9udFN0b3BBcHBPblJlc2V0KSkge1xuICAgIGRvbnRTdG9wQXBwT25SZXNldCA9ICEhdGhpcy5vcHRzLmRvbnRTdG9wQXBwT25SZXNldDtcbiAgfVxuXG4gIGxldCBhcmdzID0ge1xuICAgIHBrZzogYXBwUGFja2FnZSxcbiAgICBhY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgd2FpdFBrZzogYXBwV2FpdFBhY2thZ2UgfHwgYXBwUGFja2FnZSxcbiAgICB3YWl0QWN0aXZpdHk6IGFwcFdhaXRBY3Rpdml0eSB8fCBhcHBBY3Rpdml0eSxcbiAgICBhY3Rpb246IGludGVudEFjdGlvbixcbiAgICBjYXRlZ29yeTogaW50ZW50Q2F0ZWdvcnksXG4gICAgZmxhZ3M6IGludGVudEZsYWdzLFxuICAgIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgIHN0b3BBcHA6ICFkb250U3RvcEFwcE9uUmVzZXRcbiAgfTtcbiAgdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzID0gdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzIHx8IHt9O1xuICB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXJncy53YWl0UGtnfS8ke2FyZ3Mud2FpdEFjdGl2aXR5fWBdID0gYXJncztcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoYXJncyk7XG59O1xuXG5jb21tYW5kcy5yZXNldCA9IGFzeW5jIGZ1bmN0aW9uIHJlc2V0ICgpIHtcbiAgYXdhaXQgYW5kcm9pZEhlbHBlcnMucmVzZXRBcHAodGhpcy5hZGIsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0cywge2Zhc3RSZXNldDogdHJ1ZX0pKTtcbiAgLy8gcmVzZXQgY29udGV4dCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQga2luZCBvbiBjb250ZXh0IHdlIHdpbGwgZW5kIHVwIGFmdGVyIGFwcCBsYXVuY2guXG4gIGF3YWl0IHRoaXMuc2V0Q29udGV4dCgpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5pc0Nocm9tZVNlc3Npb24gPyB0aGlzLnN0YXJ0Q2hyb21lU2Vzc2lvbigpIDogdGhpcy5zdGFydEFVVCgpO1xufTtcblxuY29tbWFuZHMuc3RhcnRBVVQgPSBhc3luYyBmdW5jdGlvbiBzdGFydEFVVCAoKSB7XG4gIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKHtcbiAgICBwa2c6IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgIGFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwQWN0aXZpdHksXG4gICAgYWN0aW9uOiB0aGlzLm9wdHMuaW50ZW50QWN0aW9uLFxuICAgIGNhdGVnb3J5OiB0aGlzLm9wdHMuaW50ZW50Q2F0ZWdvcnksXG4gICAgZmxhZ3M6IHRoaXMub3B0cy5pbnRlbnRGbGFncyxcbiAgICB3YWl0UGtnOiB0aGlzLm9wdHMuYXBwV2FpdFBhY2thZ2UsXG4gICAgd2FpdEFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5LFxuICAgIHdhaXREdXJhdGlvbjogdGhpcy5vcHRzLmFwcFdhaXREdXJhdGlvbixcbiAgICBvcHRpb25hbEludGVudEFyZ3VtZW50czogdGhpcy5vcHRzLm9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgIHN0b3BBcHA6ICF0aGlzLm9wdHMuZG9udFN0b3BBcHBPblJlc2V0LFxuICAgIHVzZXI6IHRoaXMub3B0cy51c2VyUHJvZmlsZSxcbiAgfSk7XG59O1xuXG4vLyB3ZSBvdmVycmlkZSBzZXRVcmwgdG8gdGFrZSBhbiBhbmRyb2lkIFVSSSB3aGljaCBjYW4gYmUgdXNlZCBmb3IgZGVlcC1saW5raW5nXG4vLyBpbnNpZGUgYW4gYXBwLCBzaW1pbGFyIHRvIHN0YXJ0aW5nIGFuIGludGVudFxuY29tbWFuZHMuc2V0VXJsID0gYXN5bmMgZnVuY3Rpb24gc2V0VXJsICh1cmkpIHtcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRVcmkodXJpLCB0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG59O1xuXG4vLyBjbG9zaW5nIGFwcCB1c2luZyBmb3JjZSBzdG9wXG5jb21tYW5kcy5jbG9zZUFwcCA9IGFzeW5jIGZ1bmN0aW9uIGNsb3NlQXBwICgpIHtcbiAgYXdhaXQgdGhpcy5hZGIuZm9yY2VTdG9wKHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbiAgLy8gcmVzZXQgY29udGV4dCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQga2luZCBvbiBjb250ZXh0IHdlIHdpbGwgZW5kIHVwIGFmdGVyIGFwcCBsYXVuY2guXG4gIGF3YWl0IHRoaXMuc2V0Q29udGV4dCgpO1xufTtcblxuY29tbWFuZHMuZ2V0RGlzcGxheURlbnNpdHkgPSBhc3luYyBmdW5jdGlvbiBnZXREaXNwbGF5RGVuc2l0eSAoKSB7XG4gIC8vIGZpcnN0IHRyeSB0aGUgcHJvcGVydHkgZm9yIGRldmljZXNcbiAgbGV0IG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZ2V0cHJvcCcsICdyby5zZi5sY2RfZGVuc2l0eSddKTtcbiAgaWYgKG91dCkge1xuICAgIGxldCB2YWwgPSBwYXJzZUludChvdXQsIDEwKTtcbiAgICAvLyBpZiB0aGUgdmFsdWUgaXMgTmFOLCB0cnkgZ2V0dGluZyB0aGUgZW11bGF0b3IgcHJvcGVydHlcbiAgICBpZiAoIWlzTmFOKHZhbCkpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgUGFyc2VkIGRlbnNpdHkgdmFsdWUgd2FzIE5hTjogXCIke291dH1cImApO1xuICB9XG4gIC8vIGZhbGxiYWNrIHRvIHRyeWluZyBwcm9wZXJ0eSBmb3IgZW11bGF0b3JzXG4gIG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZ2V0cHJvcCcsICdxZW11LnNmLmxjZF9kZW5zaXR5J10pO1xuICBpZiAob3V0KSB7XG4gICAgbGV0IHZhbCA9IHBhcnNlSW50KG91dCwgMTApO1xuICAgIGlmICghaXNOYU4odmFsKSkge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBQYXJzZWQgZGVuc2l0eSB2YWx1ZSB3YXMgTmFOOiBcIiR7b3V0fVwiYCk7XG4gIH1cbiAgLy8gY291bGRuJ3QgZ2V0IGFueXRoaW5nLCBzbyBlcnJvciBvdXRcbiAgbG9nLmVycm9yQW5kVGhyb3coJ0ZhaWxlZCB0byBnZXQgZGlzcGxheSBkZW5zaXR5IHByb3BlcnR5LicpO1xufTtcblxuLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIHdpbmRvdyBtYW5hZ2VyIFN1cmZhY2Ugc3RyaW5nIHRvIGdldCBpbmZvLlxuICogQHBhcmFtIGxpbmU6IFRvIHBhcnNlLiBUaGlzIGlzIGFzc3VtZWQgdG8gYmUgdmFsaWQuXG4gKiBAcmV0dXJuOiBWaXNpYmlsaXR5IGFuZCBib3VuZHMgb2YgdGhlIFN1cmZhY2UuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlU3VyZmFjZUxpbmUgKGxpbmUpIHtcbiAgLy8gdGhlIHN1cmZhY2UgYm91bmRzIGFyZSBpbiB0aGUgZm9ybWF0OlxuICAvLyBcInJlY3Q9KDAuMCwxMTg0LjApIDc2OC4wIHggOTYuMFwiXG4gIC8vICAgICAgIF4gbG9jYXRpb24gICBeIHNpemVcbiAgLy8gY3V0IG91dCB0aGUgc3R1ZmYgYmVmb3JlIHRoZSAncmVjdCcgYW5kIHRoZW4gc3BsaXQgdGhlIG51bWJlcnMgYXBhcnRcbiAgbGV0IGJvdW5kcyA9IGxpbmUuc3BsaXQoJ3JlY3Q9JylbMV1cbiAgLnJlcGxhY2UoL1soKSwgeF0rL2csICcgJylcbiAgLnRyaW0oKVxuICAuc3BsaXQoJyAnKTtcblxuICByZXR1cm4ge1xuICAgIHZpc2libGU6IChsaW5lLmluZGV4T2YoJ3Nob3duPXRydWUnKSAhPT0gLTEpLFxuICAgIHg6IHBhcnNlRmxvYXQoYm91bmRzWzBdKSxcbiAgICB5OiBwYXJzZUZsb2F0KGJvdW5kc1sxXSksXG4gICAgd2lkdGg6IHBhcnNlRmxvYXQoYm91bmRzWzJdKSxcbiAgICBoZWlnaHQ6IHBhcnNlRmxvYXQoYm91bmRzWzNdKVxuICB9O1xufVxuXG4vKipcbiAqIEV4dHJhY3RzIHN0YXR1cyBhbmQgbmF2aWdhdGlvbiBiYXIgaW5mb3JtYXRpb24gZnJvbSB0aGUgd2luZG93IG1hbmFnZXIgb3V0cHV0LlxuICogQHBhcmFtIGxpbmVzOiBPdXRwdXQgZnJvbSBkdW1wc3lzIGNvbW1hbmRcbiAqIEByZXR1cm46IFZpc2liaWxpdHkgYW5kIGJvdW5kcyBpbmZvIG9mIHN0YXR1cyBhbmQgbmF2aWdhdGlvbiBiYXJcbiAqL1xuZnVuY3Rpb24gcGFyc2VXaW5kb3dzIChsaW5lcykge1xuICBsZXQgYXRTdGF0dXNCYXIgPSBmYWxzZTtcbiAgbGV0IGF0TmF2QmFyID0gZmFsc2U7XG4gIGxldCBzdGF0dXNCYXI7XG4gIGxldCBuYXZpZ2F0aW9uQmFyO1xuICAvLyB0aGUgd2luZG93IG1hbmFnZXIgb3V0cHV0IGxvb2tzIGxpa2U6XG4gIC8vIFdpbmRvdyAjMSAuLi4gV2luZG93SURcbiAgLy8gICBBIGJ1bmNoIG9mIHByb3BlcnRpZXNcbiAgLy8gV2luZG93ICMyIC4uLiBXaW5kb3dJRFxuICAvLyAgIEEgYnVuY2ggb2YgcHJvcGVydGllc1xuICBsaW5lcy5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgIC8vIHRoZSBzdGFydCBvZiBhIG5ldyB3aW5kb3cgc2VjdGlvblxuICAgIGlmIChsaW5lLmluZGV4T2YoJyAgV2luZG93ICMnKSAhPT0gLTEpIHtcbiAgICAgIC8vIGRldGVybWluZSB3aGljaCBzZWN0aW9uIHdlJ3JlIGluXG4gICAgICAvLyBvbmx5IG9uZSB3aWxsIGJlIHRydWVcbiAgICAgIGF0U3RhdHVzQmFyID0gKGxpbmUuaW5kZXhPZignU3RhdHVzQmFyJykgIT09IC0xKTtcbiAgICAgIGF0TmF2QmFyID0gKGxpbmUuaW5kZXhPZignTmF2aWdhdGlvbkJhcicpICE9PSAtMSk7XG4gICAgICAvLyBkb24ndCBuZWVkIGFueXRoaW5nIGVsc2UuIG1vdmUgdG8gbmV4dCBsaW5lXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIG9uY2Ugd2UncmUgaW4gYSB3aW5kb3cgc2VjdGlvbiwgbG9vayBmb3IgdGhlIHN1cmZhY2UgZGF0YSBsaW5lXG4gICAgaWYgKGxpbmUuaW5kZXhPZignICAgICAgU3VyZmFjZTonKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGF0U3RhdHVzQmFyKSB7XG4gICAgICBzdGF0dXNCYXIgPSBwYXJzZVN1cmZhY2VMaW5lKGxpbmUpO1xuICAgICAgYXRTdGF0dXNCYXIgPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGF0TmF2QmFyKSB7XG4gICAgICBuYXZpZ2F0aW9uQmFyID0gcGFyc2VTdXJmYWNlTGluZShsaW5lKTtcbiAgICAgIGF0TmF2QmFyID0gZmFsc2U7XG4gICAgfVxuICB9KTtcblxuICBpZiAoIXN0YXR1c0Jhcikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gcGFyc2Ugc3RhdHVzIGJhciBpbmZvcm1hdGlvbi4nKTtcbiAgfVxuICBpZiAoIW5hdmlnYXRpb25CYXIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRmFpbGVkIHRvIHBhcnNlIG5hdmlnYXRpb24gYmFyIGluZm9ybWF0aW9uLicpO1xuICB9XG5cbiAgcmV0dXJuIHtzdGF0dXNCYXIsIG5hdmlnYXRpb25CYXJ9O1xufVxuXG5jb21tYW5kcy5nZXRTeXN0ZW1CYXJzID0gYXN5bmMgZnVuY3Rpb24gZ2V0U3lzdGVtQmFycyAoKSB7XG4gIGxldCBvdXQgPSBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2R1bXBzeXMnLCAnd2luZG93JywgJ3dpbmRvd3MnXSk7XG4gIGlmICghb3V0KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0RpZCBub3QgZ2V0IHdpbmRvdyBtYW5hZ2VyIG91dHB1dC4nKTtcbiAgfVxuICByZXR1cm4gcGFyc2VXaW5kb3dzKG91dCk7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVQZXJmb3JtRWRpdG9yQWN0aW9uID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlUGVyZm9ybUVkaXRvckFjdGlvbiAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHthY3Rpb259ID0gb3B0cztcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKGFjdGlvbikpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgJ2FjdGlvbicgYXJndW1lbnQgaXMgcmVxdWlyZWRgKTtcbiAgfVxuXG4gIGF3YWl0IHRoaXMuYWRiLnBlcmZvcm1FZGl0b3JBY3Rpb24oYWN0aW9uKTtcbn07XG5cbmNvbnN0IFBFUk1JU1NJT05fQUNUSU9OID0ge1xuICBHUkFOVDogJ2dyYW50JyxcbiAgUkVWT0tFOiAncmV2b2tlJyxcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2hhbmdlUGVybWlzc2lvbnNPcHRpb25zXG4gKiBAcHJvcGVydHkgeyFzdHJpbmd8QXJyYXk8c3RyaW5nPn0gcGVybWlzc2lvbnMgLSBUaGUgZnVsbCBuYW1lIG9mIHRoZSBwZXJtaXNzaW9uIHRvIGJlIGNoYW5nZWRcbiAqIG9yIGEgbGlzdCBvZiBwZXJtaXNzaW9ucy4gTWFuZGF0b3J5IGFyZ3VtZW50LlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwcFBhY2thZ2UgW3RoaXMub3B0cy5hcHBQYWNrYWdlXSAtIFRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlIHRvIHNldCBjaGFuZ2VcbiAqIHBlcm1pc3Npb25zIG9uLiBEZWZhdWx0cyB0byB0aGUgcGFja2FnZSBuYW1lIHVuZGVyIHRlc3QuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYWN0aW9uIFtncmFudF0gLSBPbmUgb2YgYFBFUk1JU1NJT05fQUNUSU9OYCB2YWx1ZXNcbiAqL1xuXG4vKipcbiAqIENoYW5nZXMgcGFja2FnZSBwZXJtaXNzaW9ucyBpbiBydW50aW1lLlxuICpcbiAqIEBwYXJhbSB7P0NoYW5nZVBlcm1pc3Npb25zT3B0aW9uc30gb3B0cyAtIEF2YWlsYWJsZSBvcHRpb25zIG1hcHBpbmcuXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlcmUgd2FzIGEgZmFpbHVyZSB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uc1xuICovXG5jb21tYW5kcy5tb2JpbGVDaGFuZ2VQZXJtaXNzaW9ucyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUNoYW5nZVBlcm1pc3Npb25zIChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHBlcm1pc3Npb25zLFxuICAgIGFwcFBhY2thZ2UgPSB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgICBhY3Rpb24gPSBQRVJNSVNTSU9OX0FDVElPTi5HUkFOVCxcbiAgfSA9IG9wdHM7XG4gIGlmICghdXRpbC5oYXNWYWx1ZShwZXJtaXNzaW9ucykpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgJ3Blcm1pc3Npb25zJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG5cbiAgbGV0IGFjdGlvbkZ1bmM7XG4gIHN3aXRjaCAoXy50b0xvd2VyKGFjdGlvbikpIHtcbiAgICBjYXNlIFBFUk1JU1NJT05fQUNUSU9OLkdSQU5UOlxuICAgICAgYWN0aW9uRnVuYyA9IChhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKSA9PiB0aGlzLmFkYi5ncmFudFBlcm1pc3Npb24oYXBwUGFja2FnZSwgcGVybWlzc2lvbik7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFBFUk1JU1NJT05fQUNUSU9OLlJFVk9LRTpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSwgcGVybWlzc2lvbikgPT4gdGhpcy5hZGIucmV2b2tlUGVybWlzc2lvbihhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVW5rbm93biBhY3Rpb24gJyR7YWN0aW9ufScuIGAgK1xuICAgICAgICBgT25seSAke0pTT04uc3RyaW5naWZ5KF8udmFsdWVzKFBFUk1JU1NJT05fQUNUSU9OKSl9IGFjdGlvbnMgYXJlIHN1cHBvcnRlZGApO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgZm9yIChjb25zdCBwZXJtaXNzaW9uIG9mIChfLmlzQXJyYXkocGVybWlzc2lvbnMpID8gcGVybWlzc2lvbnMgOiBbcGVybWlzc2lvbnNdKSkge1xuICAgIGF3YWl0IGFjdGlvbkZ1bmMoYXBwUGFja2FnZSwgcGVybWlzc2lvbik7XG4gIH1cbn07XG5cbmNvbnN0IFBFUk1JU1NJT05TX1RZUEUgPSB7XG4gIERFTklFRDogJ2RlbmllZCcsXG4gIEdSQU5URUQ6ICdncmFudGVkJyxcbiAgUkVRVUVTVEVEOiAncmVxdWVzdGVkJyxcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gR2V0UGVybWlzc2lvbnNPcHRpb25zXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBbcmVxdWVzdGVkXSAtIE9uZSBvZiBwb3NzaWJsZSBwZXJtaXNzaW9uIHR5cGVzIHRvIGdldC5cbiAqIENhbiBiZSBhbnkgb2YgYFBFUk1JU1NJT05TX1RZUEVgIHZhbHVlcy5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcHBQYWNrYWdlIFt0aGlzLm9wdHMuYXBwUGFja2FnZV0gLSBUaGUgYXBwbGljYXRpb24gcGFja2FnZSB0byBzZXQgY2hhbmdlXG4gKiBwZXJtaXNzaW9ucyBvbi4gRGVmYXVsdHMgdG8gdGhlIHBhY2thZ2UgbmFtZSB1bmRlciB0ZXN0LlxuICovXG5cbi8qKlxuICogR2V0cyBydW50aW1lIHBlcm1pc3Npb25zIGxpc3QgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICpcbiAqIEBwYXJhbSB7R2V0UGVybWlzc2lvbnNPcHRpb25zfSBvcHRzIC0gQXZhaWxhYmxlIG9wdGlvbnMgbWFwcGluZy5cbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSBUaGUgbGlzdCBvZiByZXRyaWV2ZWQgcGVybWlzc2lvbnMgZm9yIHRoZSBnaXZlbiB0eXBlXG4gKiAoY2FuIGFsc28gYmUgZW1wdHkpLlxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHBlcm1pc3Npb25zLlxuICovXG5jb21tYW5kcy5tb2JpbGVHZXRQZXJtaXNzaW9ucyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldFBlcm1pc3Npb25zIChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHR5cGUgPSBQRVJNSVNTSU9OU19UWVBFLlJFUVVFU1RFRCxcbiAgICBhcHBQYWNrYWdlID0gdGhpcy5vcHRzLmFwcFBhY2thZ2UsXG4gIH0gPSBvcHRzO1xuXG4gIGxldCBhY3Rpb25GdW5jO1xuICBzd2l0Y2ggKF8udG9Mb3dlcih0eXBlKSkge1xuICAgIGNhc2UgUEVSTUlTU0lPTlNfVFlQRS5SRVFVRVNURUQ6XG4gICAgICBhY3Rpb25GdW5jID0gKGFwcFBhY2thZ2UpID0+IHRoaXMuYWRiLmdldFJlcVBlcm1pc3Npb25zKGFwcFBhY2thZ2UpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBQRVJNSVNTSU9OU19UWVBFLkdSQU5URUQ6XG4gICAgICBhY3Rpb25GdW5jID0gKGFwcFBhY2thZ2UpID0+IHRoaXMuYWRiLmdldEdyYW50ZWRQZXJtaXNzaW9ucyhhcHBQYWNrYWdlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgUEVSTUlTU0lPTlNfVFlQRS5ERU5JRUQ6XG4gICAgICBhY3Rpb25GdW5jID0gKGFwcFBhY2thZ2UpID0+IHRoaXMuYWRiLmdldERlbmllZFBlcm1pc3Npb25zKGFwcFBhY2thZ2UpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBVbmtub3duIHBlcm1pc3Npb25zIHR5cGUgJyR7dHlwZX0nLiBgICtcbiAgICAgICAgYE9ubHkgJHtKU09OLnN0cmluZ2lmeShfLnZhbHVlcyhQRVJNSVNTSU9OU19UWVBFKSl9IHR5cGVzIGFyZSBzdXBwb3J0ZWRgKTtcbiAgICAgIGJyZWFrO1xuICB9XG4gIHJldHVybiBhd2FpdCBhY3Rpb25GdW5jKGFwcFBhY2thZ2UpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbi8vIGZvciB1bml0IHRlc3RzXG5leHBvcnQgeyBwYXJzZVdpbmRvd3MsIHBhcnNlU3VyZmFjZUxpbmUgfTtcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlbmVyYWwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
