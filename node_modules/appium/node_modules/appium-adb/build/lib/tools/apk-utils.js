"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.REMOTE_CACHE_ROOT = void 0;

require("source-map-support/register");

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

var _lruCache = _interopRequireDefault(require("lru-cache"));

let apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';
apkUtilsMethods.APP_INSTALL_STATE = {
  UNKNOWN: 'unknown',
  NOT_INSTALLED: 'notInstalled',
  NEWER_VERSION_INSTALLED: 'newerVersionInstalled',
  SAME_VERSION_INSTALLED: 'sameVersionInstalled',
  OLDER_VERSION_INSTALLED: 'olderVersionInstalled'
};
const REMOTE_CACHE_ROOT = '/data/local/tmp/appium_cache';
exports.REMOTE_CACHE_ROOT = REMOTE_CACHE_ROOT;

apkUtilsMethods.isAppInstalled = async function isAppInstalled(pkg) {
  _logger.default.debug(`Getting install status for ${pkg}`);

  const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const isInstalled = installedPattern.test(stdout);

    _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

    return isInstalled;
  } catch (e) {
    throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
  }
};

apkUtilsMethods.startUri = async function startUri(uri, pkg) {
  if (!uri || !pkg) {
    throw new Error('URI and package arguments are required');
  }

  const args = ['am', 'start', '-W', '-a', 'android.intent.action.VIEW', '-d', uri.replace(/&/g, '\\&'), pkg];

  try {
    const res = await this.shell(args);

    if (res.toLowerCase().includes('unable to resolve intent')) {
      throw new Error(res);
    }
  } catch (e) {
    throw new Error(`Error attempting to start URI. Original error: ${e}`);
  }
};

apkUtilsMethods.startApp = async function startApp(startAppOptions = {}) {
  if (!startAppOptions.activity || !startAppOptions.pkg) {
    throw new Error('activity and pkg are required to start an application');
  }

  startAppOptions = _lodash.default.clone(startAppOptions);
  startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');

  _lodash.default.defaults(startAppOptions, {
    waitPkg: startAppOptions.pkg,
    waitForLaunch: true,
    waitActivity: false,
    retry: true,
    stopApp: true
  });

  startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
  const apiLevel = await this.getApiLevel();
  const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);

  try {
    const shellOpts = {};

    if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration > 20000) {
      shellOpts.timeout = startAppOptions.waitDuration;
    }

    const stdout = await this.shell(cmd, shellOpts);

    if (stdout.includes('Error: Activity class') && stdout.includes('does not exist')) {
      if (startAppOptions.retry && !startAppOptions.activity.startsWith('.')) {
        _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

        startAppOptions.activity = `.${startAppOptions.activity}`;
        startAppOptions.retry = false;
        return await this.startApp(startAppOptions);
      }

      throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
    } else if (stdout.includes('java.lang.SecurityException')) {
      throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
    }

    if (startAppOptions.waitActivity) {
      await this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
    }

    return stdout;
  } catch (e) {
    throw new Error(`Cannot start the '${startAppOptions.pkg}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
  }
};

apkUtilsMethods.dumpWindows = async function dumpWindows() {
  const apiLevel = await this.getApiLevel();
  const dumpsysArg = apiLevel >= 29 ? 'displays' : 'windows';
  const cmd = ['dumpsys', 'window', dumpsysArg];
  return await this.shell(cmd);
};

apkUtilsMethods.getFocusedPackageAndActivity = async function getFocusedPackageAndActivity() {
  _logger.default.debug('Getting focused package and activity');

  const nullFocusedAppRe = new RegExp(/^\s*mFocusedApp=null/, 'm');
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)' + '\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'm');
  const nullCurrentFocusRe = new RegExp(/^\s*mCurrentFocus=null/, 'm');
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'm');

  try {
    const stdout = await this.dumpWindows();

    for (const pattern of [focusedAppRe, currentFocusAppRe]) {
      const match = pattern.exec(stdout);

      if (match) {
        return {
          appPackage: match[1].trim(),
          appActivity: match[2].trim()
        };
      }
    }

    for (const pattern of [nullFocusedAppRe, nullCurrentFocusRe]) {
      if (pattern.exec(stdout)) {
        return {
          appPackage: null,
          appActivity: null
        };
      }
    }

    throw new Error('Could not parse activity from dumpsys');
  } catch (e) {
    throw new Error(`Could not get focusPackageAndActivity. Original error: ${e.message}`);
  }
};

apkUtilsMethods.waitForActivityOrNot = async function waitForActivityOrNot(pkg, activity, waitForStop, waitMs = 20000) {
  if (!pkg || !activity) {
    throw new Error('Package and activity required.');
  }

  _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

  const splitNames = names => names.split(',').map(name => name.trim());

  const allPackages = splitNames(pkg);
  const allActivities = splitNames(activity);
  let possibleActivityNames = [];

  for (let oneActivity of allActivities) {
    if (oneActivity.startsWith('.')) {
      for (let currentPkg of allPackages) {
        possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
      }
    } else {
      possibleActivityNames.push(oneActivity);
      possibleActivityNames.push(`${pkg}.${oneActivity}`);
    }
  }

  _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

  let possibleActivityPatterns = possibleActivityNames.map(possibleActivityName => new RegExp(`^${possibleActivityName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));
  let retries = parseInt(waitMs / 750, 10) || 1;
  retries = isNaN(retries) ? 30 : retries;
  await (0, _asyncbox.retryInterval)(retries, 750, async () => {
    let {
      appPackage,
      appActivity
    } = await this.getFocusedPackageAndActivity();

    if (appActivity && appPackage) {
      let fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

      _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

      let foundAct = _lodash.default.includes(allPackages, appPackage) && _lodash.default.findIndex(possibleActivityPatterns, possiblePattern => possiblePattern.test(fullyQualifiedActivity)) !== -1;

      if (!waitForStop && foundAct || waitForStop && !foundAct) {
        return;
      }
    }

    _logger.default.debug('Incorrect package and activity. Retrying.');

    throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
  });
};

apkUtilsMethods.waitForActivity = async function waitForActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, false, waitMs);
};

apkUtilsMethods.waitForNotActivity = async function waitForNotActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, true, waitMs);
};

apkUtilsMethods.uninstallApk = async function uninstallApk(pkg, options = {}) {
  _logger.default.debug(`Uninstalling ${pkg}`);

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

    return false;
  }

  const cmd = ['uninstall'];

  if (options.keepData) {
    cmd.push('-k');
  }

  cmd.push(pkg);
  let stdout;

  try {
    await this.forceStop(pkg);
    stdout = (await this.adbExec(cmd, {
      timeout: options.timeout
    })).trim();
  } catch (e) {
    throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
  }

  _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

  if (stdout.includes('Success')) {
    _logger.default.info(`${pkg} was successfully uninstalled`);

    return true;
  }

  _logger.default.info(`${pkg} was not uninstalled`);

  return false;
};

apkUtilsMethods.installFromDevicePath = async function installFromDevicePath(apkPathOnDevice, opts = {}) {
  let stdout = await this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

  if (stdout.indexOf('Failure') !== -1) {
    throw new Error(`Remote install failed: ${stdout}`);
  }
};

apkUtilsMethods.cacheApk = async function cacheApk(apkPath, options = {}) {
  const appHash = await _appiumSupport.fs.hash(apkPath);

  const remotePath = _path.default.posix.join(REMOTE_CACHE_ROOT, `${appHash}.apk`);

  const remoteCachedFiles = [];

  try {
    const errorMarker = '_ERROR_';
    let lsOutput = null;

    if (this._areExtendedLsOptionsSupported === true || !_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
      lsOutput = await this.shell([`ls -t -1 ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
    }

    if (!_lodash.default.isString(lsOutput) || lsOutput.includes(errorMarker) && !lsOutput.includes(REMOTE_CACHE_ROOT)) {
      if (!_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
        _logger.default.debug('The current Android API does not support extended ls options. ' + 'Defaulting to no-options call');
      }

      lsOutput = await this.shell([`ls ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
      this._areExtendedLsOptionsSupported = false;
    } else {
      this._areExtendedLsOptionsSupported = true;
    }

    if (lsOutput.includes(errorMarker)) {
      throw new Error(lsOutput.substring(0, lsOutput.indexOf(errorMarker)));
    }

    remoteCachedFiles.push(...lsOutput.split('\n').map(x => x.trim()).filter(Boolean));
  } catch (e) {
    _logger.default.debug(`Got an error '${e.message.trim()}' while getting the list of files in the cache. ` + `Assuming the cache does not exist yet`);

    await this.shell(['mkdir', '-p', REMOTE_CACHE_ROOT]);
  }

  _logger.default.debug(`The count of applications in the cache: ${remoteCachedFiles.length}`);

  const toHash = remotePath => _path.default.posix.parse(remotePath).name;

  if (remoteCachedFiles.find(x => toHash(x) === appHash)) {
    _logger.default.info(`The application at '${apkPath}' is already cached to '${remotePath}'`);
  } else {
    _logger.default.info(`Caching the application at '${apkPath}' to '${remotePath}'`);

    const started = process.hrtime();
    await this.push(apkPath, remotePath, {
      timeout: options.timeout
    });
    const [seconds, nanos] = process.hrtime(started);
    const {
      size
    } = await _appiumSupport.fs.stat(apkPath);

    _logger.default.info(`The upload of '${_path.default.basename(apkPath)}' (${_appiumSupport.util.toReadableSizeString(size)}) ` + `took ${(seconds + nanos / 1e9).toFixed(3)}s`);
  }

  if (!this.remoteAppsCache) {
    this.remoteAppsCache = new _lruCache.default({
      max: this.remoteAppsCacheLimit
    });
  }

  _lodash.default.difference(this.remoteAppsCache.keys(), remoteCachedFiles.map(toHash)).forEach(hash => this.remoteAppsCache.del(hash));

  this.remoteAppsCache.set(appHash, remotePath);
  const entriesToCleanup = remoteCachedFiles.map(x => _path.default.posix.join(REMOTE_CACHE_ROOT, x)).filter(x => !this.remoteAppsCache.has(toHash(x))).slice(this.remoteAppsCacheLimit - this.remoteAppsCache.keys().length);

  if (!_lodash.default.isEmpty(entriesToCleanup)) {
    try {
      await this.shell(['rm', '-f', ...entriesToCleanup]);

      _logger.default.debug(`Deleted ${entriesToCleanup.length} expired application cache entries`);
    } catch (e) {
      _logger.default.warn(`Cannot delete ${entriesToCleanup.length} expired application cache entries. ` + `Original error: ${e.message}`);
    }
  }

  return remotePath;
};

apkUtilsMethods.install = async function install(appPath, options = {}) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    return await this.installApks(appPath, options);
  }

  options = _lodash.default.cloneDeep(options);

  _lodash.default.defaults(options, {
    replace: true,
    timeout: this.adbExecTimeout === _helpers.DEFAULT_ADB_EXEC_TIMEOUT ? _helpers.APK_INSTALL_TIMEOUT : this.adbExecTimeout,
    timeoutCapName: 'androidInstallTimeout'
  });

  const installArgs = (0, _helpers.buildInstallArgs)((await this.getApiLevel()), options);
  const installOpts = {
    timeout: options.timeout,
    timeoutCapName: options.timeoutCapName
  };

  let performAppInstall = async () => await this.adbExec(['install', ...installArgs, appPath], installOpts);

  if (this.remoteAppsCacheLimit > 0) {
    const cachedRemotePath = await this.cacheApk(appPath, {
      timeout: options.timeout
    });

    performAppInstall = async () => await this.shell(['pm', 'install', ...installArgs, cachedRemotePath], installOpts);
  }

  try {
    const started = process.hrtime();
    const output = await performAppInstall();
    const [seconds, nanos] = process.hrtime(started);

    _logger.default.info(`The installation of '${_path.default.basename(appPath)}' took ${(seconds + nanos / 1e9).toFixed(3)}s`);

    const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

    _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

    if (/\[INSTALL[A-Z_]+FAILED[A-Z_]+\]/.test(output)) {
      if (this.isTestPackageOnlyError(output)) {
        const msg = `Set 'allowTestPackages' capability to true in order to allow test packages installation.`;

        _logger.default.warn(msg);

        throw new Error(`${output}\n${msg}`);
      }

      throw new Error(output);
    }
  } catch (err) {
    if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
      throw err;
    }

    _logger.default.debug(`Application '${appPath}' already installed. Continuing.`);
  }
};

apkUtilsMethods.getApplicationInstallState = async function getApplicationInstallState(appPath, pkg = null) {
  let apkInfo = null;

  if (!pkg) {
    apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  if (!pkg) {
    _logger.default.warn(`Cannot read the package name of '${appPath}'`);

    return this.APP_INSTALL_STATE.UNKNOWN;
  }

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.debug(`App '${appPath}' is not installed`);

    return this.APP_INSTALL_STATE.NOT_INSTALLED;
  }

  const {
    versionCode: pkgVersionCode,
    versionName: pkgVersionNameStr
  } = await this.getPackageInfo(pkg);

  const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

  if (!apkInfo) {
    apkInfo = await this.getApkInfo(appPath);
  }

  const {
    versionCode: apkVersionCode,
    versionName: apkVersionNameStr
  } = apkInfo;

  const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

  if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
    _logger.default.warn(`Cannot read version codes of '${appPath}' and/or '${pkg}'`);

    if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
      _logger.default.warn(`Cannot read version names of '${appPath}' and/or '${pkg}'`);

      return this.APP_INSTALL_STATE.UNKNOWN;
    }
  }

  if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
    if (pkgVersionCode > apkVersionCode) {
      _logger.default.debug(`The version code of the installed '${pkg}' is greater than the application version code (${pkgVersionCode} > ${apkVersionCode})`);

      return this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED;
    }

    if (pkgVersionCode === apkVersionCode) {
      if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

        return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is equal to application version name (${pkgVersionCode} === ${apkVersionCode})`);

        return this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }
    }
  } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
    _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

    return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
  }

  _logger.default.debug(`The installed '${pkg}' package is older than '${appPath}' (${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'`);

  return this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED;
};

apkUtilsMethods.installOrUpgrade = async function installOrUpgrade(appPath, pkg = null, options = {}) {
  if (!pkg) {
    const apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  const {
    enforceCurrentBuild
  } = options;
  const appState = await this.getApplicationInstallState(appPath, pkg);
  let wasUninstalled = false;

  const uninstallPackage = async () => {
    if (!(await this.uninstallApk(pkg))) {
      throw new Error(`'${pkg}' package cannot be uninstalled`);
    }

    wasUninstalled = true;
  };

  switch (appState) {
    case this.APP_INSTALL_STATE.NOT_INSTALLED:
      _logger.default.debug(`Installing '${appPath}'`);

      await this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED:
      if (enforceCurrentBuild) {
        _logger.default.info(`Downgrading '${pkg}' as requested`);

        await uninstallPackage();
        break;
      }

      _logger.default.debug(`There is no need to downgrade '${pkg}'`);

      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED:
      if (enforceCurrentBuild) {
        break;
      }

      _logger.default.debug(`There is no need to install/upgrade '${appPath}'`);

      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED:
      _logger.default.debug(`Executing upgrade of '${appPath}'`);

      break;

    default:
      _logger.default.debug(`The current install state of '${appPath}' is unknown. Installing anyway`);

      break;
  }

  try {
    await this.install(appPath, Object.assign({}, options, {
      replace: true
    }));
  } catch (err) {
    _logger.default.warn(`Cannot install/upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

    await uninstallPackage();
    await this.install(appPath, Object.assign({}, options, {
      replace: false
    }));
  }

  return {
    appState,
    wasUninstalled
  };
};

apkUtilsMethods.extractStringsFromApk = async function extractStringsFromApk(appPath, language, out) {
  _logger.default.debug(`Extracting strings from for language: ${language || 'default'}`);

  const originalAppPath = appPath;

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractLanguageApk(appPath, language);
  }

  let apkStrings = {};
  let configMarker;

  try {
    await this.initAapt();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', appPath]);
      return stdout.split(_os.default.EOL);
    }, language, '(default)');
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', appPath]);
    apkStrings = (0, _helpers.parseAaptStrings)(stdout, configMarker);
  } catch (e) {
    _logger.default.debug('Cannot extract resources using aapt. Trying aapt2. ' + `Original error: ${e.stderr || e.message}`);

    await this.initAapt2();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const apkanalyzerPath = await (0, _helpers.getApkanalyzerForOs)(this);
      const {
        stdout
      } = await (0, _teen_process.exec)(apkanalyzerPath, ['resources', 'configs', '--type', 'string', appPath], {
        shell: true,
        cwd: _path.default.dirname(apkanalyzerPath)
      });
      return stdout.split(_os.default.EOL);
    }, language, '');

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt2, ['dump', appPath]);
      apkStrings = (0, _helpers.parseAapt2Strings)(stdout, configMarker);
    } catch (e) {
      throw new Error(`Cannot extract resources from '${originalAppPath}'. ` + `Original error: ${e.message}`);
    }
  }

  if (_lodash.default.isEmpty(apkStrings)) {
    _logger.default.warn(`No strings have been found in '${originalAppPath}' resources ` + `for '${configMarker || 'default'}' configuration`);
  } else {
    _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from ` + `'${originalAppPath}' resources for '${configMarker || 'default'}' configuration`);
  }

  const localPath = _path.default.resolve(out, 'strings.json');

  await (0, _appiumSupport.mkdirp)(out);
  await _appiumSupport.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
  return {
    apkStrings,
    localPath
  };
};

apkUtilsMethods.getDeviceLanguage = async function getDeviceLanguage() {
  let language;

  if ((await this.getApiLevel()) < 23) {
    language = await this.getDeviceSysLanguage();

    if (!language) {
      language = await this.getDeviceProductLanguage();
    }
  } else {
    language = (await this.getDeviceLocale()).split('-')[0];
  }

  return language;
};

apkUtilsMethods.getDeviceCountry = async function getDeviceCountry() {
  let country = await this.getDeviceSysCountry();

  if (!country) {
    country = await this.getDeviceProductCountry();
  }

  return country;
};

apkUtilsMethods.getDeviceLocale = async function getDeviceLocale() {
  let locale = await this.getDeviceSysLocale();

  if (!locale) {
    locale = await this.getDeviceProductLocale();
  }

  return locale;
};

apkUtilsMethods.setDeviceLocale = async function setDeviceLocale(locale) {
  const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

  if (!validateLocale.test(locale)) {
    _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

    return;
  }

  let split_locale = locale.split('-');
  await this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
};

apkUtilsMethods.ensureCurrentLocale = async function ensureCurrentLocale(language, country, script = null) {
  const hasLanguage = _lodash.default.isString(language);

  const hasCountry = _lodash.default.isString(country);

  if (!hasLanguage && !hasCountry) {
    _logger.default.warn('ensureCurrentLocale requires language or country');

    return false;
  }

  language = (language || '').toLowerCase();
  country = (country || '').toLowerCase();
  const apiLevel = await this.getApiLevel();
  return await (0, _asyncbox.retryInterval)(5, 1000, async () => {
    try {
      if (apiLevel < 23) {
        let curLanguage, curCountry;

        if (hasLanguage) {
          curLanguage = (await this.getDeviceLanguage()).toLowerCase();

          if (!hasCountry && language === curLanguage) {
            return true;
          }
        }

        if (hasCountry) {
          curCountry = (await this.getDeviceCountry()).toLowerCase();

          if (!hasLanguage && country === curCountry) {
            return true;
          }
        }

        if (language === curLanguage && country === curCountry) {
          return true;
        }
      } else {
        const curLocale = (await this.getDeviceLocale()).toLowerCase();
        const localeCode = script ? `${language}-${script.toLowerCase()}-${country}` : `${language}-${country}`;

        if (localeCode === curLocale) {
          _logger.default.debug(`Requested locale is equal to current locale: '${curLocale}'`);

          return true;
        }
      }

      return false;
    } catch (err) {
      _logger.default.error(`Unable to check device localization: ${err.message}`);

      _logger.default.debug('Restarting ADB and retrying...');

      await this.restartAdb();
      throw err;
    }
  });
};

apkUtilsMethods.setDeviceLanguageCountry = async function setDeviceLanguageCountry(language, country, script = null) {
  let hasLanguage = language && _lodash.default.isString(language);

  let hasCountry = country && _lodash.default.isString(country);

  if (!hasLanguage || !hasCountry) {
    _logger.default.warn(`setDeviceLanguageCountry requires language and country at least`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  let apiLevel = await this.getApiLevel();
  language = (language || '').toLowerCase();
  country = (country || '').toUpperCase();

  if (apiLevel < 23) {
    let curLanguage = (await this.getDeviceLanguage()).toLowerCase();
    let curCountry = (await this.getDeviceCountry()).toUpperCase();

    if (language !== curLanguage || country !== curCountry) {
      await this.setDeviceSysLocaleViaSettingApp(language, country);
    }
  } else {
    let curLocale = await this.getDeviceLocale();
    const localeCode = script ? `${language}-${script}-${country}` : `${language}-${country}`;

    _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${localeCode}'`);

    if (localeCode.toLowerCase() !== curLocale.toLowerCase()) {
      await this.setDeviceSysLocaleViaSettingApp(language, country, script);
    }
  }
};

apkUtilsMethods.getApkInfo = async function getApkInfo(appPath) {
  if (!(await _appiumSupport.fs.exists(appPath))) {
    throw new Error(`The file at path ${appPath} does not exist or is not accessible`);
  }

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }

  try {
    const apkanalyzerPath = await (0, _helpers.getApkanalyzerForOs)(this);
    const args = ['manifest', 'print', appPath];

    _logger.default.debug(`Starting '${apkanalyzerPath}' with args ${JSON.stringify(args)}`);

    const {
      stdout
    } = await (0, _teen_process.exec)(apkanalyzerPath, args, {
      shell: true,
      cwd: _path.default.dirname(apkanalyzerPath)
    });
    const {
      pkg,
      versionName,
      versionCode
    } = (0, _helpers.parseManifest)(stdout);
    return {
      name: pkg,
      versionCode,
      versionName
    };
  } catch (e) {
    _logger.default.info(`Cannot extract apk info using apkanalyzer. Falling back to aapt. ` + `Original error: ${e.stderr || e.message}`);

    await this.initAapt();

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'badging', appPath]);
      const matches = new RegExp(/package: name='([^']+)' versionCode='(\d+)' versionName='([^']+)'/).exec(stdout);

      if (matches) {
        return {
          name: matches[1],
          versionCode: parseInt(matches[2], 10),
          versionName: matches[3]
        };
      }
    } catch (err) {
      _logger.default.warn(`Error "${err.stderr || err.message}" while getting badging info`);
    }
  }

  return {};
};

apkUtilsMethods.getPackageInfo = async function getPackageInfo(pkg) {
  _logger.default.debug(`Getting package info for '${pkg}'`);

  let result = {
    name: pkg
  };

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

    if (versionNameMatch) {
      result.versionName = versionNameMatch[1];
    }

    const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

    if (versionCodeMatch) {
      result.versionCode = parseInt(versionCodeMatch[1], 10);
    }

    return result;
  } catch (err) {
    _logger.default.warn(`Error '${err.message}' while dumping package info`);
  }

  return result;
};

apkUtilsMethods.pullApk = async function pullApk(pkg, tmpDir) {
  const pkgPath = (await this.adbExec(['shell', 'pm', 'path', pkg])).replace('package:', '');

  const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

  await this.pull(pkgPath, tmpApp);

  _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

  return tmpApp;
};

var _default = apkUtilsMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstdXRpbHMuanMiXSwibmFtZXMiOlsiYXBrVXRpbHNNZXRob2RzIiwiQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyIsIkFQUF9JTlNUQUxMX1NUQVRFIiwiVU5LTk9XTiIsIk5PVF9JTlNUQUxMRUQiLCJORVdFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQiLCJPTERFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlJFTU9URV9DQUNIRV9ST09UIiwiaXNBcHBJbnN0YWxsZWQiLCJwa2ciLCJsb2ciLCJkZWJ1ZyIsImluc3RhbGxlZFBhdHRlcm4iLCJSZWdFeHAiLCJfIiwiZXNjYXBlUmVnRXhwIiwic3Rkb3V0Iiwic2hlbGwiLCJpc0luc3RhbGxlZCIsInRlc3QiLCJlIiwiRXJyb3IiLCJtZXNzYWdlIiwic3RhcnRVcmkiLCJ1cmkiLCJhcmdzIiwicmVwbGFjZSIsInJlcyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJzdGFydEFwcCIsInN0YXJ0QXBwT3B0aW9ucyIsImFjdGl2aXR5IiwiY2xvbmUiLCJkZWZhdWx0cyIsIndhaXRQa2ciLCJ3YWl0Rm9yTGF1bmNoIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsInNoZWxsT3B0cyIsImlzSW50ZWdlciIsIndhaXREdXJhdGlvbiIsInRpbWVvdXQiLCJzdGFydHNXaXRoIiwid2FpdEZvckFjdGl2aXR5IiwiZHVtcFdpbmRvd3MiLCJkdW1wc3lzQXJnIiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIm51bGxGb2N1c2VkQXBwUmUiLCJmb2N1c2VkQXBwUmUiLCJudWxsQ3VycmVudEZvY3VzUmUiLCJjdXJyZW50Rm9jdXNBcHBSZSIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5T3JOb3QiLCJ3YWl0Rm9yU3RvcCIsIndhaXRNcyIsInNwbGl0TmFtZXMiLCJuYW1lcyIsInNwbGl0IiwibWFwIiwibmFtZSIsImFsbFBhY2thZ2VzIiwiYWxsQWN0aXZpdGllcyIsInBvc3NpYmxlQWN0aXZpdHlOYW1lcyIsIm9uZUFjdGl2aXR5IiwiY3VycmVudFBrZyIsInB1c2giLCJqb2luIiwicG9zc2libGVBY3Rpdml0eVBhdHRlcm5zIiwicG9zc2libGVBY3Rpdml0eU5hbWUiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJpc05hTiIsImZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkiLCJmb3VuZEFjdCIsImZpbmRJbmRleCIsInBvc3NpYmxlUGF0dGVybiIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJpbmZvIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwib3B0cyIsImluZGV4T2YiLCJjYWNoZUFwayIsImFwa1BhdGgiLCJhcHBIYXNoIiwiZnMiLCJoYXNoIiwicmVtb3RlUGF0aCIsInBhdGgiLCJwb3NpeCIsInJlbW90ZUNhY2hlZEZpbGVzIiwiZXJyb3JNYXJrZXIiLCJsc091dHB1dCIsIl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCIsImlzQm9vbGVhbiIsImlzU3RyaW5nIiwic3Vic3RyaW5nIiwieCIsImZpbHRlciIsIkJvb2xlYW4iLCJsZW5ndGgiLCJ0b0hhc2giLCJwYXJzZSIsImZpbmQiLCJzdGFydGVkIiwicHJvY2VzcyIsImhydGltZSIsInNlY29uZHMiLCJuYW5vcyIsInNpemUiLCJzdGF0IiwiYmFzZW5hbWUiLCJ1dGlsIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJ0b0ZpeGVkIiwicmVtb3RlQXBwc0NhY2hlIiwiTFJVIiwibWF4IiwicmVtb3RlQXBwc0NhY2hlTGltaXQiLCJkaWZmZXJlbmNlIiwia2V5cyIsImZvckVhY2giLCJkZWwiLCJzZXQiLCJlbnRyaWVzVG9DbGVhbnVwIiwiaGFzIiwic2xpY2UiLCJpc0VtcHR5Iiwid2FybiIsImluc3RhbGwiLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsImluc3RhbGxBcGtzIiwiY2xvbmVEZWVwIiwiYWRiRXhlY1RpbWVvdXQiLCJERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQiLCJBUEtfSU5TVEFMTF9USU1FT1VUIiwidGltZW91dENhcE5hbWUiLCJpbnN0YWxsQXJncyIsImluc3RhbGxPcHRzIiwicGVyZm9ybUFwcEluc3RhbGwiLCJjYWNoZWRSZW1vdGVQYXRoIiwib3V0cHV0IiwidHJ1bmNhdGVkT3V0cHV0Iiwic3Vic3RyIiwiaXNUZXN0UGFja2FnZU9ubHlFcnJvciIsIm1zZyIsImVyciIsImdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIiwiYXBrSW5mbyIsImdldEFwa0luZm8iLCJ2ZXJzaW9uQ29kZSIsInBrZ1ZlcnNpb25Db2RlIiwidmVyc2lvbk5hbWUiLCJwa2dWZXJzaW9uTmFtZVN0ciIsImdldFBhY2thZ2VJbmZvIiwicGtnVmVyc2lvbk5hbWUiLCJzZW12ZXIiLCJ2YWxpZCIsImNvZXJjZSIsImFwa1ZlcnNpb25Db2RlIiwiYXBrVmVyc2lvbk5hbWVTdHIiLCJhcGtWZXJzaW9uTmFtZSIsInNhdGlzZmllcyIsImluc3RhbGxPclVwZ3JhZGUiLCJlbmZvcmNlQ3VycmVudEJ1aWxkIiwiYXBwU3RhdGUiLCJ3YXNVbmluc3RhbGxlZCIsInVuaW5zdGFsbFBhY2thZ2UiLCJPYmplY3QiLCJhc3NpZ24iLCJleHRyYWN0U3RyaW5nc0Zyb21BcGsiLCJsYW5ndWFnZSIsIm91dCIsIm9yaWdpbmFsQXBwUGF0aCIsImV4dHJhY3RMYW5ndWFnZUFwayIsImFwa1N0cmluZ3MiLCJjb25maWdNYXJrZXIiLCJpbml0QWFwdCIsImJpbmFyaWVzIiwiYWFwdCIsIm9zIiwiRU9MIiwic3RkZXJyIiwiaW5pdEFhcHQyIiwiYXBrYW5hbHl6ZXJQYXRoIiwiY3dkIiwiZGlybmFtZSIsImFhcHQyIiwibG9jYWxQYXRoIiwicmVzb2x2ZSIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREZXZpY2VMYW5ndWFnZSIsImdldERldmljZVN5c0xhbmd1YWdlIiwiZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlIiwiZ2V0RGV2aWNlTG9jYWxlIiwiZ2V0RGV2aWNlQ291bnRyeSIsImNvdW50cnkiLCJnZXREZXZpY2VTeXNDb3VudHJ5IiwiZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkiLCJsb2NhbGUiLCJnZXREZXZpY2VTeXNMb2NhbGUiLCJnZXREZXZpY2VQcm9kdWN0TG9jYWxlIiwic2V0RGV2aWNlTG9jYWxlIiwidmFsaWRhdGVMb2NhbGUiLCJzcGxpdF9sb2NhbGUiLCJzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkiLCJlbnN1cmVDdXJyZW50TG9jYWxlIiwic2NyaXB0IiwiaGFzTGFuZ3VhZ2UiLCJoYXNDb3VudHJ5IiwiY3VyTGFuZ3VhZ2UiLCJjdXJDb3VudHJ5IiwiY3VyTG9jYWxlIiwibG9jYWxlQ29kZSIsImVycm9yIiwicmVzdGFydEFkYiIsInRvVXBwZXJDYXNlIiwic2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcCIsImV4aXN0cyIsImV4dHJhY3RCYXNlQXBrIiwibWF0Y2hlcyIsInJlc3VsdCIsInZlcnNpb25OYW1lTWF0Y2giLCJ2ZXJzaW9uQ29kZU1hdGNoIiwicHVsbEFwayIsInRtcERpciIsInBrZ1BhdGgiLCJ0bXBBcHAiLCJwdWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLGVBQWUsR0FBRyxFQUF0QjtBQUVBLE1BQU1DLCtCQUErQixHQUNuQyx5R0FERjtBQUVBRCxlQUFlLENBQUNFLGlCQUFoQixHQUFvQztBQUNsQ0MsRUFBQUEsT0FBTyxFQUFFLFNBRHlCO0FBRWxDQyxFQUFBQSxhQUFhLEVBQUUsY0FG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TyxHQUF4QixFQUE2QjRPLE1BQTdCLEVBQXFDO0FBQzdELFFBQU1DLE9BQU8sR0FBRyxDQUFDLE1BQU0sS0FBS3pKLE9BQUwsQ0FBYSxDQUFDLE9BQUQsRUFBVSxJQUFWLEVBQWdCLE1BQWhCLEVBQXdCcEYsR0FBeEIsQ0FBYixDQUFQLEVBQW1EaUIsT0FBbkQsQ0FBMkQsVUFBM0QsRUFBdUUsRUFBdkUsQ0FBaEI7O0FBQ0EsUUFBTTZOLE1BQU0sR0FBRy9JLGNBQUt1RyxPQUFMLENBQWFzQyxNQUFiLEVBQXNCLEdBQUU1TyxHQUFJLE1BQTVCLENBQWY7O0FBQ0EsUUFBTSxLQUFLK08sSUFBTCxDQUFVRixPQUFWLEVBQW1CQyxNQUFuQixDQUFOOztBQUNBN08sa0JBQUlDLEtBQUosQ0FBVywyQkFBMEJGLEdBQUksU0FBUThPLE1BQU8sR0FBeEQ7O0FBQ0EsU0FBT0EsTUFBUDtBQUNELENBTkQ7O2VBU2V4UCxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgYnVpbGRTdGFydENtZCwgQVBLU19FWFRFTlNJT04sIGJ1aWxkSW5zdGFsbEFyZ3MsXG4gIEFQS19JTlNUQUxMX1RJTUVPVVQsIERFRkFVTFRfQURCX0VYRUNfVElNRU9VVCwgZ2V0QXBrYW5hbHl6ZXJGb3JPcyxcbiAgcGFyc2VNYW5pZmVzdCwgcGFyc2VBYXB0U3RyaW5ncywgcGFyc2VBYXB0MlN0cmluZ3MsIGZvcm1hdENvbmZpZ01hcmtlciB9IGZyb20gJy4uL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZnMsIHV0aWwsIG1rZGlycCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgTFJVIGZyb20gJ2xydS1jYWNoZSc7XG5cbmxldCBhcGtVdGlsc01ldGhvZHMgPSB7fTtcblxuY29uc3QgQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyA9XG4gICdodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9ibG9iL21hc3Rlci9kb2NzL2VuL3dyaXRpbmctcnVubmluZy1hcHBpdW0vYW5kcm9pZC9hY3Rpdml0eS1zdGFydHVwLm1kJztcbmFwa1V0aWxzTWV0aG9kcy5BUFBfSU5TVEFMTF9TVEFURSA9IHtcbiAgVU5LTk9XTjogJ3Vua25vd24nLFxuICBOT1RfSU5TVEFMTEVEOiAnbm90SW5zdGFsbGVkJyxcbiAgTkVXRVJfVkVSU0lPTl9JTlNUQUxMRUQ6ICduZXdlclZlcnNpb25JbnN0YWxsZWQnLFxuICBTQU1FX1ZFUlNJT05fSU5TVEFMTEVEOiAnc2FtZVZlcnNpb25JbnN0YWxsZWQnLFxuICBPTERFUl9WRVJTSU9OX0lOU1RBTExFRDogJ29sZGVyVmVyc2lvbkluc3RhbGxlZCcsXG59O1xuY29uc3QgUkVNT1RFX0NBQ0hFX1JPT1QgPSAnL2RhdGEvbG9jYWwvdG1wL2FwcGl1bV9jYWNoZSc7XG5cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIHBhY2thZ2UgaXMgcHJlc2VudCBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFja2FnZSBpcyBpbnN0YWxsZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGRldGVjdGluZyBhcHBsaWNhdGlvbiBzdGF0ZVxuICovXG5hcGtVdGlsc01ldGhvZHMuaXNBcHBJbnN0YWxsZWQgPSBhc3luYyBmdW5jdGlvbiBpc0FwcEluc3RhbGxlZCAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBpbnN0YWxsIHN0YXR1cyBmb3IgJHtwa2d9YCk7XG4gIGNvbnN0IGluc3RhbGxlZFBhdHRlcm4gPSBuZXcgUmVnRXhwKGBeXFxcXHMqUGFja2FnZVxcXFxzK1xcXFxbJHtfLmVzY2FwZVJlZ0V4cChwa2cpfVxcXFxdW146XSs6JGAsICdtJyk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZ10pO1xuICAgIGNvbnN0IGlzSW5zdGFsbGVkID0gaW5zdGFsbGVkUGF0dGVybi50ZXN0KHN0ZG91dCk7XG4gICAgbG9nLmRlYnVnKGAnJHtwa2d9JyBpcyR7IWlzSW5zdGFsbGVkID8gJyBub3QnIDogJyd9IGluc3RhbGxlZGApO1xuICAgIHJldHVybiBpc0luc3RhbGxlZDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZmluZGluZyBpZiAnJHtwa2d9JyBpcyBpbnN0YWxsZWQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBTdGFydCB0aGUgcGFydGljdWxhciBVUkkgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgLSBUaGUgbmFtZSBvZiBVUkkgdG8gc3RhcnQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gc3RhcnQgdGhlIFVSSSB3aXRoLlxuICovXG5hcGtVdGlsc01ldGhvZHMuc3RhcnRVcmkgPSBhc3luYyBmdW5jdGlvbiBzdGFydFVyaSAodXJpLCBwa2cpIHtcbiAgaWYgKCF1cmkgfHwgIXBrZykge1xuICAgIHRocm93IG5ldyBFcnJvcignVVJJIGFuZCBwYWNrYWdlIGFyZ3VtZW50cyBhcmUgcmVxdWlyZWQnKTtcbiAgfVxuXG4gIGNvbnN0IGFyZ3MgPSBbXG4gICAgJ2FtJywgJ3N0YXJ0JyxcbiAgICAnLVcnLFxuICAgICctYScsICdhbmRyb2lkLmludGVudC5hY3Rpb24uVklFVycsXG4gICAgJy1kJywgdXJpLnJlcGxhY2UoLyYvZywgJ1xcXFwmJyksXG4gICAgcGtnLFxuICBdO1xuICB0cnkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc2hlbGwoYXJncyk7XG4gICAgaWYgKHJlcy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCd1bmFibGUgdG8gcmVzb2x2ZSBpbnRlbnQnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBhdHRlbXB0aW5nIHRvIHN0YXJ0IFVSSS4gT3JpZ2luYWwgZXJyb3I6ICR7ZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdGFydEFwcE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgbWFpbiBhcHBsaWNhdGlvbiBhY3Rpdml0eVxuICogQHByb3BlcnR5IHshc3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgYXBwbGljYXRpb24gcGFja2FnZVxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gcmV0cnkgW3RydWVdIC0gSWYgdGhpcyBwcm9wZXJ0eSBpcyBzZXQgdG8gYHRydWVgXG4gKiBhbmQgdGhlIGFjdGl2aXR5IG5hbWUgZG9lcyBub3Qgc3RhcnQgd2l0aCAnLicgdGhlbiB0aGUgbWV0aG9kXG4gKiB3aWxsIHRyeSB0byBhZGQgdGhlIG1pc3NpbmcgZG90IGFuZCBzdGFydCB0aGUgYWN0aXZpdHkgb25jZSBtb3JlXG4gKiBpZiB0aGUgZmlyc3Qgc3RhcnR1cCB0cnkgZmFpbHMuXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBzdG9wQXBwIFt0cnVlXSAtIFNldCBpdCB0byBgdHJ1ZWAgaW4gb3JkZXIgdG8gZm9yY2VmdWxseVxuICogc3RvcCB0aGUgYWN0aXZpdHkgaWYgaXQgaXMgYWxyZWFkeSBydW5uaW5nLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB3YWl0UGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCB0byBvblxuICogc3RhcnR1cCAodGhpcyBvbmx5IG1ha2VzIHNlbnNlIGlmIHRoaXMgbmFtZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgb25lLCB3aGljaCBpcyBzZXQgYXMgYHBrZ2ApXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHdhaXRBY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eSB0byB3YWl0IHRvIG9uXG4gKiBzdGFydHVwICh0aGlzIG9ubHkgbWFrZXMgc2Vuc2UgaWYgdGhpcyBuYW1lIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbmUsIHdoaWNoIGlzIHNldCBhcyBgYWN0aXZpdHlgKVxuICogQHByb3BlcnR5IHs/bnVtYmVyfSB3YWl0RHVyYXRpb24gLSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogYHdhaXRBY3Rpdml0eWAgaXMgZm9jdXNlZFxuICogQHByb3BlcnR5IHs/c3RyaW5nfG51bWJlcn0gdXNlciAtIFRoZSBudW1iZXIgb2YgdGhlIHVzZXIgcHJvZmlsZSB0byBzdGFydFxuICogdGhlIGdpdmVuIGFjdGl2aXR5IHdpdGguIFRoZSBkZWZhdWx0IE9TIHVzZXIgcHJvZmlsZSAodXN1YWxseSB6ZXJvKSBpcyB1c2VkXG4gKiB3aGVuIHRoaXMgcHJvcGVydHkgaXMgdW5zZXRcbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHdhaXRGb3JMYXVuY2ggW3RydWVdIC0gaWYgYGZhbHNlYCB0aGVuIGFkYiB3b24ndCB3YWl0XG4gKiBmb3IgdGhlIHN0YXJ0ZWQgYWN0aXZpdHkgdG8gcmV0dXJuIHRoZSBjb250cm9sXG4gKi9cblxuLyoqXG4gKiBTdGFydCB0aGUgcGFydGljdWxhciBwYWNrYWdlL2FjdGl2aXR5IG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge1N0YXJ0QXBwT3B0aW9uc30gc3RhcnRBcHBPcHRpb25zIFt7fV0gLSBTdGFydHVwIG9wdGlvbnMgbWFwcGluZy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG91dHB1dCBvZiB0aGUgY29ycmVzcG9uZGluZyBhZGIgY29tbWFuZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBhbiBlcnJvciB3aGlsZSBleGVjdXRpbmcgdGhlIGFjdGl2aXR5XG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zdGFydEFwcCA9IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0QXBwIChzdGFydEFwcE9wdGlvbnMgPSB7fSkge1xuICBpZiAoIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSB8fCAhc3RhcnRBcHBPcHRpb25zLnBrZykge1xuICAgIHRocm93IG5ldyBFcnJvcignYWN0aXZpdHkgYW5kIHBrZyBhcmUgcmVxdWlyZWQgdG8gc3RhcnQgYW4gYXBwbGljYXRpb24nKTtcbiAgfVxuXG4gIHN0YXJ0QXBwT3B0aW9ucyA9IF8uY2xvbmUoc3RhcnRBcHBPcHRpb25zKTtcbiAgc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5ID0gc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5LnJlcGxhY2UoJyQnLCAnXFxcXCQnKTtcbiAgLy8gaW5pdGlhbGl6aW5nIGRlZmF1bHRzXG4gIF8uZGVmYXVsdHMoc3RhcnRBcHBPcHRpb25zLCB7XG4gICAgd2FpdFBrZzogc3RhcnRBcHBPcHRpb25zLnBrZyxcbiAgICB3YWl0Rm9yTGF1bmNoOiB0cnVlLFxuICAgIHdhaXRBY3Rpdml0eTogZmFsc2UsXG4gICAgcmV0cnk6IHRydWUsXG4gICAgc3RvcEFwcDogdHJ1ZVxuICB9KTtcbiAgLy8gcHJldmVudGluZyBudWxsIHdhaXRwa2dcbiAgc3RhcnRBcHBPcHRpb25zLndhaXRQa2cgPSBzdGFydEFwcE9wdGlvbnMud2FpdFBrZyB8fCBzdGFydEFwcE9wdGlvbnMucGtnO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuICBjb25zdCBjbWQgPSBidWlsZFN0YXJ0Q21kKHN0YXJ0QXBwT3B0aW9ucywgYXBpTGV2ZWwpO1xuICB0cnkge1xuICAgIGNvbnN0IHNoZWxsT3B0cyA9IHt9O1xuICAgIGlmIChfLmlzSW50ZWdlcihzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uKSAmJiBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uID4gMjAwMDApIHtcbiAgICAgIHNoZWxsT3B0cy50aW1lb3V0ID0gc3RhcnRBcHBPcHRpb25zLndhaXREdXJhdGlvbjtcbiAgICB9XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChjbWQsIHNoZWxsT3B0cyk7XG4gICAgaWYgKHN0ZG91dC5pbmNsdWRlcygnRXJyb3I6IEFjdGl2aXR5IGNsYXNzJykgJiYgc3Rkb3V0LmluY2x1ZGVzKCdkb2VzIG5vdCBleGlzdCcpKSB7XG4gICAgICBpZiAoc3RhcnRBcHBPcHRpb25zLnJldHJ5ICYmICFzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgV2UgdHJpZWQgdG8gc3RhcnQgYW4gYWN0aXZpdHkgdGhhdCBkb2Vzbid0IGV4aXN0LCBgICtcbiAgICAgICAgICAgICAgICAgIGByZXRyeWluZyB3aXRoICcuJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyBhY3Rpdml0eSBuYW1lYCk7XG4gICAgICAgIHN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSA9IGAuJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9YDtcbiAgICAgICAgc3RhcnRBcHBPcHRpb25zLnJldHJ5ID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnN0YXJ0QXBwKHN0YXJ0QXBwT3B0aW9ucyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjdGl2aXR5IG5hbWUgJyR7c3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5fScgdXNlZCB0byBzdGFydCB0aGUgYXBwIGRvZXNuJ3QgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYGV4aXN0IG9yIGNhbm5vdCBiZSBsYXVuY2hlZCEgTWFrZSBzdXJlIGl0IGV4aXN0cyBhbmQgaXMgYSBsYXVuY2hhYmxlIGFjdGl2aXR5YCk7XG4gICAgfSBlbHNlIGlmIChzdGRvdXQuaW5jbHVkZXMoJ2phdmEubGFuZy5TZWN1cml0eUV4Y2VwdGlvbicpKSB7XG4gICAgICAvLyBpZiB0aGUgYXBwIGlzIGRpc2FibGVkIG9uIGEgcmVhbCBkZXZpY2UgaXQgd2lsbCB0aHJvdyBhIHNlY3VyaXR5IGV4Y2VwdGlvblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGVybWlzc2lvbiB0byBzdGFydCAnJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyBhY3Rpdml0eSBoYXMgYmVlbiBkZW5pZWQuYCArXG4gICAgICAgICAgICAgICAgICAgICAgYE1ha2Ugc3VyZSB0aGUgYWN0aXZpdHkvcGFja2FnZSBuYW1lcyBhcmUgY29ycmVjdC5gKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHkpIHtcbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5KHN0YXJ0QXBwT3B0aW9ucy53YWl0UGtnLCBzdGFydEFwcE9wdGlvbnMud2FpdEFjdGl2aXR5LCBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHN0YXJ0IHRoZSAnJHtzdGFydEFwcE9wdGlvbnMucGtnfScgYXBwbGljYXRpb24uIGAgK1xuICAgICAgYFZpc2l0ICR7QUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOS30gZm9yIHRyb3VibGVzaG9vdGluZy4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEhlbHBlciBtZXRob2QgdG8gY2FsbCBgYWRiIGR1bXBzeXMgd2luZG93IHdpbmRvd3MvZGlzcGxheXNgXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5kdW1wV2luZG93cyA9IGFzeW5jIGZ1bmN0aW9uIGR1bXBXaW5kb3dzICgpIHtcbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgLy8gV2l0aCB2ZXJzaW9uIDI5LCBBbmRyb2lkIGNoYW5nZWQgdGhlIGR1bXBzeXMgc3ludGF4XG4gIGNvbnN0IGR1bXBzeXNBcmcgPSBhcGlMZXZlbCA+PSAyOSA/ICdkaXNwbGF5cycgOiAnd2luZG93cyc7XG4gIGNvbnN0IGNtZCA9IFsnZHVtcHN5cycsICd3aW5kb3cnLCBkdW1wc3lzQXJnXTtcblxuICByZXR1cm4gYXdhaXQgdGhpcy5zaGVsbChjbWQpO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBQYWNrYWdlQWN0aXZpdHlJbmZvXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGFwcFBhY2thZ2UgLSBUaGUgbmFtZSBvZiBhcHBsaWNhdGlvbiBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJ2NvbS5hY21lLmFwcCcuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGFwcEFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgbWFpbiBhcHBsaWNhdGlvbiBhY3Rpdml0eS5cbiAqL1xuXG4vKipcbiAqIEdldCB0aGUgbmFtZSBvZiBjdXJyZW50bHkgZm9jdXNlZCBwYWNrYWdlIGFuZCBhY3Rpdml0eS5cbiAqXG4gKiBAcmV0dXJuIHtQYWNrYWdlQWN0aXZpdHlJbmZvfSBUaGUgbWFwcGluZywgd2hlcmUgcHJvcGVydHkgbmFtZXMgYXJlICdhcHBQYWNrYWdlJyBhbmQgJ2FwcEFjdGl2aXR5Jy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBhbiBlcnJvciB3aGlsZSBwYXJzaW5nIHRoZSBkYXRhLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIGdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkgKCkge1xuICBsb2cuZGVidWcoJ0dldHRpbmcgZm9jdXNlZCBwYWNrYWdlIGFuZCBhY3Rpdml0eScpO1xuICBjb25zdCBudWxsRm9jdXNlZEFwcFJlID0gbmV3IFJlZ0V4cCgvXlxccyptRm9jdXNlZEFwcD1udWxsLywgJ20nKTtcbiAgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci94Wjh2RjcvMVxuICBjb25zdCBmb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUZvY3VzZWRBcHAuK1JlY29yZFxcXFx7LipcXFxccyhbXlxcXFxzXFxcXC9cXFxcfV0rKScgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcXFxcLyhbXlxcXFxzXFxcXC9cXFxcfVxcXFwsXSspXFxcXCw/KFxcXFxzW15cXFxcc1xcXFwvXFxcXH1dKykqXFxcXH0nLCAnbScpO1xuICBjb25zdCBudWxsQ3VycmVudEZvY3VzUmUgPSBuZXcgUmVnRXhwKC9eXFxzKm1DdXJyZW50Rm9jdXM9bnVsbC8sICdtJyk7XG4gIGNvbnN0IGN1cnJlbnRGb2N1c0FwcFJlID0gbmV3IFJlZ0V4cCgnXlxcXFxzKm1DdXJyZW50Rm9jdXMuK1xcXFx7LitcXFxccyhbXlxcXFxzXFxcXC9dKylcXFxcLyhbXlxcXFxzXSspXFxcXGInLCAnbScpO1xuXG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5kdW1wV2luZG93cygpO1xuICAgIC8vIFRoZSBvcmRlciBtYXR0ZXJzIGhlcmVcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgW2ZvY3VzZWRBcHBSZSwgY3VycmVudEZvY3VzQXBwUmVdKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IHBhdHRlcm4uZXhlYyhzdGRvdXQpO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXBwUGFja2FnZTogbWF0Y2hbMV0udHJpbSgpLFxuICAgICAgICAgIGFwcEFjdGl2aXR5OiBtYXRjaFsyXS50cmltKClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgW251bGxGb2N1c2VkQXBwUmUsIG51bGxDdXJyZW50Rm9jdXNSZV0pIHtcbiAgICAgIGlmIChwYXR0ZXJuLmV4ZWMoc3Rkb3V0KSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFwcFBhY2thZ2U6IG51bGwsXG4gICAgICAgICAgYXBwQWN0aXZpdHk6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBwYXJzZSBhY3Rpdml0eSBmcm9tIGR1bXBzeXMnKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGdldCBmb2N1c1BhY2thZ2VBbmRBY3Rpdml0eS4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBnaXZlbiBhY3Rpdml0eSB0byBiZSBmb2N1c2VkL25vbi1mb2N1c2VkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eSwgYmVsb25naW5nIHRvIHRoYXQgcGFja2FnZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtib29sZWFufSB3YWl0Rm9yU3RvcCAtIFdoZXRoZXIgdG8gd2FpdCB1bnRpbCB0aGUgYWN0aXZpdHkgaXMgZm9jdXNlZCAodHJ1ZSlcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBpcyBub3QgZm9jdXNlZCAoZmFsc2UpLlxuICogQHBhcmFtIHtudW1iZXJ9IHdhaXRNcyBbMjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSB0aW1lb3V0IG9jY3Vycy5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aW1lb3V0IGhhcHBlbnMuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy53YWl0Rm9yQWN0aXZpdHlPck5vdCA9IGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JBY3Rpdml0eU9yTm90IChwa2csIGFjdGl2aXR5LCB3YWl0Rm9yU3RvcCwgd2FpdE1zID0gMjAwMDApIHtcbiAgaWYgKCFwa2cgfHwgIWFjdGl2aXR5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQYWNrYWdlIGFuZCBhY3Rpdml0eSByZXF1aXJlZC4nKTtcbiAgfVxuICBsb2cuZGVidWcoYFdhaXRpbmcgdXAgdG8gJHt3YWl0TXN9bXMgZm9yIGFjdGl2aXR5IG1hdGNoaW5nIHBrZzogJyR7cGtnfScgYW5kIGAgK1xuICAgICAgICAgICAgYGFjdGl2aXR5OiAnJHthY3Rpdml0eX0nIHRvJHt3YWl0Rm9yU3RvcCA/ICcgbm90JyA6ICcnfSBiZSBmb2N1c2VkYCk7XG5cbiAgY29uc3Qgc3BsaXROYW1lcyA9IChuYW1lcykgPT4gbmFtZXMuc3BsaXQoJywnKS5tYXAoKG5hbWUpID0+IG5hbWUudHJpbSgpKTtcblxuICBjb25zdCBhbGxQYWNrYWdlcyA9IHNwbGl0TmFtZXMocGtnKTtcbiAgY29uc3QgYWxsQWN0aXZpdGllcyA9IHNwbGl0TmFtZXMoYWN0aXZpdHkpO1xuXG4gIGxldCBwb3NzaWJsZUFjdGl2aXR5TmFtZXMgPSBbXTtcbiAgZm9yIChsZXQgb25lQWN0aXZpdHkgb2YgYWxsQWN0aXZpdGllcykge1xuICAgIGlmIChvbmVBY3Rpdml0eS5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgIC8vIGFkZCB0aGUgcGFja2FnZSBuYW1lIGlmIGFjdGl2aXR5IGlzIG5vdCBmdWxsIHF1YWxpZmllZFxuICAgICAgZm9yIChsZXQgY3VycmVudFBrZyBvZiBhbGxQYWNrYWdlcykge1xuICAgICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChgJHtjdXJyZW50UGtnfSR7b25lQWN0aXZpdHl9YC5yZXBsYWNlKC9cXC4rL2csICcuJykpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhY2NlcHQgZnVsbHkgcXVhbGlmaWVkIGFjdGl2aXR5IG5hbWUuXG4gICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChvbmVBY3Rpdml0eSk7XG4gICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChgJHtwa2d9LiR7b25lQWN0aXZpdHl9YCk7XG4gICAgfVxuICB9XG4gIGxvZy5kZWJ1ZyhgUG9zc2libGUgYWN0aXZpdGllcywgdG8gYmUgY2hlY2tlZDogJHtwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChuYW1lKSA9PiBgJyR7bmFtZX0nYCkuam9pbignLCAnKX1gKTtcblxuICBsZXQgcG9zc2libGVBY3Rpdml0eVBhdHRlcm5zID0gcG9zc2libGVBY3Rpdml0eU5hbWVzLm1hcCgocG9zc2libGVBY3Rpdml0eU5hbWUpID0+XG4gICAgbmV3IFJlZ0V4cChgXiR7cG9zc2libGVBY3Rpdml0eU5hbWUucmVwbGFjZSgvXFwuL2csICdcXFxcLicpLnJlcGxhY2UoL1xcKi9nLCAnLio/JykucmVwbGFjZSgvXFwkL2csICdcXFxcJCcpfSRgKVxuICApO1xuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIG51bWJlciBvZiByZXRyaWVzLiBUcnkgb25jZSBpZiB3YWl0TXMgaXMgbGVzcyB0aGF0IDc1MFxuICAvLyAzMCB0aW1lcyBpZiBwYXJzaW5nIGlzIG5vdCBwb3NzaWJsZVxuICBsZXQgcmV0cmllcyA9IHBhcnNlSW50KHdhaXRNcyAvIDc1MCwgMTApIHx8IDE7XG4gIHJldHJpZXMgPSBpc05hTihyZXRyaWVzKSA/IDMwIDogcmV0cmllcztcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbChyZXRyaWVzLCA3NTAsIGFzeW5jICgpID0+IHtcbiAgICBsZXQge2FwcFBhY2thZ2UsIGFwcEFjdGl2aXR5fSA9IGF3YWl0IHRoaXMuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICAgIGlmIChhcHBBY3Rpdml0eSAmJiBhcHBQYWNrYWdlKSB7XG4gICAgICBsZXQgZnVsbHlRdWFsaWZpZWRBY3Rpdml0eSA9IGFwcEFjdGl2aXR5LnN0YXJ0c1dpdGgoJy4nKSA/IGAke2FwcFBhY2thZ2V9JHthcHBBY3Rpdml0eX1gIDogYXBwQWN0aXZpdHk7XG4gICAgICBsb2cuZGVidWcoYEZvdW5kIHBhY2thZ2U6ICcke2FwcFBhY2thZ2V9JyBhbmQgZnVsbHkgcXVhbGlmaWVkIGFjdGl2aXR5IG5hbWUgOiAnJHtmdWxseVF1YWxpZmllZEFjdGl2aXR5fSdgKTtcbiAgICAgIGxldCBmb3VuZEFjdCA9IChfLmluY2x1ZGVzKGFsbFBhY2thZ2VzLCBhcHBQYWNrYWdlKSAmJlxuICAgICAgICAgICAgICAgICAgICAgIF8uZmluZEluZGV4KHBvc3NpYmxlQWN0aXZpdHlQYXR0ZXJucywgKHBvc3NpYmxlUGF0dGVybikgPT4gcG9zc2libGVQYXR0ZXJuLnRlc3QoZnVsbHlRdWFsaWZpZWRBY3Rpdml0eSkpICE9PSAtMSk7XG4gICAgICBpZiAoKCF3YWl0Rm9yU3RvcCAmJiBmb3VuZEFjdCkgfHwgKHdhaXRGb3JTdG9wICYmICFmb3VuZEFjdCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2cuZGVidWcoJ0luY29ycmVjdCBwYWNrYWdlIGFuZCBhY3Rpdml0eS4gUmV0cnlpbmcuJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke3Bvc3NpYmxlQWN0aXZpdHlOYW1lcy5tYXAoKG5hbWUpID0+IGAnJHtuYW1lfSdgKS5qb2luKCcgb3IgJyl9IG5ldmVyICR7d2FpdEZvclN0b3AgPyAnc3RvcHBlZCcgOiAnc3RhcnRlZCd9LiBgICtcbiAgICAgIGBWaXNpdCAke0FDVElWSVRJRVNfVFJPVUJMRVNIT09USU5HX0xJTkt9IGZvciB0cm91Ymxlc2hvb3RpbmdgKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBnaXZlbiBhY3Rpdml0eSB0byBiZSBmb2N1c2VkXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JBY3Rpdml0eSAocGtnLCBhY3QsIHdhaXRNcyA9IDIwMDAwKSB7XG4gIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5T3JOb3QocGtnLCBhY3QsIGZhbHNlLCB3YWl0TXMpO1xufTtcblxuLyoqXG4gKiBXYWl0IGZvciB0aGUgZ2l2ZW4gYWN0aXZpdHkgdG8gYmUgbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JOb3RBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JOb3RBY3Rpdml0eSAocGtnLCBhY3QsIHdhaXRNcyA9IDIwMDAwKSB7XG4gIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5T3JOb3QocGtnLCBhY3QsIHRydWUsIHdhaXRNcyk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFVuaW5zdGFsbE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFthZGJFeGVjVGltZW91dF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIHVuaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtib29sZWFufSBrZWVwRGF0YSBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8ga2VlcCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIGRhdGEgYW5kIGNhY2hlIGZvbGRlcnMgYWZ0ZXIgdW5pbnN0YWxsLlxuICovXG5cbi8qKlxuICogVW5pbnN0YWxsIHRoZSBnaXZlbiBwYWNrYWdlIGZyb20gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBiZSB1bmluc3RhbGxlZC5cbiAqIEBwYXJhbSB7P1VuaW5zdGFsbE9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgc2V0IG9mIHVuaW5zdGFsbCBvcHRpb25zLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFja2FnZSB3YXMgZm91bmQgb24gdGhlIGRldmljZSBhbmRcbiAqICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxseSB1bmluc3RhbGxlZC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLnVuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIHVuaW5zdGFsbEFwayAocGtnLCBvcHRpb25zID0ge30pIHtcbiAgbG9nLmRlYnVnKGBVbmluc3RhbGxpbmcgJHtwa2d9YCk7XG4gIGlmICghYXdhaXQgdGhpcy5pc0FwcEluc3RhbGxlZChwa2cpKSB7XG4gICAgbG9nLmluZm8oYCR7cGtnfSB3YXMgbm90IHVuaW5zdGFsbGVkLCBiZWNhdXNlIGl0IHdhcyBub3QgcHJlc2VudCBvbiB0aGUgZGV2aWNlYCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgY21kID0gWyd1bmluc3RhbGwnXTtcbiAgaWYgKG9wdGlvbnMua2VlcERhdGEpIHtcbiAgICBjbWQucHVzaCgnLWsnKTtcbiAgfVxuICBjbWQucHVzaChwa2cpO1xuXG4gIGxldCBzdGRvdXQ7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5mb3JjZVN0b3AocGtnKTtcbiAgICBzdGRvdXQgPSAoYXdhaXQgdGhpcy5hZGJFeGVjKGNtZCwge3RpbWVvdXQ6IG9wdGlvbnMudGltZW91dH0pKS50cmltKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byB1bmluc3RhbGwgQVBLLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbiAgbG9nLmRlYnVnKGAnYWRiICR7Y21kLmpvaW4oJyAnKX0nIGNvbW1hbmQgb3V0cHV0OiAke3N0ZG91dH1gKTtcbiAgaWYgKHN0ZG91dC5pbmNsdWRlcygnU3VjY2VzcycpKSB7XG4gICAgbG9nLmluZm8oYCR7cGtnfSB3YXMgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbG9nLmluZm8oYCR7cGtnfSB3YXMgbm90IHVuaW5zdGFsbGVkYCk7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBhZnRlciBpdCB3YXMgcHVzaGVkIHRvIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrUGF0aE9uRGV2aWNlIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgcGFja2FnZSBvbiB0aGUgZGV2aWNlIGZpbGUgc3lzdGVtLlxuICogQHBhcmFtIHtvYmplY3R9IG9wdHMgW3t9XSAtIEFkZGl0aW9uYWwgZXhlYyBvcHRpb25zLiBTZWUge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS10ZWVuX3Byb2Nlc3N9XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG1vcmUgZGV0YWlscyBvbiB0aGlzIHBhcmFtZXRlci5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIGR1cmluZyBhcHBsaWNhdGlvbiBpbnN0YWxsLlxuICovXG5hcGtVdGlsc01ldGhvZHMuaW5zdGFsbEZyb21EZXZpY2VQYXRoID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbEZyb21EZXZpY2VQYXRoIChhcGtQYXRoT25EZXZpY2UsIG9wdHMgPSB7fSkge1xuICBsZXQgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ3BtJywgJ2luc3RhbGwnLCAnLXInLCBhcGtQYXRoT25EZXZpY2VdLCBvcHRzKTtcbiAgaWYgKHN0ZG91dC5pbmRleE9mKCdGYWlsdXJlJykgIT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBSZW1vdGUgaW5zdGFsbCBmYWlsZWQ6ICR7c3Rkb3V0fWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IENhY2hpbmdPcHRpb25zXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHRpbWVvdXQgW2FkYkV4ZWNUaW1lb3V0XSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIHVwbG9hZGVkIHRvIHRoZSByZW1vdGUgbG9jYXRpb24uXG4gKi9cblxuLyoqXG4gKiBDYWNoZXMgdGhlIGdpdmVuIEFQSyBhdCBhIHJlbW90ZSBsb2NhdGlvbiB0byBzcGVlZCB1cCBmdXJ0aGVyIEFQSyBkZXBsb3ltZW50cy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrUGF0aCAtIEZ1bGwgcGF0aCB0byB0aGUgYXBrIG9uIHRoZSBsb2NhbCBGU1xuICogQHBhcmFtIHs/Q2FjaGluZ09wdGlvbnN9IG9wdGlvbnMgLSBDYWNoaW5nIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gRnVsbCBwYXRoIHRvIHRoZSBjYWNoZWQgYXBrIG9uIHRoZSByZW1vdGUgZmlsZSBzeXN0ZW1cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmNhY2hlQXBrID0gYXN5bmMgZnVuY3Rpb24gY2FjaGVBcGsgKGFwa1BhdGgsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBhcHBIYXNoID0gYXdhaXQgZnMuaGFzaChhcGtQYXRoKTtcbiAgY29uc3QgcmVtb3RlUGF0aCA9IHBhdGgucG9zaXguam9pbihSRU1PVEVfQ0FDSEVfUk9PVCwgYCR7YXBwSGFzaH0uYXBrYCk7XG4gIGNvbnN0IHJlbW90ZUNhY2hlZEZpbGVzID0gW107XG4gIC8vIEdldCBjdXJyZW50IGNvbnRlbnRzIG9mIHRoZSByZW1vdGUgY2FjaGUgb3IgY3JlYXRlIGl0IGZvciB0aGUgZmlyc3QgdGltZVxuICB0cnkge1xuICAgIGNvbnN0IGVycm9yTWFya2VyID0gJ19FUlJPUl8nO1xuICAgIGxldCBsc091dHB1dCA9IG51bGw7XG4gICAgaWYgKHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkID09PSB0cnVlIHx8ICFfLmlzQm9vbGVhbih0aGlzLl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCkpIHtcbiAgICAgIGxzT3V0cHV0ID0gYXdhaXQgdGhpcy5zaGVsbChbYGxzIC10IC0xICR7UkVNT1RFX0NBQ0hFX1JPT1R9IDI+JjEgfHwgZWNobyAke2Vycm9yTWFya2VyfWBdKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzU3RyaW5nKGxzT3V0cHV0KSB8fCAobHNPdXRwdXQuaW5jbHVkZXMoZXJyb3JNYXJrZXIpICYmICFsc091dHB1dC5pbmNsdWRlcyhSRU1PVEVfQ0FDSEVfUk9PVCkpKSB7XG4gICAgICBpZiAoIV8uaXNCb29sZWFuKHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkKSkge1xuICAgICAgICBsb2cuZGVidWcoJ1RoZSBjdXJyZW50IEFuZHJvaWQgQVBJIGRvZXMgbm90IHN1cHBvcnQgZXh0ZW5kZWQgbHMgb3B0aW9ucy4gJyArXG4gICAgICAgICAgJ0RlZmF1bHRpbmcgdG8gbm8tb3B0aW9ucyBjYWxsJyk7XG4gICAgICB9XG4gICAgICBsc091dHB1dCA9IGF3YWl0IHRoaXMuc2hlbGwoW2BscyAke1JFTU9URV9DQUNIRV9ST09UfSAyPiYxIHx8IGVjaG8gJHtlcnJvck1hcmtlcn1gXSk7XG4gICAgICB0aGlzLl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsc091dHB1dC5pbmNsdWRlcyhlcnJvck1hcmtlcikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihsc091dHB1dC5zdWJzdHJpbmcoMCwgbHNPdXRwdXQuaW5kZXhPZihlcnJvck1hcmtlcikpKTtcbiAgICB9XG4gICAgcmVtb3RlQ2FjaGVkRmlsZXMucHVzaCguLi4oXG4gICAgICBsc091dHB1dC5zcGxpdCgnXFxuJylcbiAgICAgICAgLm1hcCgoeCkgPT4geC50cmltKCkpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICApKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgR290IGFuIGVycm9yICcke2UubWVzc2FnZS50cmltKCl9JyB3aGlsZSBnZXR0aW5nIHRoZSBsaXN0IG9mIGZpbGVzIGluIHRoZSBjYWNoZS4gYCArXG4gICAgICBgQXNzdW1pbmcgdGhlIGNhY2hlIGRvZXMgbm90IGV4aXN0IHlldGApO1xuICAgIGF3YWl0IHRoaXMuc2hlbGwoWydta2RpcicsICctcCcsIFJFTU9URV9DQUNIRV9ST09UXSk7XG4gIH1cbiAgbG9nLmRlYnVnKGBUaGUgY291bnQgb2YgYXBwbGljYXRpb25zIGluIHRoZSBjYWNoZTogJHtyZW1vdGVDYWNoZWRGaWxlcy5sZW5ndGh9YCk7XG4gIGNvbnN0IHRvSGFzaCA9IChyZW1vdGVQYXRoKSA9PiBwYXRoLnBvc2l4LnBhcnNlKHJlbW90ZVBhdGgpLm5hbWU7XG4gIC8vIFB1c2ggdGhlIGFwayB0byB0aGUgcmVtb3RlIGNhY2hlIGlmIG5lZWRlZFxuICBpZiAocmVtb3RlQ2FjaGVkRmlsZXMuZmluZCgoeCkgPT4gdG9IYXNoKHgpID09PSBhcHBIYXNoKSkge1xuICAgIGxvZy5pbmZvKGBUaGUgYXBwbGljYXRpb24gYXQgJyR7YXBrUGF0aH0nIGlzIGFscmVhZHkgY2FjaGVkIHRvICcke3JlbW90ZVBhdGh9J2ApO1xuICB9IGVsc2Uge1xuICAgIGxvZy5pbmZvKGBDYWNoaW5nIHRoZSBhcHBsaWNhdGlvbiBhdCAnJHthcGtQYXRofScgdG8gJyR7cmVtb3RlUGF0aH0nYCk7XG4gICAgY29uc3Qgc3RhcnRlZCA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgYXdhaXQgdGhpcy5wdXNoKGFwa1BhdGgsIHJlbW90ZVBhdGgsIHt0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXR9KTtcbiAgICBjb25zdCBbc2Vjb25kcywgbmFub3NdID0gcHJvY2Vzcy5ocnRpbWUoc3RhcnRlZCk7XG4gICAgY29uc3Qge3NpemV9ID0gYXdhaXQgZnMuc3RhdChhcGtQYXRoKTtcbiAgICBsb2cuaW5mbyhgVGhlIHVwbG9hZCBvZiAnJHtwYXRoLmJhc2VuYW1lKGFwa1BhdGgpfScgKCR7dXRpbC50b1JlYWRhYmxlU2l6ZVN0cmluZyhzaXplKX0pIGAgK1xuICAgICAgYHRvb2sgJHsoc2Vjb25kcyArIG5hbm9zIC8gMWU5KS50b0ZpeGVkKDMpfXNgKTtcbiAgfVxuICBpZiAoIXRoaXMucmVtb3RlQXBwc0NhY2hlKSB7XG4gICAgdGhpcy5yZW1vdGVBcHBzQ2FjaGUgPSBuZXcgTFJVKHtcbiAgICAgIG1heDogdGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCxcbiAgICB9KTtcbiAgfVxuICAvLyBDbGVhbnVwIHRoZSBpbnZhbGlkIGVudHJpZXMgZnJvbSB0aGUgY2FjaGVcbiAgXy5kaWZmZXJlbmNlKHRoaXMucmVtb3RlQXBwc0NhY2hlLmtleXMoKSwgcmVtb3RlQ2FjaGVkRmlsZXMubWFwKHRvSGFzaCkpXG4gICAgLmZvckVhY2goKGhhc2gpID0+IHRoaXMucmVtb3RlQXBwc0NhY2hlLmRlbChoYXNoKSk7XG4gIC8vIEJ1bXAgdGhlIGNhY2hlIHJlY29yZCBmb3IgdGhlIHJlY2VudGx5IGNhY2hlZCBpdGVtXG4gIHRoaXMucmVtb3RlQXBwc0NhY2hlLnNldChhcHBIYXNoLCByZW1vdGVQYXRoKTtcbiAgLy8gSWYgdGhlIHJlbW90ZSBjYWNoZSBleGNlZWRzIHRoaXMucmVtb3RlQXBwc0NhY2hlTGltaXQsIHJlbW92ZSB0aGUgbGVhc3QgcmVjZW50bHkgdXNlZCBlbnRyaWVzXG4gIGNvbnN0IGVudHJpZXNUb0NsZWFudXAgPSByZW1vdGVDYWNoZWRGaWxlc1xuICAgIC5tYXAoKHgpID0+IHBhdGgucG9zaXguam9pbihSRU1PVEVfQ0FDSEVfUk9PVCwgeCkpXG4gICAgLmZpbHRlcigoeCkgPT4gIXRoaXMucmVtb3RlQXBwc0NhY2hlLmhhcyh0b0hhc2goeCkpKVxuICAgIC5zbGljZSh0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0IC0gdGhpcy5yZW1vdGVBcHBzQ2FjaGUua2V5cygpLmxlbmd0aCk7XG4gIGlmICghXy5pc0VtcHR5KGVudHJpZXNUb0NsZWFudXApKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2hlbGwoWydybScsICctZicsIC4uLmVudHJpZXNUb0NsZWFudXBdKTtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRlZCAke2VudHJpZXNUb0NsZWFudXAubGVuZ3RofSBleHBpcmVkIGFwcGxpY2F0aW9uIGNhY2hlIGVudHJpZXNgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihgQ2Fubm90IGRlbGV0ZSAke2VudHJpZXNUb0NsZWFudXAubGVuZ3RofSBleHBpcmVkIGFwcGxpY2F0aW9uIGNhY2hlIGVudHJpZXMuIGAgK1xuICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVtb3RlUGF0aDtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFs2MDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIGluc3RhbGxlZC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lb3V0Q2FwTmFtZSBbYW5kcm9pZEluc3RhbGxUaW1lb3V0XSAtIFRoZSB0aW1lb3V0IG9wdGlvbiBuYW1lXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VycyBjYW4gaW5jcmVhc2UgdGhlIHRpbWVvdXQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHVzZVNkY2FyZCBbZmFsc2VdIC0gU2V0IHRvIHRydWUgdG8gaW5zdGFsbCB0aGUgYXBwIG9uIHNkY2FyZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMgcmVxdWVzdGVkIGluIHRoZSBhcHBsaWNhdGlvbidzIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXIgQW5kcm9pZCA2Ky5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gcmVwbGFjZSBbdHJ1ZV0gLSBTZXQgaXQgdG8gZmFsc2UgaWYgeW91IGRvbid0IHdhbnRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgYXBwbGljYXRpb24gdG8gYmUgdXBncmFkZWQvcmVpbnN0YWxsZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdCBpcyBhbHJlYWR5IHByZXNlbnQgb24gdGhlIGRldmljZS5cbiAqL1xuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhY2thZ2UgZnJvbSB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBwYWNrYWdlLlxuICogQHBhcmFtIHs/SW5zdGFsbE9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgc2V0IG9mIGluc3RhbGxhdGlvbiBvcHRpb25zLlxuICogQHRocm93cyB7RXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGwgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsIChhcHBQYXRoLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaW5zdGFsbEFwa3MoYXBwUGF0aCwgb3B0aW9ucyk7XG4gIH1cblxuICBvcHRpb25zID0gXy5jbG9uZURlZXAob3B0aW9ucyk7XG4gIF8uZGVmYXVsdHMob3B0aW9ucywge1xuICAgIHJlcGxhY2U6IHRydWUsXG4gICAgdGltZW91dDogdGhpcy5hZGJFeGVjVGltZW91dCA9PT0gREVGQVVMVF9BREJfRVhFQ19USU1FT1VUID8gQVBLX0lOU1RBTExfVElNRU9VVCA6IHRoaXMuYWRiRXhlY1RpbWVvdXQsXG4gICAgdGltZW91dENhcE5hbWU6ICdhbmRyb2lkSW5zdGFsbFRpbWVvdXQnLFxuICB9KTtcblxuICBjb25zdCBpbnN0YWxsQXJncyA9IGJ1aWxkSW5zdGFsbEFyZ3MoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpLCBvcHRpb25zKTtcbiAgY29uc3QgaW5zdGFsbE9wdHMgPSB7XG4gICAgdGltZW91dDogb3B0aW9ucy50aW1lb3V0LFxuICAgIHRpbWVvdXRDYXBOYW1lOiBvcHRpb25zLnRpbWVvdXRDYXBOYW1lLFxuICB9O1xuICBsZXQgcGVyZm9ybUFwcEluc3RhbGwgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmFkYkV4ZWMoW1xuICAgICdpbnN0YWxsJyxcbiAgICAuLi5pbnN0YWxsQXJncyxcbiAgICBhcHBQYXRoXG4gIF0sIGluc3RhbGxPcHRzKTtcbiAgLy8gdGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCA8PSAwIG1lYW5zIG5vIGNhY2hpbmcgc2hvdWxkIGJlIGFwcGxpZWRcbiAgaWYgKHRoaXMucmVtb3RlQXBwc0NhY2hlTGltaXQgPiAwKSB7XG4gICAgY29uc3QgY2FjaGVkUmVtb3RlUGF0aCA9IGF3YWl0IHRoaXMuY2FjaGVBcGsoYXBwUGF0aCwge1xuICAgICAgdGltZW91dDogb3B0aW9ucy50aW1lb3V0LFxuICAgIH0pO1xuICAgIHBlcmZvcm1BcHBJbnN0YWxsID0gYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5zaGVsbChbXG4gICAgICAncG0nLFxuICAgICAgJ2luc3RhbGwnLFxuICAgICAgLi4uaW5zdGFsbEFyZ3MsXG4gICAgICBjYWNoZWRSZW1vdGVQYXRoXG4gICAgXSwgaW5zdGFsbE9wdHMpO1xuICB9XG4gIHRyeSB7XG4gICAgY29uc3Qgc3RhcnRlZCA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgcGVyZm9ybUFwcEluc3RhbGwoKTtcbiAgICBjb25zdCBbc2Vjb25kcywgbmFub3NdID0gcHJvY2Vzcy5ocnRpbWUoc3RhcnRlZCk7XG4gICAgbG9nLmluZm8oYFRoZSBpbnN0YWxsYXRpb24gb2YgJyR7cGF0aC5iYXNlbmFtZShhcHBQYXRoKX0nIHRvb2sgJHsoc2Vjb25kcyArIG5hbm9zIC8gMWU5KS50b0ZpeGVkKDMpfXNgKTtcbiAgICBjb25zdCB0cnVuY2F0ZWRPdXRwdXQgPSAoIV8uaXNTdHJpbmcob3V0cHV0KSB8fCBvdXRwdXQubGVuZ3RoIDw9IDMwMCkgP1xuICAgICAgb3V0cHV0IDogYCR7b3V0cHV0LnN1YnN0cigwLCAxNTApfS4uLiR7b3V0cHV0LnN1YnN0cihvdXRwdXQubGVuZ3RoIC0gMTUwKX1gO1xuICAgIGxvZy5kZWJ1ZyhgSW5zdGFsbCBjb21tYW5kIHN0ZG91dDogJHt0cnVuY2F0ZWRPdXRwdXR9YCk7XG4gICAgaWYgKC9cXFtJTlNUQUxMW0EtWl9dK0ZBSUxFRFtBLVpfXStcXF0vLnRlc3Qob3V0cHV0KSkge1xuICAgICAgaWYgKHRoaXMuaXNUZXN0UGFja2FnZU9ubHlFcnJvcihvdXRwdXQpKSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IGBTZXQgJ2FsbG93VGVzdFBhY2thZ2VzJyBjYXBhYmlsaXR5IHRvIHRydWUgaW4gb3JkZXIgdG8gYWxsb3cgdGVzdCBwYWNrYWdlcyBpbnN0YWxsYXRpb24uYDtcbiAgICAgICAgbG9nLndhcm4obXNnKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke291dHB1dH1cXG4ke21zZ31gKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihvdXRwdXQpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gb24gc29tZSBzeXN0ZW1zIHRoaXMgd2lsbCB0aHJvdyBhbiBlcnJvciBpZiB0aGUgYXBwIGFscmVhZHlcbiAgICAvLyBleGlzdHNcbiAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKCdJTlNUQUxMX0ZBSUxFRF9BTFJFQURZX0VYSVNUUycpKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgQXBwbGljYXRpb24gJyR7YXBwUGF0aH0nIGFscmVhZHkgaW5zdGFsbGVkLiBDb250aW51aW5nLmApO1xuICB9XG59O1xuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgY3VycmVudCBpbnN0YWxsYXRpb24gc3RhdGUgb2YgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb25cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIEZ1bGwgcGF0aCB0byB0aGUgYXBwbGljYXRpb25cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGtnIC0gUGFja2FnZSBpZGVudGlmaWVyLiBJZiBvbWl0dGVkIHRoZW4gdGhlIHNjcmlwdCB3aWxsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB0byBleHRyYWN0IGl0IG9uIGl0cyBvd25cbiAqIEByZXR1cm5zIHtzdHJpbmd9XU9uZSBvZiBgQVBQX0lOU1RBTExfU1RBVEVgIGNvbnN0YW50c1xuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0QXBwbGljYXRpb25JbnN0YWxsU3RhdGUgPSBhc3luYyBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZSAoYXBwUGF0aCwgcGtnID0gbnVsbCkge1xuICBsZXQgYXBrSW5mbyA9IG51bGw7XG4gIGlmICghcGtnKSB7XG4gICAgYXBrSW5mbyA9IGF3YWl0IHRoaXMuZ2V0QXBrSW5mbyhhcHBQYXRoKTtcbiAgICBwa2cgPSBhcGtJbmZvLm5hbWU7XG4gIH1cbiAgaWYgKCFwa2cpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdGhlIHBhY2thZ2UgbmFtZSBvZiAnJHthcHBQYXRofSdgKTtcbiAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5VTktOT1dOO1xuICB9XG5cbiAgaWYgKCFhd2FpdCB0aGlzLmlzQXBwSW5zdGFsbGVkKHBrZykpIHtcbiAgICBsb2cuZGVidWcoYEFwcCAnJHthcHBQYXRofScgaXMgbm90IGluc3RhbGxlZGApO1xuICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5PVF9JTlNUQUxMRUQ7XG4gIH1cblxuICBjb25zdCB7dmVyc2lvbkNvZGU6IHBrZ1ZlcnNpb25Db2RlLCB2ZXJzaW9uTmFtZTogcGtnVmVyc2lvbk5hbWVTdHJ9ID0gYXdhaXQgdGhpcy5nZXRQYWNrYWdlSW5mbyhwa2cpO1xuICBjb25zdCBwa2dWZXJzaW9uTmFtZSA9IHNlbXZlci52YWxpZChzZW12ZXIuY29lcmNlKHBrZ1ZlcnNpb25OYW1lU3RyKSk7XG4gIGlmICghYXBrSW5mbykge1xuICAgIGFwa0luZm8gPSBhd2FpdCB0aGlzLmdldEFwa0luZm8oYXBwUGF0aCk7XG4gIH1cbiAgY29uc3Qge3ZlcnNpb25Db2RlOiBhcGtWZXJzaW9uQ29kZSwgdmVyc2lvbk5hbWU6IGFwa1ZlcnNpb25OYW1lU3RyfSA9IGFwa0luZm87XG4gIGNvbnN0IGFwa1ZlcnNpb25OYW1lID0gc2VtdmVyLnZhbGlkKHNlbXZlci5jb2VyY2UoYXBrVmVyc2lvbk5hbWVTdHIpKTtcblxuICBpZiAoIV8uaXNJbnRlZ2VyKGFwa1ZlcnNpb25Db2RlKSB8fCAhXy5pc0ludGVnZXIocGtnVmVyc2lvbkNvZGUpKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHZlcnNpb24gY29kZXMgb2YgJyR7YXBwUGF0aH0nIGFuZC9vciAnJHtwa2d9J2ApO1xuICAgIGlmICghXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgfHwgIV8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpKSB7XG4gICAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdmVyc2lvbiBuYW1lcyBvZiAnJHthcHBQYXRofScgYW5kL29yICcke3BrZ30nYCk7XG4gICAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5VTktOT1dOO1xuICAgIH1cbiAgfVxuICBpZiAoXy5pc0ludGVnZXIoYXBrVmVyc2lvbkNvZGUpICYmIF8uaXNJbnRlZ2VyKHBrZ1ZlcnNpb25Db2RlKSkge1xuICAgIGlmIChwa2dWZXJzaW9uQ29kZSA+IGFwa1ZlcnNpb25Db2RlKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZSB2ZXJzaW9uIGNvZGUgb2YgdGhlIGluc3RhbGxlZCAnJHtwa2d9JyBpcyBncmVhdGVyIHRoYW4gdGhlIGFwcGxpY2F0aW9uIHZlcnNpb24gY29kZSAoJHtwa2dWZXJzaW9uQ29kZX0gPiAke2Fwa1ZlcnNpb25Db2RlfSlgKTtcbiAgICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5FV0VSX1ZFUlNJT05fSU5TVEFMTEVEO1xuICAgIH1cbiAgICAvLyBWZXJzaW9uIGNvZGVzIG1pZ2h0IG5vdCBiZSBtYWludGFpbmVkLiBDaGVjayB2ZXJzaW9uIG5hbWVzLlxuICAgIGlmIChwa2dWZXJzaW9uQ29kZSA9PT0gYXBrVmVyc2lvbkNvZGUpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSAmJiBfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSAmJiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPj0ke2Fwa1ZlcnNpb25OYW1lfWApKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gbmFtZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIGFwcGxpY2F0aW9uIHZlcnNpb24gbmFtZSAoJyR7cGtnVmVyc2lvbk5hbWV9JyA+PSAnJHthcGtWZXJzaW9uTmFtZX0nKWApO1xuICAgICAgICByZXR1cm4gc2VtdmVyLnNhdGlzZmllcyhwa2dWZXJzaW9uTmFtZSwgYD4ke2Fwa1ZlcnNpb25OYW1lfWApXG4gICAgICAgICAgPyB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5FV0VSX1ZFUlNJT05fSU5TVEFMTEVEXG4gICAgICAgICAgOiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpIHx8ICFfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSkge1xuICAgICAgICBsb2cuZGVidWcoYFRoZSB2ZXJzaW9uIG5hbWUgb2YgdGhlIGluc3RhbGxlZCAnJHtwa2d9JyBpcyBlcXVhbCB0byBhcHBsaWNhdGlvbiB2ZXJzaW9uIG5hbWUgKCR7cGtnVmVyc2lvbkNvZGV9ID09PSAke2Fwa1ZlcnNpb25Db2RlfSlgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgJiYgXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkgJiYgc2VtdmVyLnNhdGlzZmllcyhwa2dWZXJzaW9uTmFtZSwgYD49JHthcGtWZXJzaW9uTmFtZX1gKSkge1xuICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gbmFtZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIGFwcGxpY2F0aW9uIHZlcnNpb24gbmFtZSAoJyR7cGtnVmVyc2lvbk5hbWV9JyA+PSAnJHthcGtWZXJzaW9uTmFtZX0nKWApO1xuICAgIHJldHVybiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPiR7YXBrVmVyc2lvbk5hbWV9YClcbiAgICAgID8gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRFxuICAgICAgOiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ7XG4gIH1cblxuICBsb2cuZGVidWcoYFRoZSBpbnN0YWxsZWQgJyR7cGtnfScgcGFja2FnZSBpcyBvbGRlciB0aGFuICcke2FwcFBhdGh9JyAoJHtwa2dWZXJzaW9uQ29kZX0gPCAke2Fwa1ZlcnNpb25Db2RlfSBvciAnJHtwa2dWZXJzaW9uTmFtZX0nIDwgJyR7YXBrVmVyc2lvbk5hbWV9JyknYCk7XG4gIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk9MREVSX1ZFUlNJT05fSU5TVEFMTEVEO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3JVcGdyYWRlT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzYwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtib29sZWFufSBhbGxvd1Rlc3RQYWNrYWdlcyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gYWxsb3cgdGVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZXMgaW5zdGFsbGF0aW9uLlxuICogQHByb3BlcnR5IHtib29sZWFufSB1c2VTZGNhcmQgW2ZhbHNlXSAtIFNldCB0byB0cnVlIHRvIGluc3RhbGwgdGhlIGFwcCBvbiBTRENhcmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0ZWFkIG9mIHRoZSBkZXZpY2UgbWVtb3J5LlxuICogQHByb3BlcnR5IHtib29sZWFufSBncmFudFBlcm1pc3Npb25zIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBncmFudCBhbGwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zIHJlcXVlc3RlZCBpbiB0aGUgYXBwbGljYXRpb24ncyBtYW5pZmVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBpbnN0YWxsYXRpb24gaXMgY29tcGxldGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVyIEFuZHJvaWQgNisuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGVuZm9yY2VDdXJyZW50QnVpbGQgW2ZhbHNlXSAtIFNldCB0byBgdHJ1ZWAgaW4gb3JkZXIgdG8gYWx3YXlzIHByZWZlclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY3VycmVudCBidWlsZCBvdmVyIGFueSBpbnN0YWxsZWQgcGFja2FnZXMgaGF2aW5nXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBzYW1lIGlkZW50aWZpZXJcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEluc3RhbGxPclVwZ3JhZGVSZXN1bHRcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gd2FzVW5pbnN0YWxsZWQgLSBFcXVhbHMgdG8gYHRydWVgIGlmIHRoZSB0YXJnZXQgYXBwIGhhcyBiZWVuIHVuaW5zdGFsbGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlIGJlaW5nIGluc3RhbGxlZFxuICogQHByb3BlcnR5IHtBUFBfSU5TVEFMTF9TVEFURX0gYXBwU3RhdGUgLSBPbmUgb2YgYGFkYi5BUFBfSU5TVEFMTF9TVEFURWAgc3RhdGVzLCB3aGljaCByZWZsZWN0c1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc3RhdGUgb2YgdGhlIGFwcGxpY2F0aW9uIGJlZm9yZSBiZWluZyBpbnN0YWxsZWQuXG4gKi9cblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGZyb20gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIG9yIHVwZ3JhZGUgaXQgaWYgYW4gb2xkZXJcbiAqIHZlcnNpb24gb2YgdGhlIHNhbWUgcGFja2FnZSBpcyBhbHJlYWR5IGluc3RhbGxlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgcGFja2FnZS4gVGhlIG1ldGhvZCB3aWxsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm0gZmFzdGVyIGlmIGl0IGlzIHNldC5cbiAqIEBwYXJhbSB7P0luc3RhbGxPclVwZ3JhZGVPcHRpb25zfSBvcHRpb25zIC0gU2V0IG9mIGluc3RhbGwgb3B0aW9ucy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBhbiB1bmV4cGVjdGVkIGVycm9yIGhhcHBlbnMgZHVyaW5nIGluc3RhbGwuXG4gKiBAcmV0dXJucyB7SW5zdGFsbE9yVXBncmFkZVJlc3VsdH1cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGxPclVwZ3JhZGUgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsT3JVcGdyYWRlIChhcHBQYXRoLCBwa2cgPSBudWxsLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCFwa2cpIHtcbiAgICBjb25zdCBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICAgIHBrZyA9IGFwa0luZm8ubmFtZTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBlbmZvcmNlQ3VycmVudEJ1aWxkLFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgYXBwU3RhdGUgPSBhd2FpdCB0aGlzLmdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlKGFwcFBhdGgsIHBrZyk7XG4gIGxldCB3YXNVbmluc3RhbGxlZCA9IGZhbHNlO1xuICBjb25zdCB1bmluc3RhbGxQYWNrYWdlID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghYXdhaXQgdGhpcy51bmluc3RhbGxBcGsocGtnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtwa2d9JyBwYWNrYWdlIGNhbm5vdCBiZSB1bmluc3RhbGxlZGApO1xuICAgIH1cbiAgICB3YXNVbmluc3RhbGxlZCA9IHRydWU7XG4gIH07XG4gIHN3aXRjaCAoYXBwU3RhdGUpIHtcbiAgICBjYXNlIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTk9UX0lOU1RBTExFRDpcbiAgICAgIGxvZy5kZWJ1ZyhgSW5zdGFsbGluZyAnJHthcHBQYXRofSdgKTtcbiAgICAgIGF3YWl0IHRoaXMuaW5zdGFsbChhcHBQYXRoLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7cmVwbGFjZTogZmFsc2V9KSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBTdGF0ZSxcbiAgICAgICAgd2FzVW5pbnN0YWxsZWQsXG4gICAgICB9O1xuICAgIGNhc2UgdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICAgIGlmIChlbmZvcmNlQ3VycmVudEJ1aWxkKSB7XG4gICAgICAgIGxvZy5pbmZvKGBEb3duZ3JhZGluZyAnJHtwa2d9JyBhcyByZXF1ZXN0ZWRgKTtcbiAgICAgICAgYXdhaXQgdW5pbnN0YWxsUGFja2FnZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgbm8gbmVlZCB0byBkb3duZ3JhZGUgJyR7cGtnfSdgKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcFN0YXRlLFxuICAgICAgICB3YXNVbmluc3RhbGxlZCxcbiAgICAgIH07XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ6XG4gICAgICBpZiAoZW5mb3JjZUN1cnJlbnRCdWlsZCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgbm8gbmVlZCB0byBpbnN0YWxsL3VwZ3JhZGUgJyR7YXBwUGF0aH0nYCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBTdGF0ZSxcbiAgICAgICAgd2FzVW5pbnN0YWxsZWQsXG4gICAgICB9O1xuICAgIGNhc2UgdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5PTERFUl9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICAgIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nIHVwZ3JhZGUgb2YgJyR7YXBwUGF0aH0nYCk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbG9nLmRlYnVnKGBUaGUgY3VycmVudCBpbnN0YWxsIHN0YXRlIG9mICcke2FwcFBhdGh9JyBpcyB1bmtub3duLiBJbnN0YWxsaW5nIGFueXdheWApO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuaW5zdGFsbChhcHBQYXRoLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7cmVwbGFjZTogdHJ1ZX0pKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCBpbnN0YWxsL3VwZ3JhZGUgJyR7cGtnfScgYmVjYXVzZSBvZiAnJHtlcnIubWVzc2FnZX0nLiBUcnlpbmcgZnVsbCByZWluc3RhbGxgKTtcbiAgICBhd2FpdCB1bmluc3RhbGxQYWNrYWdlKCk7XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwcFBhdGgsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtyZXBsYWNlOiBmYWxzZX0pKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGFwcFN0YXRlLFxuICAgIHdhc1VuaW5zdGFsbGVkLFxuICB9O1xufTtcblxuLyoqXG4gKiBFeHRyYWN0IHN0cmluZyByZXNvdXJjZXMgZnJvbSB0aGUgZ2l2ZW4gcGFja2FnZSBvbiBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIC5hcGsocykgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgdG8gZXh0cmFjdCB0aGUgcmVzb3VyY2VzIGZvci5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZGVmYXVsdCBsYW5ndWFnZSBpcyB1c2VkIGlmIHRoaXMgZXF1YWxzIHRvIGBudWxsYC9gdW5kZWZpbmVkYFxuICogQHBhcmFtIHtzdHJpbmd9IG91dCAtIFRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiBmb2xkZXIgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgdGhlIGV4dHJhY3RlZCBmaWxlIHRvLlxuICogQHJldHVybiB7T2JqZWN0fSBBIG1hcHBpbmcgb2JqZWN0LCB3aGVyZSBwcm9wZXJ0aWVzIGFyZTogJ2Fwa1N0cmluZ3MnLCBjb250YWluaW5nXG4gKiAgICAgICAgICAgICAgICAgIHBhcnNlZCByZXNvdXJjZSBmaWxlIHJlcHJlc2VudGVkIGFzIEpTT04gb2JqZWN0LCBhbmQgJ2xvY2FsUGF0aCcsXG4gKiAgICAgICAgICAgICAgICAgIGNvbnRhaW5pbmcgdGhlIHBhdGggdG8gdGhlIGV4dHJhY3RlZCBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmV4dHJhY3RTdHJpbmdzRnJvbUFwayA9IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RTdHJpbmdzRnJvbUFwayAoYXBwUGF0aCwgbGFuZ3VhZ2UsIG91dCkge1xuICBsb2cuZGVidWcoYEV4dHJhY3Rpbmcgc3RyaW5ncyBmcm9tIGZvciBsYW5ndWFnZTogJHtsYW5ndWFnZSB8fCAnZGVmYXVsdCd9YCk7XG4gIGNvbnN0IG9yaWdpbmFsQXBwUGF0aCA9IGFwcFBhdGg7XG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGFwcFBhdGggPSBhd2FpdCB0aGlzLmV4dHJhY3RMYW5ndWFnZUFwayhhcHBQYXRoLCBsYW5ndWFnZSk7XG4gIH1cblxuICBsZXQgYXBrU3RyaW5ncyA9IHt9O1xuICBsZXQgY29uZmlnTWFya2VyO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcblxuICAgIGNvbmZpZ01hcmtlciA9IGF3YWl0IGZvcm1hdENvbmZpZ01hcmtlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAgICdkJyxcbiAgICAgICAgJ2NvbmZpZ3VyYXRpb25zJyxcbiAgICAgICAgYXBwUGF0aCxcbiAgICAgIF0pO1xuICAgICAgcmV0dXJuIHN0ZG91dC5zcGxpdChvcy5FT0wpO1xuICAgIH0sIGxhbmd1YWdlLCAnKGRlZmF1bHQpJyk7XG5cbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnZCcsXG4gICAgICAnLS12YWx1ZXMnLFxuICAgICAgJ3Jlc291cmNlcycsXG4gICAgICBhcHBQYXRoLFxuICAgIF0pO1xuICAgIGFwa1N0cmluZ3MgPSBwYXJzZUFhcHRTdHJpbmdzKHN0ZG91dCwgY29uZmlnTWFya2VyKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZygnQ2Fubm90IGV4dHJhY3QgcmVzb3VyY2VzIHVzaW5nIGFhcHQuIFRyeWluZyBhYXB0Mi4gJyArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuXG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdDIoKTtcblxuICAgIGNvbmZpZ01hcmtlciA9IGF3YWl0IGZvcm1hdENvbmZpZ01hcmtlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcGthbmFseXplclBhdGggPSBhd2FpdCBnZXRBcGthbmFseXplckZvck9zKHRoaXMpO1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGFwa2FuYWx5emVyUGF0aCwgW1xuICAgICAgICAncmVzb3VyY2VzJywgJ2NvbmZpZ3MnLFxuICAgICAgICAnLS10eXBlJywgJ3N0cmluZycsXG4gICAgICAgIGFwcFBhdGgsXG4gICAgICBdLCB7XG4gICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3Rkb3V0LnNwbGl0KG9zLkVPTCk7XG4gICAgfSwgbGFuZ3VhZ2UsICcnKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0MiwgW1xuICAgICAgICAnZHVtcCcsIGFwcFBhdGgsXG4gICAgICBdKTtcbiAgICAgIGFwa1N0cmluZ3MgPSBwYXJzZUFhcHQyU3RyaW5ncyhzdGRvdXQsIGNvbmZpZ01hcmtlcik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZXh0cmFjdCByZXNvdXJjZXMgZnJvbSAnJHtvcmlnaW5hbEFwcFBhdGh9Jy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShhcGtTdHJpbmdzKSkge1xuICAgIGxvZy53YXJuKGBObyBzdHJpbmdzIGhhdmUgYmVlbiBmb3VuZCBpbiAnJHtvcmlnaW5hbEFwcFBhdGh9JyByZXNvdXJjZXMgYCArXG4gICAgICBgZm9yICcke2NvbmZpZ01hcmtlciB8fCAnZGVmYXVsdCd9JyBjb25maWd1cmF0aW9uYCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oYFN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQgJHtfLmtleXMoYXBrU3RyaW5ncykubGVuZ3RofSBzdHJpbmdzIGZyb20gYCArXG4gICAgICBgJyR7b3JpZ2luYWxBcHBQYXRofScgcmVzb3VyY2VzIGZvciAnJHtjb25maWdNYXJrZXIgfHwgJ2RlZmF1bHQnfScgY29uZmlndXJhdGlvbmApO1xuICB9XG5cbiAgY29uc3QgbG9jYWxQYXRoID0gcGF0aC5yZXNvbHZlKG91dCwgJ3N0cmluZ3MuanNvbicpO1xuICBhd2FpdCBta2RpcnAob3V0KTtcbiAgYXdhaXQgZnMud3JpdGVGaWxlKGxvY2FsUGF0aCwgSlNPTi5zdHJpbmdpZnkoYXBrU3RyaW5ncywgbnVsbCwgMiksICd1dGYtOCcpO1xuICByZXR1cm4ge2Fwa1N0cmluZ3MsIGxvY2FsUGF0aH07XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbGFuZ3VhZ2UgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbGFuZ3VhZ2UuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXREZXZpY2VMYW5ndWFnZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUxhbmd1YWdlICgpIHtcbiAgbGV0IGxhbmd1YWdlO1xuICBpZiAoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzTGFuZ3VhZ2UoKTtcbiAgICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlKCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnNwbGl0KCctJylbMF07XG4gIH1cbiAgcmV0dXJuIGxhbmd1YWdlO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGNvdW50cnkgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgY291bnRyeS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUNvdW50cnkgPSBhc3luYyBmdW5jdGlvbiBnZXREZXZpY2VDb3VudHJ5ICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA8IDIzXG4gIGxldCBjb3VudHJ5ID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNDb3VudHJ5KCk7XG4gIGlmICghY291bnRyeSkge1xuICAgIGNvdW50cnkgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RDb3VudHJ5KCk7XG4gIH1cbiAgcmV0dXJuIGNvdW50cnk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbG9jYWxlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG5hbWUgb2YgZGV2aWNlIGxvY2FsZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUxvY2FsZSAoKSB7XG4gIC8vIHRoaXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBpbiBBUEkgPj0gMjNcbiAgbGV0IGxvY2FsZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzTG9jYWxlKCk7XG4gIGlmICghbG9jYWxlKSB7XG4gICAgbG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQcm9kdWN0TG9jYWxlKCk7XG4gIH1cbiAgcmV0dXJuIGxvY2FsZTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QgYW5kIHRoZSBmb3JtYXQgb2YgdGhlIGxvY2FsZSBpcyBlbi1VUywgZm9yIGV4YW1wbGUuXG4gKiBUaGlzIG1ldGhvZCBjYWxsIHNldERldmljZUxhbmd1YWdlQ291bnRyeSwgc28sIHBsZWFzZSB1c2Ugc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IGFzIHBvc3NpYmxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbGUgLSBOYW1lcyBvZiB0aGUgZGV2aWNlIGxhbmd1YWdlIGFuZCB0aGUgY291bnRyeSBjb25uZWN0ZWQgd2l0aCBgLWAuIGUuZy4gZW4tVVMuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zZXREZXZpY2VMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiBzZXREZXZpY2VMb2NhbGUgKGxvY2FsZSkge1xuICBjb25zdCB2YWxpZGF0ZUxvY2FsZSA9IG5ldyBSZWdFeHAoL1thLXpBLVpdKy1bYS16QS1aMC05XSsvKTtcbiAgaWYgKCF2YWxpZGF0ZUxvY2FsZS50ZXN0KGxvY2FsZSkpIHtcbiAgICBsb2cud2Fybihgc2V0RGV2aWNlTG9jYWxlIHJlcXVpcmVzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OiBlbi1VUyBvciBqYS1KUGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBzcGxpdF9sb2NhbGUgPSBsb2NhbGUuc3BsaXQoJy0nKTtcbiAgYXdhaXQgdGhpcy5zZXREZXZpY2VMYW5ndWFnZUNvdW50cnkoc3BsaXRfbG9jYWxlWzBdLCBzcGxpdF9sb2NhbGVbMV0pO1xufTtcblxuLyoqXG4gKiBNYWtlIHN1cmUgY3VycmVudCBkZXZpY2UgbG9jYWxlIGlzIGV4cGVjdGVkIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudHJ5IC0gQ291bnRyeS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gc2NyaXB0IC0gU2NyaXB0LiBUaGUgc2NyaXB0IGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byB0aXRsZSBjYXNlLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IElmIGN1cnJlbnQgbG9jYWxlIGlzIGxhbmd1YWdlIGFuZCBjb3VudHJ5IGFzIGFyZ3VtZW50cywgcmV0dXJuIHRydWUuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5lbnN1cmVDdXJyZW50TG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZW5zdXJlQ3VycmVudExvY2FsZSAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgY29uc3QgaGFzTGFuZ3VhZ2UgPSBfLmlzU3RyaW5nKGxhbmd1YWdlKTtcbiAgY29uc3QgaGFzQ291bnRyeSA9IF8uaXNTdHJpbmcoY291bnRyeSk7XG5cbiAgaWYgKCFoYXNMYW5ndWFnZSAmJiAhaGFzQ291bnRyeSkge1xuICAgIGxvZy53YXJuKCdlbnN1cmVDdXJyZW50TG9jYWxlIHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnknKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBnZXQgbG93ZXIgY2FzZSB2ZXJzaW9ucyBvZiB0aGUgc3RyaW5nc1xuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuXG4gIHJldHVybiBhd2FpdCByZXRyeUludGVydmFsKDUsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGFwaUxldmVsIDwgMjMpIHtcbiAgICAgICAgbGV0IGN1ckxhbmd1YWdlLCBjdXJDb3VudHJ5O1xuICAgICAgICBpZiAoaGFzTGFuZ3VhZ2UpIHtcbiAgICAgICAgICBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKCFoYXNDb3VudHJ5ICYmIGxhbmd1YWdlID09PSBjdXJMYW5ndWFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNDb3VudHJ5KSB7XG4gICAgICAgICAgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0xhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3VyTG9jYWxlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vIHpoLWhhbnMtY24gOiB6aC1jblxuICAgICAgICBjb25zdCBsb2NhbGVDb2RlID0gc2NyaXB0ID8gYCR7bGFuZ3VhZ2V9LSR7c2NyaXB0LnRvTG93ZXJDYXNlKCl9LSR7Y291bnRyeX1gIDogYCR7bGFuZ3VhZ2V9LSR7Y291bnRyeX1gO1xuXG4gICAgICAgIGlmIChsb2NhbGVDb2RlID09PSBjdXJMb2NhbGUpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYFJlcXVlc3RlZCBsb2NhbGUgaXMgZXF1YWwgdG8gY3VycmVudCBsb2NhbGU6ICcke2N1ckxvY2FsZX0nYCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHRoZXJlIGhhcyBiZWVuIGFuIGVycm9yLCByZXN0YXJ0IGFkYiBhbmQgcmV0cnlcbiAgICAgIGxvZy5lcnJvcihgVW5hYmxlIHRvIGNoZWNrIGRldmljZSBsb2NhbGl6YXRpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ1Jlc3RhcnRpbmcgQURCIGFuZCByZXRyeWluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0QWRiKCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxhbmd1YWdlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIHNldERldmljZUxhbmd1YWdlQ291bnRyeSAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgbGV0IGhhc0xhbmd1YWdlID0gbGFuZ3VhZ2UgJiYgXy5pc1N0cmluZyhsYW5ndWFnZSk7XG4gIGxldCBoYXNDb3VudHJ5ID0gY291bnRyeSAmJiBfLmlzU3RyaW5nKGNvdW50cnkpO1xuICBpZiAoIWhhc0xhbmd1YWdlIHx8ICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oYHNldERldmljZUxhbmd1YWdlQ291bnRyeSByZXF1aXJlcyBsYW5ndWFnZSBhbmQgY291bnRyeSBhdCBsZWFzdGApO1xuICAgIGxvZy53YXJuKGBHb3QgbGFuZ3VhZ2U6ICcke2xhbmd1YWdlfScgYW5kIGNvdW50cnk6ICcke2NvdW50cnl9J2ApO1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgbGFuZ3VhZ2UgPSAobGFuZ3VhZ2UgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gIGNvdW50cnkgPSAoY291bnRyeSB8fCAnJykudG9VcHBlckNhc2UoKTtcblxuICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgIGxldCBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IGN1ckNvdW50cnkgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VDb3VudHJ5KCkpLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAobGFuZ3VhZ2UgIT09IGN1ckxhbmd1YWdlIHx8IGNvdW50cnkgIT09IGN1ckNvdW50cnkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcChsYW5ndWFnZSwgY291bnRyeSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBjdXJMb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZUxvY2FsZSgpO1xuXG4gICAgLy8gemgtSGFucy1DTiA6IHpoLUNOXG4gICAgY29uc3QgbG9jYWxlQ29kZSA9IHNjcmlwdCA/IGAke2xhbmd1YWdlfS0ke3NjcmlwdH0tJHtjb3VudHJ5fWAgOiBgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWA7XG4gICAgbG9nLmRlYnVnKGBDdXJyZW50IGxvY2FsZTogJyR7Y3VyTG9jYWxlfSc7IHJlcXVlc3RlZCBsb2NhbGU6ICcke2xvY2FsZUNvZGV9J2ApO1xuICAgIGlmIChsb2NhbGVDb2RlLnRvTG93ZXJDYXNlKCkgIT09IGN1ckxvY2FsZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldERldmljZVN5c0xvY2FsZVZpYVNldHRpbmdBcHAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFwcEluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIC0gUGFja2FnZSBuYW1lLCBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB2ZXJzaW9uQ29kZSAtIFZlcnNpb24gY29kZS5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2ZXJzaW9uTmFtZSAtIFZlcnNpb24gbmFtZSwgZm9yIGV4YW1wbGUgJzEuMCcuXG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIGxvY2FsIGFwayBmaWxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byBleGlzdGluZyAuYXBrKHMpIHBhY2thZ2Ugb24gdGhlIGxvY2FsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgc3lzdGVtLlxuICogQHJldHVybiB7P0FwcEluZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mb3JtYXRpb24uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRBcGtJbmZvID0gYXN5bmMgZnVuY3Rpb24gZ2V0QXBrSW5mbyAoYXBwUGF0aCkge1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgcGF0aCAke2FwcFBhdGh9IGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cblxuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYXBrYW5hbHl6ZXJQYXRoID0gYXdhaXQgZ2V0QXBrYW5hbHl6ZXJGb3JPcyh0aGlzKTtcbiAgICBjb25zdCBhcmdzID0gWydtYW5pZmVzdCcsICdwcmludCcsIGFwcFBhdGhdO1xuICAgIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgJyR7YXBrYW5hbHl6ZXJQYXRofScgd2l0aCBhcmdzICR7SlNPTi5zdHJpbmdpZnkoYXJncyl9YCk7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGFwa2FuYWx5emVyUGF0aCwgYXJncywge1xuICAgICAgc2hlbGw6IHRydWUsXG4gICAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpLFxuICAgIH0pO1xuICAgIGNvbnN0IHtwa2csIHZlcnNpb25OYW1lLCB2ZXJzaW9uQ29kZX0gPSBwYXJzZU1hbmlmZXN0KHN0ZG91dCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHBrZyxcbiAgICAgIHZlcnNpb25Db2RlLFxuICAgICAgdmVyc2lvbk5hbWUsXG4gICAgfTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5pbmZvKGBDYW5ub3QgZXh0cmFjdCBhcGsgaW5mbyB1c2luZyBhcGthbmFseXplci4gRmFsbGluZyBiYWNrIHRvIGFhcHQuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIFsnZCcsICdiYWRnaW5nJywgYXBwUGF0aF0pO1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IG5ldyBSZWdFeHAoL3BhY2thZ2U6IG5hbWU9JyhbXiddKyknIHZlcnNpb25Db2RlPScoXFxkKyknIHZlcnNpb25OYW1lPScoW14nXSspJy8pLmV4ZWMoc3Rkb3V0KTtcbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogbWF0Y2hlc1sxXSxcbiAgICAgICAgICB2ZXJzaW9uQ29kZTogcGFyc2VJbnQobWF0Y2hlc1syXSwgMTApLFxuICAgICAgICAgIHZlcnNpb25OYW1lOiBtYXRjaGVzWzNdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgRXJyb3IgXCIke2Vyci5zdGRlcnIgfHwgZXJyLm1lc3NhZ2V9XCIgd2hpbGUgZ2V0dGluZyBiYWRnaW5nIGluZm9gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIHRoZSBpbnN0YWxsZWQgYXBwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgcGFja2FnZS5cbiAqIEByZXR1cm4gez9BcHBJbmZvfSBUaGUgcGFyc2VkIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0UGFja2FnZUluZm8gPSBhc3luYyBmdW5jdGlvbiBnZXRQYWNrYWdlSW5mbyAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBwYWNrYWdlIGluZm8gZm9yICcke3BrZ30nYCk7XG4gIGxldCByZXN1bHQgPSB7bmFtZTogcGtnfTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgdmVyc2lvbk5hbWVNYXRjaCA9IG5ldyBSZWdFeHAoL3ZlcnNpb25OYW1lPShbXFxkKy5dKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25OYW1lTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uTmFtZSA9IHZlcnNpb25OYW1lTWF0Y2hbMV07XG4gICAgfVxuICAgIGNvbnN0IHZlcnNpb25Db2RlTWF0Y2ggPSBuZXcgUmVnRXhwKC92ZXJzaW9uQ29kZT0oXFxkKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25Db2RlTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uQ29kZSA9IHBhcnNlSW50KHZlcnNpb25Db2RlTWF0Y2hbMV0sIDEwKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYEVycm9yICcke2Vyci5tZXNzYWdlfScgd2hpbGUgZHVtcGluZyBwYWNrYWdlIGluZm9gKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuYXBrVXRpbHNNZXRob2RzLnB1bGxBcGsgPSBhc3luYyBmdW5jdGlvbiBwdWxsQXBrIChwa2csIHRtcERpcikge1xuICBjb25zdCBwa2dQYXRoID0gKGF3YWl0IHRoaXMuYWRiRXhlYyhbJ3NoZWxsJywgJ3BtJywgJ3BhdGgnLCBwa2ddKSkucmVwbGFjZSgncGFja2FnZTonLCAnJyk7XG4gIGNvbnN0IHRtcEFwcCA9IHBhdGgucmVzb2x2ZSh0bXBEaXIsIGAke3BrZ30uYXBrYCk7XG4gIGF3YWl0IHRoaXMucHVsbChwa2dQYXRoLCB0bXBBcHApO1xuICBsb2cuZGVidWcoYFB1bGxlZCBhcHAgZm9yIHBhY2thZ2UgJyR7cGtnfScgdG8gJyR7dG1wQXBwfSdgKTtcbiAgcmV0dXJuIHRtcEFwcDtcbn07XG5cbmV4cG9ydCB7IFJFTU9URV9DQUNIRV9ST09UIH07XG5leHBvcnQgZGVmYXVsdCBhcGtVdGlsc01ldGhvZHM7XG4iXSwiZmlsZSI6ImxpYi90b29scy9hcGstdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
